var loadMiniCart=true;var TopMenu=Class.create();Object.extend(TopMenu.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")},getSuggestions:function(d,c){return Mtime.Component.Ajax.request(siteServiceUrl,"Mtime.Service.Pages.UtilityService","GetSuggestionKeywords",[d],c,"/service/utility.msi","get","20000")},addRegisterDayBonus:function(c,d){Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)}},MainNavPageType:{NotSet:0,Home:1,News:2,Theater:3,Community:4,Movie:5,Mall:6},options:{type:1,mainNavPage:0,actionUrl:siteSearchUrl+"/search/",timer:1,showSearchBoxHrefs:["http://theater.mtime.com","http://news.mtime.com/pix","http://i.mtime.com","http://group.mtime.com","http://my.mtime.com","http://piao.mtime.com","http://mall.mtime.com"],pageSearchControlSearchTip:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeData();this.initializeEvent()},initializeField:function(){this.isInitialize=false;this.isInitializeManager=false;this.type=topMenuValues.mainNavType=="Channel"?0:1;this.mainNavPage=topMenuValues.mainNavPage},initializeDOM:function(){this.topMenuRegion=$("topMenuRegion");if(!this.topMenuRegion){this.topMenuRegion=$("topbar")}if(this.topMenuRegion){this.addDOM()}},destroyDOM:function(){this.removeDOM();if(this.topMenuRegion){this.topMenuRegion=null}},initializeData:function(){if(!this.topMenuRegion){return}this.topMenuValues=topMenuValues;this.server.getUser(function(g){if(g&&g.value){var h=g.value;this.isLogin=h.userId>0?true:false;this.user={isLogin:this.isLogin,id:h.userId,nickname:h.nickName,homeUrl:h.homeUrl,blogUrl:h.blogUrl,headSrc:h.headSrc,isSaveEmail:h.isSaveEmail,isAutoExit:h.isAutoExit,signupTime:h.signupTime,email:h.email,cityId:h.cityId,cityName:h.cityName,isAnniversary:h.isAnniversary,authorizeUrl:typeof h.authorizeUrl==="undefined"?"":h.authorizeUrl,isVirtual:typeof h.isVirtual==="undefined"?false:h.isVirtual,enableMobileLogin:true,customizeMenus:typeof h.CustomizeMenus==="undefined"?null:h.CustomizeMenus,headSrc128:typeof h.headSrc128==="undefined"?"":h.headSrc128,shortNickName:typeof h.shortNickName==="undefined"?"":h.shortNickName,currentXP:typeof h.currentXP==="undefined"?"0":h.currentXP,level:typeof h.level==="undefined"?"0":h.level};var f,e=Globals.getParam("redirectUrl");if(e&&e.trim().length>0){f=e}else{f=encodeURIComponent(location.href)}this.message={receiveCount:h.receiveCount,promptCount:h.promptCount,noticeCount:h.noticeCount,allCount:h.allCount,unreadCount:h.receiveCount+h.promptCount+h.noticeCount};this.urls={mytime:siteMcUrl,signIn:siteUrl+"/member/signin/?redirectUrl="+f,signUp:siteUrl+"/member/signup/?redirectUrl="+f,signOut:siteUrl+"/member/signout/?redirectUrl="+f,siteHelp:siteUrl+"/help/",forgetPasswordUrl:h.forgetPasswordUrl};this.unreadMsgCount=h.allCount;this.render()}}.bind(this))},render:function(){if(this.mainNavPage!==this.MainNavPageType.Mall&&this.mainNavPage!==this.MainNavPageType.Theater&&this.bgLink&&this.topMenuValues&&this.topMenuValues.bgStartDate&&this.topMenuValues.bgEndDate){var d=new Date();var c=new Date(this.topMenuValues.bgEndDate.getFullYear(),this.topMenuValues.bgEndDate.getMonth(),this.topMenuValues.bgEndDate.getDate(),23,59,59);if(this.topMenuValues.bgStartDate<d&&d<c){if(this.topMenuValues.bgUrl){this.bgLink.href=this.topMenuValues.bgUrl;this.bgLink.target="_blank";this.bgLink.addClassName("linkpoint")}else{this.bgLink.href="javascript:void(0)";this.bgLink.removeClassName("linkpoint")}if(this.topMenuValues.bgSrc&&this.topMenuValues.bgSrc.length>0){this.topRegion.style.backgroundImage="url("+this.topMenuValues.bgSrc+")";this.topRegion.style.backgroundPosition="center top";this.topRegion.style.backgroundRepeat="no-repeat"}if(this.topMenuValues.bgHeight>0){this.topRegion.style.height=this.topMenuValues.bgHeight+"px"}if(this.topMenuValues.logoBGColor){this.logoRegion.style.backgroundColor=this.topMenuValues.logoBGColor}if(this.topMenuValues.searchTip){this.pageSearchControlSearchTip=this.topMenuValues.searchTip}}}this.initializeControl()},initializeEvent:function(){if(this.closeButton){this.onClickCloseButtonHandler=this.onClickCloseButton.bindAsEventListener(this);this.closeButton.observe("click",this.onClickCloseButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.closeButton){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler)}},initializeControl:function(){if(!this.cityMenu&&this.userCityRegion){this.cityMenu=new CityMenu({container:this.userCityRegion,userInfo:this.user})}if(!this.messageMenu&&this.userMessageRegion){this.messageMenu=new MessageMenu({container:this.userMessageRegion,message:this.message,user:this.user,isLogin:this.user.isLogin})}if(!this.userMenu&&this.userLoginRegion){this.userMenu=new UserMenu({container:this.userLoginRegion.parentNode,menu:this.userLoginRegion,userInfo:this.user,urls:this.urls})}if(typeof PageSearchControl!="undefined"){var d=0;if(this.mainNavPage==3){d=2}else{if(this.mainNavPage==6){d=4}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:d})}}else{$loadJs("/js/2014/PageSearchControl.js",function(){var a=0;if(this.mainNavPage==3){a=2}else{if(this.mainNavPage==6){a=4}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:a})}}.bind(this))}if(!this.navigationMenu&&this.navMenuButton){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.navMenuButton,contentRegion:this.navMenuRegion,onOverCallback:function(){if(!this.navMenuButton.hasClassName("currmenuicon")){this.navMenuButton.addClassName("currmenuicon")}}.bind(this),onOutCallback:function(){if(this.navMenuButton.hasClassName("currmenuicon")){this.navMenuButton.removeClassName("currmenuicon")}}.bind(this)})}if(typeof ManagerExecuter!=="function"){var c=[]}else{manager=new ManagerExecuter({managerRegion:this.topMenuRegion,user:this.user,urls:this.urls,customizeMenus:this.user.customizeMenus})}if(typeof loadMiniCart!="undefined"&&loadMiniCart){if(!this.miniCart&&this.miniCartRegion){this.miniCart=new MiniCart({container:this.miniCartRegion,isLogin:this.user.isLogin})}}},addDOM:function(){this.searchTypeRegion=Builder.node("div",{className:"selctsearch"},[Builder.node("strong",["全部"]),Builder.node("i",[""]),Builder.node("span",["|"])]);this.searchTypeListRegion=Builder.node("div",{className:"selectshow",style:"display:none;"},[Builder.node("ul",[Builder.node("li",{searchtype:"0"},["全部"]),Builder.node("li",{searchtype:"1"},["电影"]),Builder.node("li",{searchtype:"3"},["影人"]),Builder.node("li",{searchtype:"2"},["影院"]),Builder.node("li",{searchtype:"4"},["商品"])])]);if(this.type==0){this.searchRegion=Builder.node("div",{className:"topsearch"},[Builder.node("div",{className:"searchshadow"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:""}),Builder.node("input",{type:"button",className:"button"})])])}else{this.searchRegion=Builder.node("div",{className:"topsearch"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:""}),Builder.node("input",{type:"button",className:"button"})])}this.suggestRegion=Builder.node("div",{className:"showsearch",style:"display:none;"});this.userLoginRegion=Builder.node("div",{className:"loginbox",style:"display:none;"});this.userMessageRegion=Builder.node("div",{className:"emailbox",style:"display:none;"},[Builder.node("i",{className:"ico_email"})]);this.userCityRegion=Builder.node("div",{className:"citybox",style:"display:none;"});this.bgLink=Builder.node("a",{href:"javascript:void(0)",className:"searchlink"},[]);this.miniCartRegion=Builder.node("div",{className:"shopbox onlyshop",onclick:"headTrackClick('M14_HeadNav_MiniCart_Region')",style:"display:none;"});if(this.type===0){this.addChannelDOM()}else{this.addDetailDOM()}},removeDOM:function(){if(this.type===0){}else{}},addChannelDOM:function(){this.topRegion=Builder.node("div",{className:"bartop"},[Builder.node("div",{className:"topmid"},[this.bgLink,this.searchRegion,this.suggestRegion])]);this.logoRegion=Builder.node("h1",{className:"mtimelogo",onclick:"headTrackClick('M14_HeadNav_MiddleNav')"},[Builder.node("a",{title:"Mtime时光网",href:"http://www.mtime.com"},["Mtime时光网"])]);this.topMenuRegion.appendChild(this.topRegion);var h=Builder.node("div",{className:"topline bigtopline"});this.topMenuRegion.appendChild(h);var e=Builder.node("ul",{className:"navbar"});e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Home?"curr":""},[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Index')"},[Builder.node("em",["首页"]),Builder.node("span",["首页"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.News?"curr":""},[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_News')"},[Builder.node("em",["新闻"]),Builder.node("span",["新闻"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Theater?"curr":""},[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Theater')"},[Builder.node("em",["影院"]),Builder.node("span",["影院"])])]));if(typeof loadMiniCart!="undefined"&&loadMiniCart){e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Mall?"curr":""},[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Mall')"},[Builder.node("em",["商城"]),Builder.node("span",["商城"]),Builder.node("i",{className:"i_new"})])]))}e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Community?"curr":""},[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Community')"},[Builder.node("em",["社区"]),Builder.node("span",["社区"])])]));e.appendChild(Builder.node("li",{className:this.mainNavPage==this.MainNavPageType.Movie?"curr":""},[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Movie')"},[Builder.node("em",["发现"]),Builder.node("span",["发现"])])]));var f=Builder.node("div",{className:"userbar"});if(typeof loadMiniCart!="undefined"&&loadMiniCart){f.appendChild(this.miniCartRegion)}f.appendChild(this.userMessageRegion);f.appendChild(this.userLoginRegion);f.appendChild(this.userCityRegion);var g=Builder.node("div",{className:"menubar"},[Builder.node("div",{className:"menubg"},[Builder.node("div",{className:"menumid clearfix"},[this.logoRegion,e,f])])]);this.topMenuRegion.appendChild(g)},addDetailDOM:function(){var h=Builder.node("div",{className:"topline"});this.topMenuRegion.appendChild(h);this.logoRegion=Builder.node("h1",{className:"mtimelogo",onclick:"headTrackClick('M14_HeadNav_MiddleNav')"},[Builder.node("a",{href:"http://www.mtime.com",title:"Mtime时光网"},["Mtime时光网"])]);this.navMenuButton=Builder.node("a",{href:"http://www.mtime.com/",className:"menuicon",title:"导航"},[]);var e=Builder.node("div",{className:"userbar"});if(typeof loadMiniCart!="undefined"&&loadMiniCart){e.appendChild(this.miniCartRegion)}e.appendChild(this.userMessageRegion);e.appendChild(this.userLoginRegion);e.appendChild(this.userCityRegion);this.navMenuRegion=Builder.node("div",{className:"menupop navpop",style:"display:none;"});var g=Builder.node("ul");g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Index')"},[Builder.node("i",{className:"ico_n_index"}),"首页"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_News')"},[Builder.node("i",{className:"ico_n_news"}),"新闻"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Theater')"},[Builder.node("i",{className:"ico_n_ticket"}),"影院"])]));if(typeof loadMiniCart!="undefined"&&loadMiniCart){g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Mall')"},[Builder.node("i",{className:"ico_n_mall"}),"商城"])]))}g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Community')"},[Builder.node("i",{className:"ico_n_bbs"}),"社区"])]));g.appendChild(Builder.node("li",[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M14_HeadNav_LeftNav_Movie')"},[Builder.node("i",{className:"ico_n_find"}),"发现"])]));this.navMenuRegion.appendChild(g);var f=Builder.node("div",{className:"menubar"},[Builder.node("div",{className:"menubg"},[Builder.node("div",{className:"menumid clearfix"},[this.logoRegion,Builder.node("div",{className:"navsearch clearfix"},[this.navMenuButton,this.searchRegion,this.suggestRegion,this.navMenuRegion]),e])])]);this.topMenuRegion.appendChild(f)},removeChannelDOM:function(){},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var MessageMenu=Class.create();Object.extend(MessageMenu.prototype,{server:{getUnreadMessages:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","GetUnreadMessages",[],b,"/Service/Message.msi","get","20000")},addRegisterDayBonus:function(c,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)},clearAllUnreadCount:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","ClearAllUnreadCount",[],b,"/Service/Message.msi","get","20000")}},options:{container:null,user:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeEvent();this.render()},initializeEvent:function(){Event.observe(this.container,"click",this.onClickContainer.bindAsEventListener(this))},render:function(){this.getUnReadMessage();if(this.isLogin){this.container.show()}},onClickContainer:function(g){var f=Event.element(g);if(f.hasClassName("close_btn")){this.container.down('[_type="message"]')&&this.server.clearAllUnreadCount(null);this.container.down(".m_message_notice").remove();var h=this.container.down(".m_message em");if(h){h.removeClassName("newmsg")}var k=getCookie("virtualuser");if(this.user.isVirtual&&(typeof(k)==="undefined"||k!=="virtualuser")){setCookie("virtualuser","virtualuser")}}else{if(!this.user.isAnniversary){var j=siteMcUrl+"/message/usermessage/";$redirect(j)}}},getUnReadMessage:function(){this.server.getUnreadMessages(function(y){var q=null;var s=this.user.isAnniversary;if(s){q=Builder.build('<p _type="anniversary"><a href="#" onclick="return false;">注册周年积分奖励，点击领取</a></p>')}var t=this.user.isVirtual;var z=t;if(t){var B=getCookie("virtualuser");if(B&&B==="virtualuser"){z=false}}var u=this.container.down(".m_message_notice");u&&u.remove();u=null;if((!y||!y.value)&&!q&&!z){return}else{if(!u){u=Builder.build('<div class="m_message_notice tl"><em></em><span class="close_btn fr">×</span></div>');this.container.appendChild(u)}var A=u.down('[_type="message"]');A&&A.remove();if(q){u.appendChild(q);var x=this.user.nickname;var r=this.closeMsg.bind(this);var w=this.container;var p=this.server.addRegisterDayBonus;Event.observe(q,"click",function(){var a=new Dialog({title:"注册周年积分奖励!",windowClassName:"w420",content:"<div>亲爱的"+x+"，感谢你对时光网一年的支持，时光网有你更精彩。</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"领取",buttonStyle:"btn_blue mr12",callback:function(){var d=null;if(d=w.down('[_type="message"]')){var b=w.down('[_type="anniversary"]');b&&b.remove()}else{w.down(".m_message_notice").remove();var c=w.down(".m_message em");if(c){c.removeClassName("newmsg")}}p();a.close()}}]})}.bind(this))}if(z&&this.user.authorizeUrl){var C=Builder.build(String.format('<p>完善信息后，服务更安全 <a href="{0}">立即设置</a></p>',this.user.authorizeUrl));u.appendChild(C)}if(y&&y.value){u.appendChild(Builder.build(y.value));this.container.addClassName("curremail")}}var v=this.container.down(".m_message em");if(typeof v!="undefined"){if(this.container.down(".m_message_notice")){if(!v.hasClassName("newmsg")){v.addClassName("newmsg")}}else{v.removeClassName("newmsg")}}}.bind(this))},closeMsg:function(d){var e=Event.element(d);if(e.hasClassName("close_btn")){this.container.down('[_type="message"]')&&this.server.clearAllUnreadCount(null);this.container.down(".m_message_notice").remove();var f=this.container.down(".m_message em");f.removeClassName("newmsg")}}});var UserMenu=Class.create();Object.extend(UserMenu.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(j,m,l,k,o,n,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[j,m,l,k,o,n],h,"/utility/managerservice.m","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")},getXpAndLevel:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteGoodsServiceUrl,"Mtime.Ecommerce.Services","GetUserXpAndLevel",[d],c,"/Member.api","get","60000")},getCouponsForLogin:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetCouponsForLogin",[],b,"/Service/Manager.msi","get","10000","")}},options:{container:null,menu:null,userInfo:null,urls:null,onSignInCallback:null,hasLoadXpAndLevel:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.render();this.initializeEvent()},initializeDOM:function(){this.loginNameText=Builder.node("input",{type:"text",value:"输入电子邮箱/手机号",className:"tip"});this.passwordText=Builder.node("input",{type:"password",value:"",className:"tip"});this.autoLoginCheckBox=Builder.node("i",{className:"ico_m_check"},[""]);this.signInButton=Builder.node("input",{type:"button",value:"登录",className:"btn_login"});this.registerButton=Builder.node("input",{type:"button",value:"成为会员",className:"btn_regist"});this.vcodeText=Builder.node("input",{type:"text",value:"输入验证码",className:"tip"});this.refreshVcodeButton=Builder.node("a",{href:"#"},["刷新"])},initializeEvent:function(){Event.observe(this.menu,"click",this.onClickMenu.bind(this));if(this.userInfo.isLogin){this.initializeLoginEvent()}else{this.initializeUnloginEvent();this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},onClick:function(f){var g=Event.pointerX(f);var h=Event.pointerY(f);var e=Event.element(f);if(this.unloginRegion&&this.menu!==e.up("div.loginbox")&&this.unloginRegion!==e.up("div.menupop")&&!Position.within(this.container,g,h)&&!Position.within(this.unloginRegion,g,h)){if(!this.userInfo.isLogin){if(this.unloginRegion.visible()){this.menu.removeClassName("currlogin");this.unloginRegion.hide()}}}},initializeLoginEvent:function(){},initializeUnloginEvent:function(){new Textbox({text:this.loginNameText,watermarkText:"输入电子邮箱/手机号"});new Textbox({text:this.passwordText,watermarkText:""});new Textbox({text:this.vcodeText,watermarkText:"输入验证码"});this.autoLoginCheckBox.observe("click",this.onClickAutoLoginCheckBox.bind(this));this.signInButton.observe("click",this.onClickSignInButton.bind(this));this.registerButton.observe("click",this.onClickRegisterButton.bind(this));this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.loginNameText,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passwordText,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.refreshVcodeButton,"click",this.refreshVcodeHandler);document.onkeydown=function(){var b=window.event;if(typeof b!=="undefined"&&b.keyCode===13){this.onClickSignInButton()}}.bind(this)},render:function(){if(this.userInfo.isLogin){var d=Builder.node("span",{className:"logintxt"},[this.userInfo.nickname]);var f=Builder.node("span",{className:"loginpic"},[Builder.node("img",{height:"27",width:"27",src:this.userInfo.headSrc})]);this.menu.appendChild(d);this.menu.appendChild(f);this.loginRegion=this.buildLoginDOM();this.loginRegion.hide();this.container.appendChild(this.loginRegion);if(!this.userInfo.isAutoExit){this.autoLoginCheckBox.addClassName("ico_m_currcheck")}this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.menu,contentRegion:this.loginRegion,onOverCallback:this.onOverCallback.bind(this),onOutCallback:this.onOutCallback.bind(this)})}else{var d=Builder.node("span",{className:"logintxt"},["请登录"]);var f=Builder.node("span",{className:"loginpic"},[Builder.node("i",{className:"ico_user"})]);this.menu.appendChild(d);this.menu.appendChild(f);this.unloginRegion=this.buildUnloginDOM();var e=Builder.build('<dl class="otherlogin"><dt>使用第三方登录</dt><dd style="margin-left: 42px;"><a href="http://passport.mtime.com/unitelogin/dispatch/weibo/web/" title="新浪" class="o_sina"></a><a href="http://passport.mtime.com/unitelogin/dispatch/qq/web/" title="QQ" class="o_qq"></a></dd></dl>');this.unloginRegion.appendChild(e);this.unloginRegion.hide();this.container.appendChild(this.unloginRegion);this.loginNameText.value=this.userInfo.email}this.menu.style.display="block"},showVcodeRegion:function(){$(this.vcodeText.parentNode).show();if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down();this.vcodeImageRegion.show()}}.bind(this))}else{this.refreshVcode();this.vcodeImageRegion.show()}},hideVcodeRegion:function(){if(this.vcodeText){$(this.vcodeText.parentNode).hide()}if(this.vcodeImageRegion){this.vcodeImageRegion.hide()}},onOverCallback:function(){if(!this.menu.hasClassName("currlogin")){this.menu.addClassName("currlogin");if(this.userInfo.isLogin&&!this.hasLoadXpAndLevel){this.server.getXpAndLevel(this.userInfo.id,function(b){if(b&&b.value){$("topMenuLevelContainer").innerHTML="M"+b.value.level;this.hasLoadXpAndLevel=true}this.server.getCouponsForLogin(function(a){if(a&&a.value){if(a.value.totalCount==0){$("myCouponsCount").innerHTML="我的优惠券"}else{$("myCouponsCount").innerHTML="我的优惠券("+a.value.totalCount+")"}if(a.value.mtimeCardCount==0){$("myMtimeCardCount").innerHTML="我的礼品卡"}else{$("myMtimeCardCount").innerHTML="我的礼品卡("+a.value.mtimeCardCount+")"}if(a.value.willEndCount>0){$("couponWillEndContainer").show();$("urlEcommerceOrMovie").href=a.value.urlEcommerceOrMovie;$("willEndCount").innerHTML=a.value.willEndCount}else{$("couponWillEndContainer").hide()}}}.bind(this))}.bind(this))}}},onOutCallback:function(){if(this.menu.hasClassName("currlogin")){this.menu.removeClassName("currlogin")}},isShowing:function(){return this.loginRegion.style.display!="none"},onClickMenu:function(){if(this.userInfo.isLogin){if(this.isShowing()){this.loginRegion.hide();this.onOutCallback()}else{this.loginRegion.show();this.onOverCallback()}}else{if(this.unloginRegion.visible()){this.menu.removeClassName("currlogin");this.unloginRegion.hide()}else{this.unloginRegion.show();this.menu.addClassName("currlogin")}}},onClickRegisterButton:function(){if(typeof sitePassportUrl==="undefined"){sitePassportUrl="http://passport.mtime.com"}var b=sitePassportUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},onClickVcodeText:function(){if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down()}}.bind(this))}},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeText.value="";this.vcodeText.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var c=this.loginNameText.value.trim(),d=true;if(this.userInfo.enableMobileLogin){if(!Validator.Email.test(c)&&!Validator.MobilePhone.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}else{if(!Validator.Email.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}return d},checkPassword:function(){var c=this.passwordText.value,d=true;if(!Validator.Password.test(c)){$(this.passwordText.parentNode).addClassName("false");d=false}else{$(this.passwordText.parentNode).removeClassName("false")}return d},checkVcode:function(){var d=this.vcodeText.value.trim(),c=true;if(!d){$(this.vcodeText.parentNode).addClassName("false");c=false}else{$(this.vcodeText.parentNode).removeClassName("false")}return c},onClickSignInButton:function(){var e=this.loginNameText.value;var f=$encodePassword(this.passwordText.value);var d=!this.autoLoginCheckBox.hasClassName("ico_m_currcheck");if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.server.signIn(e,f,true,d,this.vcodeId||"",this.vcodeId?this.vcodeText.value:"",function(a){this.lock=false;if(a&&a.value){if(a.value.success){this.callback&&this.callback(a.value);location.reload()}else{if(a.value.isShieldStatus){this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.showResetPasswordDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.showVcodeRegion();if(!a.value.vcodeValid){$(this.vcodeText.parentNode).addClassName("false")}return}else{this.hideVcodeRegion();this.vcodeId=null}$(this.loginNameText.parentNode).addClassName("false");$(this.passwordText.parentNode).addClassName("false")}}}}}}.bind(this))}},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPasswordDialog:function(b){this.needResetPwdDialog=new Dialog({title:"很抱歉，账户已被冻结",windowClassName:"w375",content:'<div class="yahei px14 tc bold">由于长时间未登录，账户已被临时冻结。<br/>请点击按钮，重新邮件激活。 </div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"立即激活",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onClickAutoLoginCheckBox:function(){if(this.autoLoginCheckBox.hasClassName("ico_m_currcheck")){this.autoLoginCheckBox.removeClassName("ico_m_currcheck")}else{this.autoLoginCheckBox.addClassName("ico_m_currcheck")}},buildLoginDOM:function(){var j=Builder.node("div",{className:"menupop loginpop"});var f=Builder.node("div",{className:"my_name"});var g=Builder.node("dl",{className:"my_business clearfix"});var h=Builder.node("div",{className:"my_couptip",id:"couponWillEndContainer"});var k=Builder.node("ul",{className:"loginexit"});f.appendChild(Builder.node("a",{className:"my_pic __r_c_",href:siteMcUrl,pan:"M14_HeadNav_LoginBox_UserPic"},[Builder.node("img",{src:this.userInfo.headSrc128,width:"96px",height:"96px"})]));f.appendChild(Builder.node("dl",[Builder.node("dt",[Builder.node("a",{href:siteMcUrl,pan:"M14_HeadNav_LoginBox_UserName",className:"__r_c_"},[this.userInfo.shortNickName]),Builder.node("a",{href:"http://vip.mtime.com/myprivilege",pan:"M14_HeadNav_LoginBox_VipsuserLevel",className:"__r_c_"},Builder.node("span",{id:"topMenuLevelContainer"},["M0"]))]),Builder.node("dd",[Builder.node("a",{href:"http://vip.mtime.com/myprivilege/",pan:"M14_HeadNav_LoginBox_VipsuserPrivilege",className:"__r_c_"},["我的特权"]),Builder.node("i",{className:"c_a5 mlr5"},["|"]),Builder.node("a",{href:"http://vip.mtime.com/gift/",pan:"M14_HeadNav_LoginBox_VipsuserPackage",className:"__r_c_"},["会员礼包"])])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/",pan:"M14_HeadNav_LoginBox_MyMoiveTicket",className:"__r_c_"},["电影票订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/ecommerce/orderList/",pan:"M14_HeadNav_LoginBox_MyShop",className:"__r_c_"},["商品订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myCouponsCount",href:siteMcUrl+"/account/voucher/",pan:"M14_HeadNav_LoginBox_MyVoucher",className:"__r_c_"},["我的优惠券"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myMtimeCardCount",href:siteMcUrl+"/account/moviecard/",pan:"M14_HeadNav_LoginBox_MyMoiveCard",className:"__r_c_"},["我的礼品卡"])]));h.appendChild(Builder.node("i"));h.appendChild(Builder.node("p",{pan:"M14_HeadNav_LoginBox_WillEndCount",className:"__r_c_"},["您有",Builder.node("b",{id:"willEndCount"},["0"]),"张优惠券即将过期 ",Builder.node("a",{href:siteMcUrl+"/account/voucher/ecommerce/",id:"urlEcommerceOrMovie"},["点击查看"])]));k.appendChild(Builder.node("li",{pan:"M14_HeadNav_LoginBox_MyMtime",className:"__r_c_"},[Builder.node("p",["我的：",Builder.node("a",{href:siteMcUrl+"/app/blog/"},["博客"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/group/"},["群组"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/movie/"},["电影"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/favorite/"},["收藏"])]),Builder.node("p",["游戏：",Builder.node("a",{href:siteMcUrl+"/app/card/"},["卡片大富翁"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/quiz/"},["猜电影"])])]));k.appendChild(Builder.node("li",[Builder.node("a",{href:this.urls.signOut,className:"btn_exit __r_c_",pan:"M14_HeadNav_LoginBox_Exit"},["登出"]),Builder.node("a",{href:siteMcUrl+"/profile/basic/",className:"__r_c_",pan:"M14_HeadNav_LoginBox_Profile"},["修改资料"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/profile/password/",className:"__r_c_",pan:"M14_HeadNav_LoginBox_Password"},["密码"])]));j.appendChild(f);j.appendChild(g);j.appendChild(h);j.appendChild(k);return j},buildUnloginDOM:function(){var b=Builder.node("div",{className:"menupop loginpop"},[Builder.node("dl",{className:"logintool"},[Builder.node("dt",["为爱电影的人"]),Builder.node("dd",{className:"userlogin"},[Builder.node("ul",[Builder.node("li",{className:""},[Builder.node("label",{className:"name"},["用户名："]),this.loginNameText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:""},[Builder.node("label",{className:"password"},["输入密码："]),this.passwordText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:"",style:"display:none"},[Builder.node("label",{className:"code"},["输入验证码："]),this.vcodeText,Builder.node("i",{className:"ico_false"},[])])]),Builder.node("p",{className:"usertip"},[Builder.node("a",{href:siteMcUrl+"/member/forget_password/",target:"_blank",className:"fr"},["忘记密码"]),this.autoLoginCheckBox,"下次自动登录"]),Builder.node("div",{className:"btn"},[this.signInButton,this.registerButton])])])]);return b},buildVcodeImageDOM:function(c){var d=Builder.node("li",{className:"codetxt"},[Builder.node("span",{id:"img_vcode"},[Builder.node("img",{width:"90",height:"45",src:c,style:"cursor:pointer",className:"v_m mr6"})]),this.refreshVcodeButton]);return d}});var CityMenu=Class.create();Object.extend(CityMenu.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{userInfo:null,items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"热门",container:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){this.headPanel=$(this.container);this.closeNode=Builder.node("span",{className:"btn_close fr"},["关闭"]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"text"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on",_v:"热门"},["热门",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"A-G"},["A-G",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"H-L"},["H-L",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"M-T"},["M-T",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"W-Z"},["W-Z",Builder.node("b",[" "])])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip",style:"display:none;width: 560px; position: absolute; top: 35px; right: 0px;"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,Builder.node("div",{className:"citysearch"},[this.searchCityText]),this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));this.headPanel.appendChild(Builder.node("span",{className:"currcity"},["我在："+this.userInfo.cityName]));this.headPanel.appendChild(Builder.node("i",{className:"ico_city"}));this.headPanel.parentNode.insertBefore(this.bodyPanel,this.headPanel);var c=this.tab.childNodes;for(var d=0;d<c.length;d++){Event.observe(c[d],"click",function(e){var a=e.target||e.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(f){f.className=""});a.className="on";var b=a.readAttribute("_v");this.order=b;this.reload(b)}}.bind(this))}this.headPanel.style.display="block"},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler);Event.observe(this.closeNode,"click",this.onCloseHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onHeadPanelClickHandler&&Event.stopObserving(this.headPanel,"click",this.onHeadPanelClickHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.container,e,f)&&!Position.within(this.bodyPanel,e,f)){if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}}},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(k){this.contentBox.update();var f=null;switch(k){case"热门":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);break;case"A-G":if(!this.content.AG){f=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(f,this.content.regRxpAG)}this.contentBox.update(this.content.AG);break;case"H-L":if(!this.content.HL){f=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(f,this.content.regRxpHL)}this.contentBox.update(this.content.HL);break;case"M-T":if(!this.content.MT){f=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(f,this.content.regRxpMT)}this.contentBox.update(this.content.MT);break;case"W-Z":if(!this.content.WZ){f=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(f,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);break;default:break}var j=this.contentBox.getElementsByTagName("li");for(var h=0,g=j.length;h<g;h++){Event.observe(j[h],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(h,k){var o=new StringBuilder();for(var l=0,j=k.length;l<j;l++){var n=k[l];var m=h.findAll(function(a){return a.initial===n}).sortBy(function(a){return -a.VisitedTimes});if(m.length>0){o.append(this.createOptions(m,n))}}return o.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("热门");this.cityAutoComplete=new CityAutoComplete({text:this.searchCityText,textWatermarkText:"直接输入城市或城市拼音",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(f){var h=this.contentBox.getElementsByTagName("li");for(var g=0,e=h.length;g<e;g++){if(h[g].className==="on"){this.command(h[g].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(k,h,j){var l=Builder.node("div");var m=new StringBuilder();m.append('<div class="city_list2 clearfix">');m.append('<span class="fl w30 bold mt5">'+h+"</span>");m.append("<ul>");for(var g=0;g<k.length;g++){if(j&&g!==0&&(g%this.HOTROWSIZE===0)){m.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}m.append(this.optionTemplate.evaluate(k[g]))}m.append("</ul>");m.append("</div>");return m.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(b){b&&Event.stop(b);if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}else{this.show();this.headPanel.addClassName("oncity")}},isShowing:function(){return(this.bodyPanel.style.display!="none")},show:function(){this.bodyPanel.show()},hide:function(){this.bodyPanel.hide()},command:function(f){if(f!==null){setCookie("DefaultCity-CookieKey",f);var h="http://theater."+mtimeCookieDomain+"/[^/]+";var k=["/","/cinema/","/movie/","/ecoupon/","/ticket/","/card/","/movie/\\d+/","/discount/","/discount/information/","/discount/coupon/","/movie/lastday/"];var j=null;var g=k.find(function(a){var b=new RegExp(("^"+h+"("+a+")$").replace(/\//g,"\\/"));j=(location.protocol+"//"+location.host+location.pathname).match(b);return j&&j.length==2});if(!g){location.reload()}this.server.getTheaterCityHomeURL(f,function(a){if(a&&a.value){if(g){$redirect(a.value.replace(/\/$/,"")+j[1])}else{if(callbackUrl){$redirect(callbackUrl)}else{$redirect(a.value)}}}})}},getCitys:function(o,l){var m=[];for(var n=0;n<l.length;n++){var k=l[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<l.length){var q=l.length-m.length;for(var p=0;p<o.length;p++){if(q===0){break}if(!l.include(o[p].Id)){m.push(o[p]);q--}}}return m},getCity:function(h,e){for(var f=0,g=h.length;f<g;f++){if(e==h[f].Id){return h[f]}}return null}});var CityAutoComplete=Class.create();Object.extend(Object.extend(CityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(e){this.active=false;var f=this.listRegion.getElementsByTagName("li");var d=f.length;if(d>e&&e>=0){return $(f[e])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="输入中文/拼音或按&uarr;&darr;选择"}else{if(d>0){this.listTipText=c+"，按拼音数排序"}else{this.listTipText="对不起，找不到："+c}}},renderList:function(l,o){var j='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+o+"</ul></div></div>";this.listRegion.update(j);var n=this.listRegion.getElementsByTagName("li");for(var k=0,h=n.length;k<h;k++){var m=n[k];m.style.cursor="pointer";Event.observe(m,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(m,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(m,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(n.length>0){n[0].className="on"}}});var TopMenuNavigationMenu=Class.create();Object.extend(TopMenuNavigationMenu.prototype,{options:{menuRegion:null,contentRegion:null,onOverCallback:null,onOutCallback:null,overTimeout:1,outTimeout:100},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent()},initializeField:function(){this.outMenuTimer=null;this.overMenuTimer=null},initializeEvent:function(){this.onOverMenuHandler=this.onOverMenu.bindAsEventListener(this);this.menuRegion.observe("mouseover",this.onOverMenuHandler);this.contentRegion.observe("mouseover",this.onOverMenuHandler);this.onOutMenuHandler=this.onOutMenu.bindAsEventListener(this);this.menuRegion.observe("mouseout",this.onOutMenuHandler);this.contentRegion.observe("mouseout",this.onOutMenuHandler);this.onClickMenuHandler=this.onClickMenu.bindAsEventListener(this);this.menuRegion.observe("click",this.onClickMenuHandler)},destroyEvent:function(){this.menuRegion.stopObserving("mouseover",this.onOverMenuHandler);this.menuRegion.stopObserving("mouseout",this.onOutMenuHandler);this.menuRegion.stopObserving("click",this.onClickMenuHandler)},onOverMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.overMenuTimer=FunctionExt.defer(function(){this.onMenuOverCallback()},this.overTimeout,this)},onOutMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.outMenuTimer=FunctionExt.defer(function(){this.onMenuOutCallback()},this.outTimeout,this)},handleOverMenuTimer:function(){if(this.overMenuTimer!==null){clearTimeout(this.overMenuTimer);this.overMenuTimer=null}},handleOutMenuTimer:function(){if(this.outMenuTimer!==null){clearTimeout(this.outMenuTimer);this.outMenuTimer=null}},onClickMenu:function(b){this.onOverMenu()},onMenuOverCallback:function(){if(!this.contentRegion.visible()){this.contentRegion.show()}if(this.onOverCallback){this.onOverCallback()}},onMenuOutCallback:function(){if(this.contentRegion.visible()){this.contentRegion.hide()}if(this.onOutCallback){this.onOutCallback()}}});var SearchAutoComplete=Class.create();Object.extend(Object.extend(SearchAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},getEntry:function(c){var d=null;if(c>=0){d=$(this.listRegion.childNodes[c])}return d},getOption:function(d){var f=null;var e=this.idFieldName;this.searchDatas.each(function(a){if(a[e]==d){f=a;throw $break}});return f},render:function(){if(this.getSearchDataCallback!==null){this.getSearchDataCallback(function(b){this.searchDatas=b;this.doRender()}.bind(this))}else{this.doRender()}},getMoreLists:function(){var m=this.searchDatas,l=null,j=new StringBuilder(),k=0;for(var h=0,g=m.length;h<g;h++){l=m[h];j.append(this.createListItem(l));k++;this.searchIndex=h}this.entryCount+=k;return j.toString()},renderList:function(c,d){this.listRegion.innerHTML=d},onClickText:function(){this.render()},createListItem:function(d){var c=this.itemTemplate.evaluate(d);c=c.replace("<em >被查询 0 次</em>","");return c}});var MiniCart=Class.create();Object.extend(MiniCart.prototype,{server:{getCartList:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","GetMiniCartList",[],b,"/Service/Trade.p","get","60000")},removeCartItem:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","RemoveCartItemsBySkus",[d],c,"/Service/Trade.p","get","60000")}},options:{container:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var d=Builder.node("i",{className:"ico_shop"});Event.observe(d,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});var c=Builder.node("em",{className:"emailnum",id:"emGoodsCount",style:"display:none;"},[0]);Event.observe(c,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});this.headPanel.appendChild(d);this.headPanel.appendChild(c);if(this.isLogin){this.headPanel.removeClassName("onlyshop")}this.bodyPanel=Builder.node("div",{className:"menupop m_shopcart",style:"display:none;"});this.bodyPanel.appendChild(this.getNoDataElement());this.headPanel.appendChild(this.bodyPanel);this.headPanel.style.display="block"},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.bodyPanel,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this)});this.deleteRegionClickHandler=this.deleteRegionClick.bind(this);this.bodyPanel.observe("click",this.deleteRegionClickHandler)},render:function(){this.server.getCartList(function(c){if(c&&c.value){this.clearBodyPanel();var d=c.value.count;if(d>0){$("emGoodsCount").innerHTML=d;$("emGoodsCount").show()}else{$("emGoodsCount").hide()}if(d>0){this.bodyPanel.innerHTML=c.value.html}else{this.bodyPanel.appendChild(this.getNoDataElement())}}}.bind(this))},deleteRegionClick:function(k){var j=Event.element(k);var m=j.readAttribute("method");while(!m&&j!=document.body){j=j.up();m=j.readAttribute("method")}if(!m){return}var h=j.readAttribute("actid");var o=j.readAttribute("sku").split("|");var n="";for(var l=0;l<o.length;l++){if(n.length>0){n+=","}n+=o[l]+"|"+h+"|false"}this.server.removeCartItem(n,function(a){if(a&&a.value&&a.value.success){this.render()}}.bind(this))},destroyEvent:function(){this.onHeadPanelOverHandler&&Event.stopObserving(this.headPanel,"mouseover",this.onHeadPanelOverHandler);this.onHeadPanelOutHandler&&Event.stopObserving(this.headPanel,"mouseout",this.onHeadPanelOutHandler)},destroyPanel:function(){this.goodsListPanel=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},getNoDataElement:function(){return Builder.node("p",{className:"tips"},["您的购物车还是空的，赶快选购哦。"])},clearBodyPanel:function(){this.bodyPanel.update("")},onHeadPanelOver:function(b){if(!this.headPanel.hasClassName("currshop")){this.headPanel.addClassName("currshop")}},onHeadPanelOut:function(b){if(this.headPanel.hasClassName("currshop")){this.headPanel.removeClassName("currshop")}}});var headTrackClick=function(c){var d="M14_HeadNav";if(typeof tracker!="undefined"){tracker.trackClick(d,c)}};var topMenu=null;var manager=null;function initializeManager(b){topMenu=new TopMenu(b)}function reinitializeManager(){topMenu.close();topMenu.initializeUser()}var loadMiniCart=true;var TopMenu2016=Class.create();Object.extend(TopMenu2016.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetUserInfo2",[],b,"/Service/Manager.msi","get","10000")},getSuggestions:function(d,c){return Mtime.Component.Ajax.request(siteServiceUrl,"Mtime.Service.Pages.UtilityService","GetSuggestionKeywords",[d],c,"/service/utility.msi","get","20000")},addRegisterDayBonus:function(c,d){Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)}},MainNavPageType:{NotSet:0,Home:1,News:2,Theater:3,Community:4,Movie:5,Mall:6},options:{type:1,mainNavPage:0,actionUrl:siteSearchUrl+"/search/",timer:1,showSearchBoxHrefs:["http://theater.mtime.com","http://news.mtime.com/pix","http://i.mtime.com","http://group.mtime.com","http://my.mtime.com","http://piao.mtime.com","http://mall.mtime.com"],pageSearchControlSearchTip:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeData();this.initializeEvent()},initializeField:function(){this.isInitialize=false;this.isInitializeManager=false;this.type=topMenuValues.mainNavType=="Channel"?0:1;this.mainNavPage=topMenuValues.mainNavPage;this.initScrollTop=document.documentElement.scrollTop||document.body.scrollTop},initializeDOM:function(){this.topMenuRegion=$("topMenuRegion");if(!this.topMenuRegion){this.topMenuRegion=$("topbar")}if(this.topMenuRegion){this.addDOM()}},destroyDOM:function(){this.removeDOM();if(this.topMenuRegion){this.topMenuRegion=null}},initializeData:function(){if(!this.topMenuRegion){return}this.topMenuValues=topMenuValues;this.server.getUser(function(g){if(g&&g.value){var h=g.value;this.isLogin=h.userId>0?true:false;this.user={isLogin:this.isLogin,id:h.userId,nickname:h.nickName,homeUrl:h.homeUrl,blogUrl:h.blogUrl,headSrc:h.headSrc,isSaveEmail:h.isSaveEmail,isAutoExit:h.isAutoExit,signupTime:h.signupTime,email:h.email,cityId:h.cityId,cityName:h.cityName,isAnniversary:h.isAnniversary,authorizeUrl:typeof h.authorizeUrl==="undefined"?"":h.authorizeUrl,isVirtual:typeof h.isVirtual==="undefined"?false:h.isVirtual,enableMobileLogin:true,customizeMenus:typeof h.CustomizeMenus==="undefined"?null:h.CustomizeMenus,headSrc128:typeof h.headSrc128==="undefined"?"":h.headSrc128,shortNickName:typeof h.shortNickName==="undefined"?"":h.shortNickName,currentXP:typeof h.currentXP==="undefined"?"0":h.currentXP,level:typeof h.level==="undefined"?"0":h.level,hasPassword:h.hasPassword};var f,e=Globals.getParam("redirectUrl");if(e&&e.trim().length>0){f=e}else{f=encodeURIComponent(location.href)}this.message={receiveCount:h.receiveCount,promptCount:h.promptCount,noticeCount:h.noticeCount,allCount:h.allCount,unreadCount:h.receiveCount+h.promptCount+h.noticeCount};this.urls={mytime:siteMcUrl,signIn:siteUrl+"/member/signin/?redirectUrl="+f,signUp:siteUrl+"/member/signup/?redirectUrl="+f,signOut:siteUrl+"/member/signout/?redirectUrl="+f,siteHelp:siteUrl+"/help/",forgetPasswordUrl:h.forgetPasswordUrl};this.unreadMsgCount=h.allCount;this.render()}}.bind(this))},render:function(){if(this.mainNavPage===this.MainNavPageType.Home&&this.bgLink&&this.topMenuValues&&this.topMenuValues.bgStartDate&&this.topMenuValues.bgEndDate){var d=new Date();var c=new Date(this.topMenuValues.bgEndDate.getFullYear(),this.topMenuValues.bgEndDate.getMonth(),this.topMenuValues.bgEndDate.getDate(),23,59,59);if(this.topMenuValues.bgStartDate<d&&d<c){if(this.topMenuValues.bgUrl){this.bgLink.href=this.topMenuValues.bgUrl;this.bgLink.target="_blank";this.bgLink.addClassName("linkpoint")}else{this.bgLink.href="javascript:void(0)";this.bgLink.removeClassName("linkpoint")}if(this.topMenuValues.bgSrc&&this.topMenuValues.bgSrc.length>0){this.topRegion.style.backgroundImage="url("+this.topMenuValues.bgSrc+")";this.topRegion.style.backgroundPosition="center top";this.topRegion.style.backgroundRepeat="no-repeat"}if(this.topMenuValues.bgHeight>0){this.topRegion.style.height=this.topMenuValues.bgHeight+"px"}if(this.topMenuValues.logoBGColor){this.logoRegion.style.backgroundColor=this.topMenuValues.logoBGColor}if(this.topMenuValues.searchTip){this.pageSearchControlSearchTip=this.topMenuValues.searchTip}}}this.initializeControl()},initializeEvent:function(){if(this.closeButton){this.onClickCloseButtonHandler=this.onClickCloseButton.bindAsEventListener(this);this.closeButton.observe("click",this.onClickCloseButtonHandler)}if(this.searchButton){this.onClickSearchButtonHandler=this.onClickSearchButton.bindAsEventListener(this);this.searchButton.observe("click",this.onClickSearchButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.closeButton){this.closeButton.stopObserving("click",this.onClickCloseButtonHandler)}},initializeControl:function(){if(!this.miniCart&&this.miniCartRegion){this.miniCart=new MiniCart2016({container:this.miniCartRegion,isLogin:this.user.isLogin})}if(!this.userMenu&&this.userLoginRegion){this.userMenu=new UserMenu2016({container:this.userLoginRegion,menu:this.userLoginRegion,userInfo:this.user,urls:this.urls})}if(!this.messageMenu&&this.userMessageRegion){this.messageMenu=new MessageMenu2016({container:this.userMessageRegion,message:this.message,user:this.user,isLogin:this.user.isLogin})}if(!this.appdownloadMenu&&this.appDownloadRegion){this.appdownloadMenu=new AppDownloadMenu({container:this.appDownloadRegion})}var d=0;if(this.mainNavPage==3){d=2}else{if(this.mainNavPage==6){d=4}else{if(this.mainNavPage==2){d=5}}}if(this.searchRegion&&this.suggestRegion){this.searchMenu=new PageSearchControl2016({searchRegion:this.searchRegion,suggestRegion:this.suggestRegion,text:this.pageSearchControlSearchTip,typeRegion:this.searchTypeRegion,typeListRegion:this.searchTypeListRegion,searchType:d})}if(typeof ManagerExecuter!=="function"){var c=[]}else{manager=new ManagerExecuter({managerRegion:this.topMenuRegion,user:this.user,urls:this.urls,customizeMenus:this.user.customizeMenus})}},addDOM:function(){this.topMenuRegion.setAttribute("pn","M16_HeadNav");var o=Builder.node("dl",{className:"headbarnav"});var j="";var n="";var k="";var m="";var l="";var h="";if(this.type===0){if(this.mainNavPage==this.MainNavPageType.Home){j="cur"}if(this.mainNavPage==this.MainNavPageType.Theater){n="cur"}if(this.mainNavPage==this.MainNavPageType.Mall){k="cur"}if(this.mainNavPage==this.MainNavPageType.News){m="cur"}if(this.mainNavPage==this.MainNavPageType.Movie){l="cur"}if(this.mainNavPage==this.MainNavPageType.Community){h="cur"}}o.appendChild(Builder.node("dd",{className:j},[Builder.node("a",{href:"http://www.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Index')",pan:"M16_HeadNav_LeftNav_Index"},["首页",Builder.node("i")])]));o.appendChild(Builder.node("dd",{className:n},[Builder.node("a",{href:"http://theater.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Theater')",pan:"M16_HeadNav_LeftNav_Theater"},["购票",Builder.node("i")])]));o.appendChild(Builder.node("dd",{className:k},[Builder.node("a",{href:"http://mall.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Mall')",pan:"M16_HeadNav_LeftNav_Mall"},["正版商城",Builder.node("i"),Builder.node("em",["hot"])])]));o.appendChild(Builder.node("dd",{className:m},[Builder.node("a",{href:"http://news.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_News')",pan:"M16_HeadNav_LeftNav_News"},["新闻",Builder.node("i")])]));o.appendChild(Builder.node("dd",{className:l},[Builder.node("a",{href:"http://movie.mtime.com/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Recent')",pan:"M16_HeadNav_LeftNav_Recent"},["发现",Builder.node("i")])]));o.appendChild(Builder.node("dd",{className:h},[Builder.node("a",{href:"http://www.mtime.com/community/",onclick:"headTrackClick('M16_HeadNav_LeftNav_Community')",pan:"M16_HeadNav_LeftNav_Community"},["社区",Builder.node("i")])]));this.headerTopLeftRegion=o;this.logoRegion=Builder.node("h1",{onclick:"headTrackClick('M16_HeadNav_MiddleNav')",pan:"M16_HeadNav_MiddleNav"},[Builder.node("a",{title:"Mtime时光网",href:"http://www.mtime.com"},["Mtime时光网"])]);this.searchTypeRegion=Builder.node("div",{className:"selctsearch"},[Builder.node("strong",["全部"]),Builder.node("i"),Builder.node("span",["|"])]);this.searchTypeListRegion=Builder.node("div",{className:"selectshow",style:"display:none;"},[Builder.node("ul",[Builder.node("li",{searchtype:"0",pan:"M16_HeadNav_Search_type0",className:"__r_c_"},["全部"]),Builder.node("li",{searchtype:"1",pan:"M16_HeadNav_Search_type1",className:"__r_c_"},["电影"]),Builder.node("li",{searchtype:"3",pan:"M16_HeadNav_Search_type3",className:"__r_c_"},["影人"]),Builder.node("li",{searchtype:"2",pan:"M16_HeadNav_Search_type2",className:"__r_c_"},["影院"]),Builder.node("li",{searchtype:"4",pan:"M16_HeadNav_Search_type4",className:"__r_c_"},["商品"]),Builder.node("li",{searchtype:"5",pan:"M16_HeadNav_Search_type5",className:"__r_c_"},["新闻"])])]);this.suggestRegion=Builder.node("div",{className:"showsearch",style:"display:none;"});this.bgLink=Builder.node("a",{href:"javascript:void(0)",className:"searchlink"},[]);this.searchRegion=Builder.node("div",{className:"topsearch"},[Builder.node("div",{className:"searchshadow"},[this.searchTypeRegion,this.searchTypeListRegion,Builder.node("input",{type:"text",className:"text",value:"",autocomplete:"off"}),Builder.node("a",{href:"javascript:void(0);",className:"button __r_c_",title:"搜索",pan:"M16_HeadNav_Search_Btn_0"},[Builder.node("i")])]),this.suggestRegion]);this.miniCartRegion=Builder.node("div",{className:"headcart",id:"shopbox",onclick:"headTrackClick('M16_HeadNav_MiniCart_Region')",pan:"M16_HeadNav_MiniCart_Region"});this.userLoginRegion=Builder.node("div",{className:"headtool none",id:"loginbox"});this.userMessageRegion=Builder.node("div",{className:"headtool",id:"emailbox",style:"display:none;"},[Builder.node("i",{className:"line"}),Builder.node("a",{href:"javascript:void(0)",className:"headmessage",id:"headmessage"},[Builder.node("i",{}),Builder.node("em",{className:"ico-message"})])]);this.appDownloadRegion=Builder.node("div",{className:"headtool",id:"appDownloadbox"});if(this.type===0){this.addChannelDOM()}else{this.addDetailDOM()}},removeDOM:function(){if(this.type===0){}else{}},addChannelDOM:function(){var d=this.buildSearchContainer();var c=Builder.node("div",{className:"headbar",id:"headbar"},[this.logoRegion,this.headerTopLeftRegion,this.miniCartRegion,this.userLoginRegion,this.userMessageRegion,this.appDownloadRegion,d]);this.topMenuRegion.appendChild(c);this.topMenuRegion.addClassName("fixed");document.body.style.paddingTop="60px";if(this.mainNavPage==this.MainNavPageType.Home){this.topRegion=Builder.node("div",{className:"tophead"},[this.bgLink,this.searchRegion]);d.hide()}this.topRegion&&this.topMenuRegion.appendChild(this.topRegion)},addDetailDOM:function(){var d=this.buildSearchContainer();var c=Builder.node("div",{className:"headbar head-mini",id:"headbar"},[this.logoRegion,this.headerTopLeftRegion,this.miniCartRegion,this.userLoginRegion,this.userMessageRegion,this.appDownloadRegion,d]);this.topMenuRegion.appendChild(c)},addChannelSearchDOM:function(){var b="";if(this.mainNavPage==this.MainNavPageType.Home){this.topRegion=Builder.node("div",{className:"tophead"},[this.bgLink,this.searchRegion])}else{b=this.buildSubChannelNavDOM();this.topRegion=Builder.node("div",{className:"topmenu"},[Builder.node("div",{className:"topmenuer fix"},[b,this.searchRegion])])}this.topMenuRegion.appendChild(this.topRegion)},buildSubChannelNavDOM:function(){var d=["","","新闻首页","购票首页","社区首页","发现首页","商城首页"];var c=Builder.node("dl",{className:"menunav",id:"submenunav"});c.appendChild(Builder.node("dd",{className:"on"},[Builder.node("a",{href:"javascript:void(0);"},[d[this.mainNavPage]])]));return c},buildSearchContainer:function(){this.searchButton=Builder.node("a",{href:"javascript:void(0)",className:"headzoom"},[Builder.node("em",{className:"zoom",title:"搜索",pan:"M16_HeadNav_Sreach_Tool_Zoom"})]);var b=Builder.node("div",{className:"headtool",id:"searchbox"},[this.searchButton,Builder.node("div",{className:"headsearch",style:"width:395px;display:none;"},[this.searchRegion])]);return b},onClickSearchButton:function(m){var l=Event.element(m);var j=l.up("div.headtool");var o=j.down("div.headsearch");var n=Position.page(this.logoRegion)[0];var k=Position.page(j)[0];var h=k-n;if(l.tagName.toUpperCase()=="EM"){if(l.hasClassName("cancel")){l.removeClassName("cancel");l.addClassName("zoom");l.title="搜索";l.setAttribute("pan","M16_HeadNav_Sreach_Tool_Zoom");o.hide();this.logoRegion.show();headTrackClick("M16_HeadNav_Sreach_Tool_Cancel")}else{if(l.hasClassName("zoom")){l.removeClassName("zoom");l.addClassName("cancel");l.title="取消";l.setAttribute("pan","M16_HeadNav_Sreach_Tool_Cancel");this.logoRegion.hide();o.show();$(o).setStyle({width:h+"px"});headTrackClick("M16_HeadNav_Sreach_Tool_Zoom")}}}},topscrollWindow:function(){var o=document.documentElement.scrollTop||document.body.scrollTop;var n=o>this.initScrollTop?"down":"up";this.initScrollTop=o;var h=this.topMenuRegion?this.topMenuRegion.getBoundingClientRect().top:NaN;var l=window.innerheight||document.documentElement.clientHeight;var m=false;if(h+l<0){m=false}else{m=true}var j=$$("div.headbar")[0];var k=j.getHeight();if(n==="up"&&!m){if(this.topMenuRegion.hasClassName("fixed")){}else{j.setStyle({position:"fixed",top:"0px"});this.topMenuRegion.addClassName("fixed")}if(j.hasClassName("head-mini")){}else{document.body.style.paddingTop=k+"px";j.addClassName("head-mini")}}if(j.hasClassName("head-mini")){if(n==="down"){this.topMenuRegion.removeClassName("fixed");j.removeClassName("head-mini");j.setStyle({position:"",top:""});document.body.style.paddingTop=""}else{if(o<=0){this.topMenuRegion.removeClassName("fixed");j.removeClassName("head-mini");j.setStyle({position:"",top:""});document.body.style.paddingTop=""}}}},removeChannelDOM:function(){},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var MessageMenu2016=Class.create();Object.extend(MessageMenu2016.prototype,{server:{getUnreadMessages:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","GetUnreadMessages",[true],b,"/Service/Message.msi","get","20000")},addRegisterDayBonus:function(c,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ScoreService","AddRegisterDayBonus",[],c,"/Service/Score.msi","get","20000",d)},clearAllUnreadCount:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.MessageService","ClearAllUnreadCount",[],b,"/Service/Message.msi","get","20000")}},options:{container:null,user:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeEvent();this.render()},initializeEvent:function(){Event.observe(this.container,"click",this.onClickContainer.bindAsEventListener(this))},render:function(){this.getUnReadMessage();if(this.isLogin){this.container.show()}},onClickContainer:function(h){var g=Event.element(h);var j=this.container.down("#headmessage");var k=this.container.down('[_type="message"]');if(g.tagName.toUpperCase()=="EM"&&g.hasClassName("close")){if(k){k.remove();j.removeClassName("cur");this.server.clearAllUnreadCount(null)}var m=getCookie("virtualuser");if(this.user.isVirtual&&(typeof(m)==="undefined"||m!=="virtualuser")){setCookie("virtualuser","virtualuser")}}else{if(!this.user.isAnniversary){var l=siteMcUrl+"/message/usermessage/";$redirect(l)}}},getUnReadMessage:function(){this.server.getUnreadMessages(function(w){var p=null;var r=this.user.isAnniversary;if(r){p=Builder.build('<p _type="anniversary"><em title="关闭"></em><a href="javascript:void(0);" onclick="return false;">注册周年积分奖励，点击领取</a></p>')}var s=this.user.isVirtual;var x=s;if(s){var z=getCookie("virtualuser");if(z&&z==="virtualuser"){x=false}}var t=this.container.down('[_type="message"]');t&&t.remove();t=null;if((!w||!w.value)&&!p&&!x){return}else{if(w&&w.value){t=Builder.build(w.value);var y='<em class="close" id="closeMessageTip"></em>'+t.innerHTML;t.addClassName("headtip");t.addClassName("message-tip");t.innerHTML=y;this.container.down(".headmessage").addClassName("cur")}else{t=Builder.build('<div class="headtip message-tip" _type="message"><em class="close" id="closeMessageTip"></em></div>')}this.container.appendChild(t);t.style.display="block";if(p){t.appendChild(p);var v=this.user.nickname;var q=this.closeMsg.bind(this);var u=this.container;var o=this.server.addRegisterDayBonus;Event.observe(p,"click",function(){var a=new Dialog({title:"注册周年积分奖励!",windowClassName:"w420",content:"<div>亲爱的"+v+"，感谢你对时光网一年的支持，时光网有你更精彩。</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"领取",buttonStyle:"btn_blue mr12",callback:function(){var b=u.down('[_type="anniversary"]');b&&b.remove();var c=u.down("#headmessage");var d=t.immediateDescendants();if(d.length===0){t.remove();c.removeClassName("cur")}o();a.close()}}]})}.bind(this))}if(x&&this.user.authorizeUrl){var A=Builder.build(String.format('<p><em title="关闭"></em>完善信息后，服务更安全 <a href="{0}">立即设置</a></p>',this.user.authorizeUrl));t.appendChild(A)}}}.bind(this))},closeMsg:function(d){var e=Event.element(d);var f=e.up(0);if(e.tagName.toUpperCase()=="EM"&&f&&f.tagName.toUpperCase()=="P"){this.container.down('[_type="message"]').remove()}}});var UserMenu2016=Class.create();Object.extend(UserMenu2016.prototype,{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(j,m,l,k,o,n,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[j,m,l,k,o,n],h,"/utility/managerservice.m","get","10000")},signOut:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","SignOut",[],b,"/Service/Manager.msi","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")},getXpAndLevel:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteGoodsServiceUrl,"Mtime.Ecommerce.Services","GetUserXpAndLevel",[d],c,"/Member.api","get","60000")},getCouponsForLogin:function(b){return Mtime.Component.Ajax.get("Mtime.Service.Pages.ManagerService","GetCouponsForLogin",[],b,"/Service/Manager.msi","get","10000","")}},options:{container:null,menu:null,userInfo:null,urls:null,onSignInCallback:null,hasLoadXpAndLevel:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeData();this.initializeDOM();this.render();this.initializeEvent()},initializeData:function(){this.useProtocol="https";this.findPwdHref="https://passport.mtime.com/findpwd/phone"},initializeDOM:function(){this.loginNameText=Builder.node("input",{type:"text",value:"输入电子邮箱/手机号",className:"tip"});this.passwordText=Builder.node("input",{type:"password",value:"",className:"tip"});this.autoLoginCheckBox=Builder.node("i",{className:"ico_m_check"},[""]);this.signInButton=Builder.node("a",{href:"javascript:void(0);",className:"btnblue __r_c_",pan:"M16_HeadNav_User_SignInBtn"},["登录"]);this.registerButton=Builder.node("a",{href:"javascript:void(0);",className:"btngrey __r_c_",pan:"M16_HeadNav_User_RegBtn"},["成为会员"]);this.vcodeText=Builder.node("input",{type:"text",value:"输入验证码",className:"tip"});this.refreshVcodeButton=Builder.node("a",{href:"javascript:void(0);"},["刷新"]);this.signOutButton=Builder.node("a",{href:"javascript:void(0);",className:"btngrey __r_c_",pan:"M16_HeadNav_User_Signout"},["登出"])},initializeEvent:function(){Event.observe(this.menu,"click",this.onClickMenu.bind(this));if(this.userInfo.isLogin){this.initializeLoginEvent()}else{this.initializeUnloginEvent();this.onClickHandler=this.onClick.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickHandler)}},onClick:function(f){var g=Event.pointerX(f);var h=Event.pointerY(f);var e=Event.element(f);if(this.unloginRegion&&this.menu!==e.up("div#loginbox")&&this.unloginRegion!==e.up("div.login-tip")&&!Position.within(this.container,g,h)&&!Position.within(this.unloginRegion,g,h)){if(!this.userInfo.isLogin){if(this.unloginRegion.visible()){this.headLoginButton.removeClassName("cur");this.unloginRegion.hide()}}}},initializeLoginEvent:function(){this.signOutButton.observe("click",this.onClickSignOutButton.bind(this))},initializeUnloginEvent:function(){new Textbox({text:this.loginNameText,watermarkText:"输入电子邮箱/手机号"});new Textbox({text:this.passwordText,watermarkText:""});new Textbox({text:this.vcodeText,watermarkText:"输入验证码"});this.autoLoginCheckBox.observe("click",this.onClickAutoLoginCheckBox.bind(this));this.signInButton.observe("click",this.onClickSignInButton.bind(this));this.registerButton.observe("click",this.onClickRegisterButton.bind(this));this.headSigninButton.observe("click",this.onClickRegisterButton.bind(this));this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.loginNameText,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passwordText,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.refreshVcodeButton,"click",this.refreshVcodeHandler);document.onkeydown=function(){var b=window.event;if(typeof b!=="undefined"&&b.keyCode===13){this.onClickSignInButton()}}.bind(this)},render:function(){if(this.userInfo.isLogin){var j=Builder.node("i",{className:"line"});var m=Builder.node("a",{href:"javascript:void(0);",title:this.userInfo.nickname,onclick:"headTrackClick('M16_HeadNav_User_Nickname')",pan:"M16_HeadNav_User_Nickname"},[Builder.node("img",{height:"44",width:"44",src:this.userInfo.headSrc128,alt:this.userInfo.nickname}),Builder.node("em",[this.getShowNickName(this.userInfo.nickname)]),Builder.node("b",{}),Builder.node("i",{})]);this.userNickname=m;var l=Builder.node("div",{className:"headlogin"},[this.userNickname]);this.menu.appendChild(j);this.menu.appendChild(l);this.loginRegion=this.buildLoginDOM();this.loginRegion.hide();this.container.appendChild(this.loginRegion);if(!this.userInfo.isAutoExit){this.autoLoginCheckBox.addClassName("ico-checkend")}this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.menu,contentRegion:this.loginRegion,onOverCallback:this.onOverCallback.bind(this),onOutCallback:this.onOutCallback.bind(this),outTimeout:1})}else{var j=Builder.node("i",{className:"line"});var g=Builder.node("a",{href:"javascript:void(0);",onclick:"headTrackClick('M16_HeadNav_User_SignIn')",pan:"M16_HeadNav_User_SignIn"},["登录",Builder.node("i")]);var h=Builder.node("a",{href:"javascript:void(0);",onclick:"headTrackClick('M16_HeadNav_User_Reg')",pan:"M16_HeadNav_User_Reg"},["注册"]);this.headLoginButton=g;this.headSigninButton=h;var l=Builder.node("div",{className:"headunlogin"},[this.headLoginButton,Builder.node("em"),this.headSigninButton]);this.menu.appendChild(j);this.menu.appendChild(l);this.unloginRegion=this.buildUnloginDOM();var k=Builder.build('<dl class="otherlogin"><dt>使用第三方登录</dt><dd><a href="'+this.useProtocol+'://passport.mtime.com/unitelogin/dispatch/weibo/web/" title="新浪" class="ico-sina __r_c_" pan="M16_HeadNav_User_SignInSina"></a><a href="'+this.useProtocol+'://passport.mtime.com/unitelogin/dispatch/qq/web/" title="QQ" class="ico-qq __r_c_" pan="M16_HeadNav_User_SignInQq"></a></dd></dl>');this.unloginRegion.appendChild(k);this.unloginRegion.hide();this.container.appendChild(this.unloginRegion);this.loginNameText.value=this.userInfo.email}this.menu.removeClassName("none")},getShowNickName:function(o){var m=0,j=o.split(""),q=[];var n=5*2;var l=j.length;var p=o.replace(/[^\u0000-\u00ff]/g,"aa").length;if(p>n){for(var k=0;k<l;++k){if(j[k].charCodeAt(0)<299){m++;if(m<n-1){q.push(j[k])}}else{m+=2;if(m<=n-2){q.push(j[k])}}}o=q.join("")+"..."}return o},showVcodeRegion:function(){$(this.vcodeText.parentNode).show();if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down();this.vcodeImageRegion.show()}}.bind(this))}else{this.refreshVcode();this.vcodeImageRegion.show()}},hideVcodeRegion:function(){if(this.vcodeText){$(this.vcodeText.parentNode).hide()}if(this.vcodeImageRegion){this.vcodeImageRegion.hide()}},onOverCallback:function(){if(!this.userNickname.hasClassName("cur")){this.userNickname.addClassName("cur");if(this.userInfo.isLogin&&!this.hasLoadXpAndLevel){this.server.getXpAndLevel(this.userInfo.id,function(b){if(b&&b.value){$("topMenuLevelContainer").innerHTML="M"+b.value.level;this.hasLoadXpAndLevel=true}this.server.getCouponsForLogin(function(a){if(a&&a.value){if(a.value.totalCount==0){$("myCouponsCount").innerHTML="我的优惠券"}else{$("myCouponsCount").innerHTML="我的优惠券("+a.value.totalCount+")"}if(a.value.mtimeCardCount==0){$("myMtimeCardCount").innerHTML="我的礼品卡"}else{$("myMtimeCardCount").innerHTML="我的礼品卡("+a.value.mtimeCardCount+")"}if(a.value.willEndCount>0){$("couponWillEndContainer").show();$("urlEcommerceOrMovie").href=a.value.urlEcommerceOrMovie;$("willEndCount").innerHTML=a.value.willEndCount}else{$("couponWillEndContainer").hide()}}}.bind(this))}.bind(this))}}},onOutCallback:function(){if(this.userNickname.hasClassName("cur")){this.userNickname.removeClassName("cur")}},isShowing:function(){return this.loginRegion.style.display!="none"},onClickMenu:function(d){var c=Event.element(d);if(c.up("div.headtip")){return}if(this.userInfo.isLogin){if(this.isShowing()){this.loginRegion.hide();this.onOutCallback()}else{this.loginRegion.style.display="block";this.onOverCallback()}}else{if(this.unloginRegion.visible()){this.headLoginButton.removeClassName("cur");this.unloginRegion.hide()}else{this.unloginRegion.style.display="block";this.headLoginButton.addClassName("cur")}}},onClickRegisterButton:function(){if(typeof sitePassportUrl==="undefined"){sitePassportUrl="http://passport.mtime.com"}sitePassportUrl=this.useProtocol+"://passport.mtime.com";var b=sitePassportUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},onClickVcodeText:function(){if(!this.vcodeImageRegion){this.server.refreshVcode(function(b){if(b&&b.value&&b.value.id){this.vcodeImageRegion=this.buildVcodeImageDOM(b.value.src);this.vcodeText.parentNode.parentNode.appendChild(this.vcodeImageRegion);this.vcodeId=b.value.id;this.vcodeImage=this.vcodeImageRegion.down().down()}}.bind(this))}},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeText.value="";this.vcodeText.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var c=this.loginNameText.value.trim(),d=true;if(this.userInfo.enableMobileLogin){if(!Validator.Email.test(c)&&!Validator.MobilePhone.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}else{if(!Validator.Email.test(c)){$(this.loginNameText.parentNode).addClassName("false");d=false}else{$(this.loginNameText.parentNode).removeClassName("false")}}return d},checkPassword:function(){var c=this.passwordText.value,d=true;if(!Validator.Password.test(c)){$(this.passwordText.parentNode).addClassName("false");d=false}else{$(this.passwordText.parentNode).removeClassName("false")}return d},checkVcode:function(){var d=this.vcodeText.value.trim(),c=true;if(!d){$(this.vcodeText.parentNode).addClassName("false");c=false}else{$(this.vcodeText.parentNode).removeClassName("false")}return c},onClickSignInButton:function(){var e=this.loginNameText.value;var f=$encodePassword(this.passwordText.value);var d=!this.autoLoginCheckBox.hasClassName("ico-checkend");if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.server.signIn(e,f,true,d,this.vcodeId||"",this.vcodeId?this.vcodeText.value:"",function(a){this.lock=false;if(a&&a.value){if(a.value.success){this.callback&&this.callback(a.value);location.reload()}else{if(a.value.isShieldStatus){this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.showResetPasswordDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.showVcodeRegion();if(!a.value.vcodeValid){$(this.vcodeText.parentNode).addClassName("false")}return}else{this.hideVcodeRegion();this.vcodeId=null}$(this.loginNameText.parentNode).addClassName("false");$(this.passwordText.parentNode).addClassName("false")}}}}}}.bind(this))}},onClickSignOutButton:function(){this.server.signOut(function(b){if(b&&b.value){location.reload()}})},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPasswordDialog:function(b){this.needResetPwdDialog=new Dialog({title:"很抱歉，账户已被冻结",windowClassName:"w375",content:'<div class="yahei px14 tc bold">由于长时间未登录，账户已被临时冻结。<br/>请点击按钮，重新邮件激活。 </div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"立即激活",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onClickAutoLoginCheckBox:function(){if(this.autoLoginCheckBox.hasClassName("ico-checkend")){this.autoLoginCheckBox.removeClassName("ico-checkend")}else{this.autoLoginCheckBox.addClassName("ico-checkend")}},buildLoginDOM:function(){var j=Builder.node("div",{className:"headtip user-tip"});var f=Builder.node("div",{className:"my-name"});var g=Builder.node("dl",{className:"my-business fix"});var h=Builder.node("div",{className:"my-couptip",id:"couponWillEndContainer",style:"display:none;"});var k=Builder.node("ul",{className:"my-app"});f.appendChild(Builder.node("a",{className:"my-pic __r_c_",href:siteMcUrl,pan:"M16_HeadNav_User_UserHead"},[Builder.node("img",{src:this.userInfo.headSrc128,width:"96",height:"96"})]));f.appendChild(Builder.node("dl",[Builder.node("dt",[Builder.node("a",{href:siteMcUrl,pan:"M16_HeadNav_User_Nickname",className:"__r_c_"},[this.userInfo.shortNickName]),Builder.node("a",{href:"http://vip.mtime.com/myprivilege",pan:"M16_HeadNav_User_Vip",className:"__r_c_"},Builder.node("span",{id:"topMenuLevelContainer"},["M0"]))]),Builder.node("dd",[Builder.node("a",{href:"http://vip.mtime.com/myprivilege/",pan:"M16_HeadNav_User_Privilege",className:"__r_c_"},["我的特权"]),Builder.node("i",{className:"c_a5 mlr5"},["|"]),Builder.node("a",{href:"http://vip.mtime.com/gift/",pan:"M16_HeadNav_LoginBox_VipsuserPackage",className:"__r_c_"},["会员礼包"])])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/",pan:"M16_HeadNav_User_Ticket",className:"__r_c_"},["电影票订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{href:siteMcUrl+"/account/ecommerce/orderList/",pan:"M16_HeadNav_User_Order",className:"__r_c_"},["商品订单"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myCouponsCount",href:siteMcUrl+"/account/voucher/",pan:"M16_HeadNav_User_Voucher",className:"__r_c_"},["我的优惠券"])]));g.appendChild(Builder.node("dd",[Builder.node("a",{id:"myMtimeCardCount",href:siteMcUrl+"/account/moviecard/",pan:"M16_HeadNav_User_Card",className:"__r_c_"},["我的礼品卡"])]));h.appendChild(Builder.node("i"));h.appendChild(Builder.node("p",{pan:"M16_HeadNav_User_Coupend",className:"__r_c_"},["您有",Builder.node("b",{id:"willEndCount"},["0"]),"张优惠券即将过期 ",Builder.node("a",{href:siteMcUrl+"/account/voucher/ecommerce/",id:"urlEcommerceOrMovie"},["点击查看"])]));k.appendChild(Builder.node("li",{pan:"M16_HeadNav_User_MyMtime",className:"__r_c_"},[Builder.node("p",["我的：",Builder.node("a",{href:siteMcUrl+"/app/blog/"},["博客"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/group/"},["群组"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/movie/"},["电影"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/favorite/"},["收藏"])]),Builder.node("p",["游戏：",Builder.node("a",{href:siteMcUrl+"/app/card/"},["卡片大富翁"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/app/quiz/"},["猜电影"])])]));if(this.userInfo.hasPassword==true){k.appendChild(Builder.node("li",{className:"fix"},[this.signOutButton,Builder.node("a",{href:siteMcUrl+"/profile/basic/",className:"__r_c_",pan:"M16_HeadNav_User_ChangeId"},["修改资料"]),Builder.node("em",["|"]),Builder.node("a",{href:siteMcUrl+"/profile/password/",className:"__r_c_",pan:"M16_HeadNav_User_ChangePw"},["密码"])]))}else{k.appendChild(Builder.node("li",{className:"fix"},[this.signOutButton,Builder.node("a",{href:siteMcUrl+"/profile/basic/",className:"__r_c_",pan:"M16_HeadNav_User_ChangeId"},["修改资料"])]))}j.appendChild(f);j.appendChild(g);j.appendChild(h);j.appendChild(k);return j},buildUnloginDOM:function(){var b=Builder.node("div",{className:"headtip login-tip"},[Builder.node("dl",{className:"logintool"},[Builder.node("dt",[Builder.node("strong",["为爱电影的人"])," For people who love movies"]),Builder.node("dd",{className:"userlogin"},[Builder.node("ul",[Builder.node("li",{className:""},[Builder.node("label",{className:"name"},["用户名："]),this.loginNameText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:""},[Builder.node("label",{className:"password"},["输入密码："]),this.passwordText,Builder.node("i",{className:"ico_false"},[])]),Builder.node("li",{className:"",style:"display:none"},[Builder.node("label",{className:"code"},["输入验证码："]),this.vcodeText,Builder.node("i",{className:"ico_false"},[])])]),Builder.node("p",{className:"usertip"},[Builder.node("a",{href:this.findPwdHref,target:"_blank",className:"fr"},["忘记密码"]),this.autoLoginCheckBox,"记住我"]),Builder.node("div",{className:"loginbtn"},[this.signInButton,this.registerButton])])])]);return b},buildVcodeImageDOM:function(c){var d=Builder.node("li",{className:"codetxt"},[Builder.node("span",{id:"img_vcode"},[Builder.node("img",{width:"90",height:"45",src:c,style:"cursor:pointer",className:"v_m mr6"})]),this.refreshVcodeButton]);return d}});var CityMenu=Class.create();Object.extend(CityMenu.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{userInfo:null,items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"热门",container:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){this.headPanel=$(this.container);this.closeNode=Builder.node("span",{className:"btn_close fr"},["关闭"]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"text"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on",_v:"热门"},["热门",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"A-G"},["A-G",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"H-L"},["H-L",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"M-T"},["M-T",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"W-Z"},["W-Z",Builder.node("b",[" "])])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip",style:"display:none;width: 560px; position: absolute; top: 35px; right: 0px;"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,Builder.node("div",{className:"citysearch"},[this.searchCityText]),this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));this.headPanel.appendChild(Builder.node("span",{className:"currcity"},["我在："+this.userInfo.cityName]));this.headPanel.appendChild(Builder.node("i",{className:"ico_city"}));this.headPanel.parentNode.insertBefore(this.bodyPanel,this.headPanel);var c=this.tab.childNodes;for(var d=0;d<c.length;d++){Event.observe(c[d],"click",function(e){var a=e.target||e.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(f){f.className=""});a.className="on";var b=a.readAttribute("_v");this.order=b;this.reload(b)}}.bind(this))}this.headPanel.style.display="block"},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler);Event.observe(this.closeNode,"click",this.onCloseHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onHeadPanelClickHandler&&Event.stopObserving(this.headPanel,"click",this.onHeadPanelClickHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.container,e,f)&&!Position.within(this.bodyPanel,e,f)){if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}}},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(k){this.contentBox.update();var f=null;switch(k){case"热门":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);break;case"A-G":if(!this.content.AG){f=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(f,this.content.regRxpAG)}this.contentBox.update(this.content.AG);break;case"H-L":if(!this.content.HL){f=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(f,this.content.regRxpHL)}this.contentBox.update(this.content.HL);break;case"M-T":if(!this.content.MT){f=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(f,this.content.regRxpMT)}this.contentBox.update(this.content.MT);break;case"W-Z":if(!this.content.WZ){f=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(f,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);break;default:break}var j=this.contentBox.getElementsByTagName("li");for(var h=0,g=j.length;h<g;h++){Event.observe(j[h],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(h,k){var o=new StringBuilder();for(var l=0,j=k.length;l<j;l++){var n=k[l];var m=h.findAll(function(a){return a.initial===n}).sortBy(function(a){return -a.VisitedTimes});if(m.length>0){o.append(this.createOptions(m,n))}}return o.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("热门");this.cityAutoComplete=new CityAutoComplete({text:this.searchCityText,textWatermarkText:"直接输入城市或城市拼音",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(f){var h=this.contentBox.getElementsByTagName("li");for(var g=0,e=h.length;g<e;g++){if(h[g].className==="on"){this.command(h[g].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(k,h,j){var l=Builder.node("div");var m=new StringBuilder();m.append('<div class="city_list2 clearfix">');m.append('<span class="fl w30 bold mt5">'+h+"</span>");m.append("<ul>");for(var g=0;g<k.length;g++){if(j&&g!==0&&(g%this.HOTROWSIZE===0)){m.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}m.append(this.optionTemplate.evaluate(k[g]))}m.append("</ul>");m.append("</div>");return m.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(b){b&&Event.stop(b);if(this.isShowing()){this.hide();this.headPanel.removeClassName("oncity")}else{this.show();this.headPanel.addClassName("oncity")}},isShowing:function(){return(this.bodyPanel.style.display!="none")},show:function(){this.bodyPanel.show()},hide:function(){this.bodyPanel.hide()},command:function(f){if(f!==null){setCookie("DefaultCity-CookieKey",f);var h="http://theater."+mtimeCookieDomain+"/[^/]+";var k=["/","/cinema/","/movie/","/ecoupon/","/ticket/","/card/","/movie/\\d+/","/discount/","/discount/information/","/discount/coupon/","/movie/lastday/"];var j=null;var g=k.find(function(a){var b=new RegExp(("^"+h+"("+a+")$").replace(/\//g,"\\/"));j=(location.protocol+"//"+location.host+location.pathname).match(b);return j&&j.length==2});if(!g){location.reload()}this.server.getTheaterCityHomeURL(f,function(a){if(a&&a.value){if(g){$redirect(a.value.replace(/\/$/,"")+j[1])}else{if(callbackUrl){$redirect(callbackUrl)}else{$redirect(a.value)}}}})}},getCitys:function(o,l){var m=[];for(var n=0;n<l.length;n++){var k=l[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<l.length){var q=l.length-m.length;for(var p=0;p<o.length;p++){if(q===0){break}if(!l.include(o[p].Id)){m.push(o[p]);q--}}}return m},getCity:function(h,e){for(var f=0,g=h.length;f<g;f++){if(e==h[f].Id){return h[f]}}return null}});var CityAutoComplete=Class.create();Object.extend(Object.extend(CityAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(e){this.active=false;var f=this.listRegion.getElementsByTagName("li");var d=f.length;if(d>e&&e>=0){return $(f[e])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="输入中文/拼音或按&uarr;&darr;选择"}else{if(d>0){this.listTipText=c+"，按拼音数排序"}else{this.listTipText="对不起，找不到："+c}}},renderList:function(l,o){var j='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+o+"</ul></div></div>";this.listRegion.update(j);var n=this.listRegion.getElementsByTagName("li");for(var k=0,h=n.length;k<h;k++){var m=n[k];m.style.cursor="pointer";Event.observe(m,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(m,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(m,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(n.length>0){n[0].className="on"}}});var TopMenuNavigationMenu=Class.create();Object.extend(TopMenuNavigationMenu.prototype,{options:{menuRegion:null,contentRegion:null,onOverCallback:null,onOutCallback:null,overTimeout:1,outTimeout:100},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent()},initializeField:function(){this.outMenuTimer=null;this.overMenuTimer=null},initializeEvent:function(){this.onOverMenuHandler=this.onOverMenu.bindAsEventListener(this);this.menuRegion.observe("mouseover",this.onOverMenuHandler);this.contentRegion.observe("mouseover",this.onOverMenuHandler);this.onOutMenuHandler=this.onOutMenu.bindAsEventListener(this);this.menuRegion.observe("mouseout",this.onOutMenuHandler);this.contentRegion.observe("mouseout",this.onOutMenuHandler);this.onClickMenuHandler=this.onClickMenu.bindAsEventListener(this);this.menuRegion.observe("click",this.onClickMenuHandler)},destroyEvent:function(){this.menuRegion.stopObserving("mouseover",this.onOverMenuHandler);this.menuRegion.stopObserving("mouseout",this.onOutMenuHandler);this.menuRegion.stopObserving("click",this.onClickMenuHandler)},onOverMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.overMenuTimer=FunctionExt.defer(function(){this.onMenuOverCallback()},this.overTimeout,this)},onOutMenu:function(b){this.handleOverMenuTimer();this.handleOutMenuTimer();this.outMenuTimer=FunctionExt.defer(function(){this.onMenuOutCallback()},this.outTimeout,this)},handleOverMenuTimer:function(){if(this.overMenuTimer!==null){clearTimeout(this.overMenuTimer);this.overMenuTimer=null}},handleOutMenuTimer:function(){if(this.outMenuTimer!==null){clearTimeout(this.outMenuTimer);this.outMenuTimer=null}},onClickMenu:function(b){this.onOverMenu()},onMenuOverCallback:function(){if(!this.contentRegion.visible()){this.contentRegion.show()}if(this.onOverCallback){this.onOverCallback()}},onMenuOutCallback:function(){if(this.contentRegion.visible()){this.contentRegion.hide()}if(this.onOutCallback){this.onOutCallback()}}});var SearchAutoComplete=Class.create();Object.extend(Object.extend(SearchAutoComplete.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.isAlwayShowList=false;this.isShowMoreResult=false},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();this.selectedEntry(b)},getEntry:function(c){var d=null;if(c>=0){d=$(this.listRegion.childNodes[c])}return d},getOption:function(d){var f=null;var e=this.idFieldName;this.searchDatas.each(function(a){if(a[e]==d){f=a;throw $break}});return f},render:function(){if(this.getSearchDataCallback!==null){this.getSearchDataCallback(function(b){this.searchDatas=b;this.doRender()}.bind(this))}else{this.doRender()}},getMoreLists:function(){var m=this.searchDatas,l=null,j=new StringBuilder(),k=0;for(var h=0,g=m.length;h<g;h++){l=m[h];j.append(this.createListItem(l));k++;this.searchIndex=h}this.entryCount+=k;return j.toString()},renderList:function(c,d){this.listRegion.innerHTML=d},onClickText:function(){this.render()},createListItem:function(d){var c=this.itemTemplate.evaluate(d);c=c.replace("<em >被查询 0 次</em>","");return c}});var MiniCart2016=Class.create();Object.extend(MiniCart2016.prototype,{server:{getCartList:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","GetMiniCartList",[true],b,"/Service/Trade.p","get","60000")},removeCartItem:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteTradeServiceUrl,"Mtime.Trade.Pages.TradeService","RemoveCartItemsBySkus",[d],c,"/Service/Trade.p","get","60000")}},options:{container:null,isLogin:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var d=Builder.node("i",{className:"icocart"});Event.observe(d,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});var c=Builder.node("b",{className:"numcart",id:"emGoodsCount",style:"display:none;"},[0]);Event.observe(c,"click",function(){window.location.href=siteTradeServiceUrl+"/cart/"});this.headPanel.appendChild(d);this.headPanel.appendChild(c);this.bodyPanel=Builder.node("div",{className:"headtip headcart-tip",style:"display:none;"});this.bodyPanel.appendChild(this.getNoDataElement());this.headPanel.appendChild(this.bodyPanel)},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.bodyPanel,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this)});this.deleteRegionClickHandler=this.deleteRegionClick.bind(this);this.bodyPanel.observe("click",this.deleteRegionClickHandler)},render:function(){this.server.getCartList(function(c){if(c&&c.value){this.clearBodyPanel();var d=c.value.count;if(d>0){$("emGoodsCount").innerHTML=d;$("emGoodsCount").show()}else{$("emGoodsCount").hide()}if(d>0){this.bodyPanel.innerHTML=c.value.html}else{this.bodyPanel.appendChild(this.getNoDataElement())}}}.bind(this))},deleteRegionClick:function(k){var j=Event.element(k);var m=j.readAttribute("method");while(!m&&j!=document.body){j=j.up();m=j.readAttribute("method")}if(!m){return}var h=j.readAttribute("actid");var o=j.readAttribute("sku").split("|");var n="";for(var l=0;l<o.length;l++){if(n.length>0){n+=","}n+=o[l]+"|"+h+"|false"}this.server.removeCartItem(n,function(a){if(a&&a.value&&a.value.success){this.render()}}.bind(this))},destroyEvent:function(){this.onHeadPanelOverHandler&&Event.stopObserving(this.headPanel,"mouseover",this.onHeadPanelOverHandler);this.onHeadPanelOutHandler&&Event.stopObserving(this.headPanel,"mouseout",this.onHeadPanelOutHandler)},destroyPanel:function(){this.goodsListPanel=null;this.bodyPanel=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()},getNoDataElement:function(){return Builder.node("p",{className:"tips"},["您的购物车还是空的，赶快选购哦。"])},clearBodyPanel:function(){this.bodyPanel.update("")},onHeadPanelOver:function(b){},onHeadPanelOut:function(b){}});var AppDownloadMenu=Class.create();function AppDownloadQRcodeJsonp(b){document.getElementById("qrcodeimg").innerHTML=('<img src="'+b.imageUrl+'" alt="扫描二维码下载APP" />')}Object.extend(AppDownloadMenu.prototype,{server:{getQcode:function(b){return Mtime.Component.Ajax.crossDomainCallBack("http://www.mtime.com","","",[true],b,"/api/download-app?callback=AppDownloadQRcodeJsonp","get","60000")}},options:{container:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.render()},initializeDOM:function(){this.headPanel=$(this.container);var b=Builder.node("i",{className:"line"});this.appMenuRegion=Builder.node("a",{href:"javascript:void(0)",className:"headqr",onclick:"headTrackClick('M16_HeadNav_Qrcode_Btn')",pan:"M16_HeadNav_Qrcode_Btn"},[Builder.node("i",{}),Builder.node("em",{className:"ico-app"}),Builder.node("span",{},["App下载"]),Builder.node("b",{})]);this.appContentRegion=Builder.node("div",{className:"headtip qrcode-tip",style:"display:none;"},[Builder.node("a",{href:"http://feature.mtime.com/mobile/",target:"_blank",onclick:"headTrackClick('M16_HeadNav_Qrcode_Down')",pan:"M16_HeadNav_Qrcode_Down"},[Builder.node("i",{className:"qrcode",id:"qrcodeimg"})]),]);this.headPanel.appendChild(b);this.headPanel.appendChild(this.appMenuRegion);this.headPanel.appendChild(this.appContentRegion)},render:function(){this.server.getQcode(function(b){}.bind(this))},initializeEvent:function(){this.navigationMenu=new TopMenuNavigationMenu({menuRegion:this.headPanel,contentRegion:this.appContentRegion,onOverCallback:this.onHeadPanelOver.bind(this),onOutCallback:this.onHeadPanelOut.bind(this),outTimeout:1})},onHeadPanelOver:function(){if(!this.appMenuRegion.hasClassName("cur")){this.appMenuRegion.addClassName("cur")}},onHeadPanelOut:function(){if(this.appMenuRegion.hasClassName("cur")){this.appMenuRegion.removeClassName("cur")}},destroyEvent:function(){},destroyPanel:function(){this.appContentRegion=null;this.headPanel=null},close:function(){this.destroyEvent();this.destroyPanel()}});var headTrackClick=function(c){var d="M16_HeadNav";if(typeof tracker!="undefined"){tracker.trackClick(d,c)}};var topMenu=null;var manager=null;function initializeManager(b){topMenu=new TopMenu2016(b)}function initializeManager2016(b){topMenu=new TopMenu2016(b)}function reinitializeManager(){topMenu.close();topMenu.initializeUser()}var StaticManager=Class.create();StaticManager.prototype={options:{mainNavigaionType:-1,subNavigaionType:-1,isMini:false,isChannelFooter:false,is2011MiniFooter:false,showTopSearch:true,showTopSearchInChannel:false,useNewNavigation:true},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},server:{createSubscriber:function(d,c){return Mtime.Component.Ajax.request(siteChannelServiceUrl,"Mtime.Channel.Pages.DatabaseService","CreateSubscriber",[d],c,"/service/Database.mcs","get","20000")}},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeEvent();this.load();this.render()},initializeField:function(){},initializeDOM:function(){this.topRegion=$("top");this.bottomRegion=$("bottom")},destroyDOM:function(){this.topRegion=null;this.bottomRegion=null;this.iptEMail=this.btnSubscribe=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.btnSubscribe){this.btnSubscribe.stopObserving("click",this.onClickBtnSubscribeHandler)}if(this.iptEMailTextbox){this.iptEMailTextbox.close()}},load:function(){if(document.documentElement.clientWidth<=1024){$(document.documentElement).addClassName("scroll1024")}},render:function(){this.renderManager();this.renderHeader();this.renderNavigatorBar();this.renderFooter()},renderHeader:function(){},renderManager:function(){if(this.useNewNavigation){if(typeof initializeManager2016!=="function"){$loadJs("/js/2014/topmenu.js",function(){initializeManager2016({})}.bind(this))}else{initializeManager2016({})}}else{initializeManager({})}},renderNavigatorBar:function(){},renderFooter:function(){if(this.bottomRegion){if(this.isMini){this.renderMiniFooter()}else{this.renderMtimeFooter()}}},renderMtimeFooter:function(){var b=['<div class="footout">','<span class="topline"></span>','<div class="footinner clearfix">','<div class="fotlogo">',"<dl>",'<dt><a href="http://www.mtime.com" title="Mtime时光网">Mtime时光网</a></dt>','<dd class="clearfix"><a href="http://jobs.mtime.com/">加入我们</a><a href="http://feature.mtime.com/help/contact.htm" class="ml30">联系我们</a></dd>','<dd class="clearfix"><a href="http://group.mtime.com/help/">站务论坛</a><a href="http://my.mtime.com/reportError/" class="ml30">问题反馈</a></dd>','<dd class="clearfix"><a href="http://feature.mtime.com/help/rules.htm">社区准则</a><a href="http://www.mtime.com/sitemap.htm" class="ml30">网站地图</a></dd>','<dd class="clearfix"><a href="http://feature.mtime.com/help/privacy.htm">隐私政策</a><a href="http://en.mtime.com/" class="ml30">English</a></dd>',"</dl>",'<i class="line"></i>',"</div>",'<div class="fotmap">','<dl style="width:42px;">',"<dt>栏目</dt>",'<dd><a href="http://news.mtime.com/">新闻</a></dd>','<dd><a href="http://theater.mtime.com/">影院</a></dd>','<dd><a href="http://mall.mtime.com">商城</a></dd>','<dd><a href="http://www.mtime.com/community/">社区</a></dd>',"</dl>",'<dl style="width:185px;">',"<dt>推荐</dt>",'<dd><a href="http://movie.mtime.com/recent/">观影指南</a><a href="http://movie.mtime.com/boxoffice/" class="ml30">电影票房</a></dd>','<dd><a href="http://news.mtime.com/conversation/">时光对话</a><a href="http://video.mtime.com/trailer/" class="ml30">新片预告</a></dd>','<dd><a href="http://movie.mtime.com/all/list/index.html">特色榜单</a><a href="http://my.mtime.com/app/quiz/" class="ml30">电影猜猜猜</a></dd>','<dd><a href="http://news.mtime.com/fun/">全球拾趣</a><a href="http://my.mtime.com/app/card/" class="ml30">卡片大富翁</a></dd>',"</dl>","<dl>","<dt>关注我们</dt>",'<dd><a href="http://weibo.com/movietime?topnav=1&wvr=5&topsug=1" target="_blank" class="sina" title="新浪">新浪</a></dd>','<dd><a id="aWeiXinPicButton" href="javascript:void(0)" class="weixin" title="微信">微信</a></dd>','<dd><a href="http://www.mtime.com/rss/" target="_blank" class="rss" title="RSS">RSS</a></dd>',"</dl>",'<i class="line"></i>','<div id="divWeiXinPicContainer" class="my_layer none"> <em class="l_arrow">&nbsp;</em>','<div class="inner p15" style="width:195px;">',"<i></i>","<p>扫描二维码，微信实时关注时光网</p>","</div>","</div>","</div>",'<div class="fotweek">',"<dl>",(window.topMenuValues&&window.topMenuValues.footer)?topMenuValues.footer:"",'<dd class="input"><input id="iptEMail" type="text" value="邮箱地址" class="c_a5" /><a id="btnSubscribe" href="javascript:void(0)">订阅</a></dd>',"</dl>","</div>",'<div class="fothr">',"<dl>","<dt><strong>手机购票</strong> 方便 实惠</dt>",'<dd><a href="http://feature.mtime.com/mobile/" target="_blank"><i></i></a></dd>',"<dd>扫描二维码 下载客户端</dd>","</dl>","</div>","</div>","</div>"].concat(this.getMiniFooterHTMLArray());this.bottomRegion.innerHTML=b.join("");this.iptEMail=$("iptEMail");this.btnSubscribe=$("btnSubscribe");this.iptEMailTextbox=new Textbox({text:this.iptEMail,watermarkText:"邮箱地址",onKeypressCallback:this.onEnter.bind(this)});this.onClickBtnSubscribeHandler=this.orderWeekly.bindAsEventListener(this);this.btnSubscribe.observe("click",this.onClickBtnSubscribeHandler);this.aWeiXinPicButton=$("aWeiXinPicButton");this.divWeiXinPicContainer=$("divWeiXinPicContainer");this.divWeiXinPicContainer.hide();this.divWeiXinPicContainer.removeClassName("none");this.onWeiXinPicButtonHandler=this.clickWeiXinPicButton.bindAsEventListener(this);this.aWeiXinPicButton.observe("click",this.onWeiXinPicButtonHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},renderMiniFooter:function(){this.bottomRegion.innerHTML=this.getMiniFooterHTMLArray().join("")},getMiniFooterHTMLArray:function(){var b=['<div class="db_foot">',"<p>",'<span class="mr12">北京动艺时光网络科技有限公司</span>Copyright 2006-',new Date().getFullYear()," Mtime.com Inc. All rights reserved.<br>",'<a href="http://feature.mtime.com/help/icp.htm" target="_blank" class="mr12 ml12">京ICP证050715号</a> ','<a href="http://feature.mtime.com/help/videolicence.htm" target="_blank" class="mr12">网络视听许可证0108265号</a>','<a href="http://feature.mtime.com/help/network.htm" target="_blank" class="mr12">网络文化经营许可证</a>','<a href="http://feature.mtime.com/help/tvlicence.htm" target="_blank" class="mr12">广播电视节目制作经营许可证(京)字第1435号</a>',"<span>京公网安备：110105000744号</span>","</p>",'<div class="credible"><a href="http://feature.mtime.com/help/credible.htm" target="_blank" title="可信网站" class="credibler"></a><a href="http://feature.mtime.com/help/goodfaith.htm" target="_blank" title="诚信网站" class="goodfaith"></a></div>',"</div>"];return b},orderWeekly:function(){var b=$F(this.iptEMail);b=b.trim();if(b.length>0){if(!Validator.validateEmail(b)){$alert("请输入合法的邮箱地址！");this.iptEMail.focus();return}else{this.server.createSubscriber(b,this.onCreateSubScriberCallBack.bind(this))}}},onCreateSubScriberCallBack:function(){var b=orderResult;if(b&&b.value&&b.value.success){$alert("您已成功订阅周刊，您的邮箱将会定期收到最新一期的周刊。");this.iptEMail.value="请输入邮箱地址"}else{$alert("订阅周刊失败，请重试或联系管理员。")}},onEnter:function(b){switch(b.keyCode){case Event.KEY_RETURN:this.orderWeekly();Event.stop(b);break;default:break}},clickWeiXinPicButton:function(b){this.divWeiXinPicContainer.show()},onClickPage:function(d){var e=Event.pointerX(d);var f=Event.pointerY(d);if(!Position.within(this.divWeiXinPicContainer,e,f)&&!Position.within(this.aWeiXinPicButton,e,f)){if(this.divWeiXinPicContainer.visible()){this.divWeiXinPicContainer.hide()}}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}};function f_navigationBarSearch(){var d=$("navSearchValueInput").value.Trim();var c=$F("navSearchTypeSelect");if(d!==""){window.open("/search/"+(c=="all"?"":c)+"?"+encodeURI(d),"_blank")}}var SlidesControl=Class.create();Object.extend(SlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",scale:0,duration:0.2,tabName:null,amount:null,type:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler)},destroyEvent:function(){this.onPrevClickHandler&&Event.stopObserving(this.prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null},closed:function(){this.destroyEvent();this.destroyDOM()},close:function(){this.closed()},load:function(){if(this.tabName){$loadSubJs("/js/AutoSwitchTabPanel.js",function(){var k=this.items;for(var l=0,j=k.length;l<j;l++){var h=k[l];if(h.getAttribute("name")===this.tabName){var m=h.childElements();var g=new AutoSwitchTabPanel({menuRegion:m[1],contentRegion:m[0],autoTimeout:7000})}}}.bind(this))}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.prevSlides()},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.nextSlides()},prevSlides:function(){if(this.lock){return}var f=null;if(this.type==="neat"){var e=this.items.pop();var d=this.items[0];this.items.unshift(e);this.slidesRegion.insertBefore(e,d);this.slidesRegion.style.left=this.position-this.scale;f={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-this.scale};this.move(f)}else{f={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:-this.currentIndex*this.scale};if(this.amount&&this.currentIndex<1){f.scale=-this.scale*(this.amount-1);this.currentIndex=this.amount-1}else{if(this.currentIndex<1){f.scale=-this.scale*(this.length-1);this.currentIndex=this.length-1}else{this.currentIndex--}}this.move(f)}},nextSlides:function(){if(this.lock){return}var b=null;if(this.type==="neat"){b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:this.position,callback:function(){var a=this.items.shift();var d=this.items.last();this.items.push(a);a=this.slidesRegion.removeChild(a);this.slidesRegion.appendChild(a);this.slidesRegion.style.left=this.position}.bind(this)};this.move(b)}else{b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:-this.currentIndex*this.scale};if(this.amount&&this.currentIndex>this.amount-2){b.scale=this.scale*(this.amount-1);this.currentIndex=0}else{if(this.currentIndex>this.length-2){b.scale=this.scale*(this.length-1);this.currentIndex=0}else{this.currentIndex++}}this.move(b)}},move:function(b){this.lock=true;new Fx.Move(b.node,{scaleX:true,duration:b.duration,distances:{left:b.scale,position:b.position},callback:function(){this.lock=false;b.callback&&b.callback()}.bind(this)})}});Fx.Move=Class.create();Object.extend(Object.extend(Fx.Move.prototype,Fx.Base.prototype),{setup:function(c){var d;if(this.options.distances){d=this.options.distances;this.currentLeft=d.left;this.currentTop=d.top;this.originalPosition=d.position;this.factor=1}else{this.steps=-1}},update:function(j,l){var d=this.factor*l;var k=this.currentLeft*d;var m=this.currentTop*d;var h={};if(j.options.scaleX){h.left=this.originalPosition+Math.round(k)+"px"}if(j.options.scaleY){h.top=this.originalPosition+Math.round(m)+"px"}this.element.setStyle(h)},end:function(b){if(b.options.callback){b.options.callback()}}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.Base=Class.create();Object.extend(Widgets.Base.prototype,{options:{},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},load:function(){},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){},destroyDOM:function(){}});Widgets.SlidesControl=Class.create();Object.extend(Widgets.SlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.SlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",prev:"moviePrev",next:"movieNext",duration:0.5,showLength:4,videID:10404,items:[],autoTimeout:null,type:"detail",itemWidth:245,isHide:false,moreLink:"",imageTemplate:'<li class="#{sty}"><span class="sharp"></span><a href="#{Url}" class="db_avideo"><img src="#{ImagePath}" alt="#{TitleSamll}" /><em></em><b></b><i>#{hdHtml}#{Length}</i><span>#{TitleSamll}</span></a></li>',callback:null},isOther:false,initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$prev=$(this.prev);this.$next=$(this.next);this.scale=this.itemWidth*this.showLength;this.$slidesRegion.style.width=(this.scale*2+100)+"px";if(this.type==="other"){this.isOther=true;this.$prev_i=this.$prev.down("i");this.$next_i=this.$next.down("i");if(this.moreLink!==""){this.moreLinkOjb={nextBtnTemplate:'<a class="next_screen" href="#{morelink}" target="_blank"><em></em><i class="on"></i></a>',morelink:this.moreLink};this.$parentRegion=this.$next.up();var d=new Template(this.moreLinkOjb.nextBtnTemplate),c=d.evaluate(this.moreLinkOjb);this.nextBtnHtml=Builder.build(c);this.nextBtnHtml.hide();this.$parentRegion.appendChild(this.nextBtnHtml)}}this.durations=this.durationInfo(this.duration)},renderImage:function(g){if(!g){return}var f,h=new Template(this.imageTemplate),e=new StringBuilder();if(typeof this.videoID!=="undefined"&&typeof g.VideoID!=="undefined"&&g.VideoID==this.videoID){g.sty="on"}else{g.sty=""}g.hdHtml=g.HD===1?'<strong title="HD"></strong>':"";f=h.evaluate(g);return f.toString()},show:function(){var l=[];for(var h=this.min;h<this.length&&h<this.max;h++){var j=this.imgItems[h];var g=this.renderImage(j);var m=Builder.build(g);if(this.type==="list"){if(this.isVideoList){if(h%2===0){var k=Builder.build("<li></li>");k.appendChild(m);this.$slidesRegion.appendChild(k);l.push(k)}else{j=this.imgItems[h];g=this.renderImage(j);m=Builder.build(g);l[l.length-1].appendChild(m)}}else{var k=Builder.build("<li></li>");k.appendChild(m);this.$slidesRegion.appendChild(k);l.push(k)}}else{this.$slidesRegion.appendChild(m);l.push(m)}if(h===0){if(this.isOther){this.$prev_i.removeClassName("on")}else{this.$prev.hide()}}if(h===this.length-1){if(this.type==="other"){if(this.moreLink!==""){if(this.isHide&&this.items.length<=this.showLength){this.$next_i.hide()}else{this.nextBtnHtml.show()}}else{this.$next_i.removeClassName("on")}}else{this.$next.hide()}}}this.selectedItems=l},load:function(){this.pageIndex=0;this.imgItems=[];if(typeof this.items==="undefined"||this.items.length===0){return}this.imgItems=this.items;this.length=this.imgItems.length;this.amount=Math.ceil(this.length/this.showLength);var f,h,e,g=0;for(i=0;i<this.length;i++){if(typeof this.imgItems[i]!=="undefined"&&typeof this.imgItems[i].VideoID!=="undefined"){if(this.imgItems[i].VideoID==this.videoID){f=this.imgItems[i];g=i+1;if(i>0){h=this.imgItems[i-1]}if(i<this.length-1){e=this.imgItems[i+1]}this.callback&&this.callback({nowVideo:f,preVideo:h,nextVideo:e,videoCount:this.length})}}}if(this.length>this.showLength){if(this.isOther){this.$prev_i.addClassName("on");this.$next_i.addClassName("on")}else{this.$prev.show();this.$next.show()}}else{if(this.isOther){if(this.isHide){this.$prev_i.hide();this.$next_i.hide()}else{this.$prev_i.removeClassName("on");this.$next_i.removeClassName("on")}}else{this.$prev.hide();this.$next.hide()}}this.isVideoList=this.type==="list"&&this.length>=20?true:false;this.pageIndex=Math.ceil(g/this.showLength);this.min=(this.pageIndex-1)*this.showLength;if(this.min<0){this.min=0}this.max=this.pageIndex*this.showLength;if(this.max<this.showLength){this.max=this.showLength}if(this.isVideoList){this.$slidesRegion.up().style.height="274px";this.max=this.max*2}this.show();if(typeof SlidesControl!="undefined"){this.instantiation()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instantiation()}.bind(this))}},durationInfo:function(d){var f=Math.floor(d*10)/10,e;switch(f){case 0.2:e={className:"transition2",duration:200};break;case 0.3:e={className:"transition3",duration:300};break;case 0.4:e={className:"transition4",duration:400};break;case 0.5:e={className:"transition5",duration:500};break;case 0.6:e={className:"transition6",duration:600};break;default:e={className:"transition6",duration:600}}return e},instantiation:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:d.scale,duration:this.duration,type:"neat",prevSlides:function(){if(this.lock){return}if(typeof d.$prev_i!=="undefined"&&!d.$prev_i.hasClassName("on")){return}var w=null;d.selectedItems=this.slidesRegion.immediateDescendants();var a=[],b=d.selectedItems[0],u,x,y,z,A=[],t,q,s=0;if(d.isVideoList){d.min-=d.showLength*2;d.max-=d.showLength*2}else{d.min-=d.showLength;d.max-=d.showLength}if(d.min<=0){d.min=0;if(d.isVideoList){d.max=d.showLength*2}else{d.max=d.showLength}}if(d.max>=d.length){if(d.isVideoList){d.max=d.length-d.selectedItems.length*2;d.min=d.max-d.showLength*2}else{d.max=d.length-d.selectedItems.length;d.min=d.max-d.showLength}}if(d.isOther){d.$next_i.addClassName("on")}else{d.$next.show()}if(d.nextBtnHtml){d.nextBtnHtml.hide()}for(var r=d.min;r<d.length&&r<d.max;r++){t=d.imgItems[r];q=d.renderImage(t);z=Builder.build(q);if(r===0){if(d.isOther){d.$prev_i.removeClassName("on")}else{d.$prev.hide()}}if(d.type==="list"){if(d.isVideoList){if(r%2===0){var v=Builder.build("<li></li>");v.appendChild(z);this.slidesRegion.insertBefore(v,b);a.push(v)}else{t=d.imgItems[r];q=d.renderImage(t);z=Builder.build(q);a[a.length-1].appendChild(z)}}else{var v=Builder.build("<li></li>");v.appendChild(z);this.slidesRegion.insertBefore(v,b);a.push(v)}}else{a.push(z);this.slidesRegion.insertBefore(z,b)}}if(d.isVideoList){s=Math.floor((d.max-d.min)/2)}else{s=d.max-d.min}d.scale=d.itemWidth*s;this.slidesRegion.style.left=this.position-d.scale+"px";if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(r=d.showLength-s;r<d.showLength;r++){d.selectedItems[r]&&this.slidesRegion.removeChild(d.selectedItems[r])}this.lock=false},d.durations.duration,this);return}w={node:this.slidesRegion,duration:this.duration,scale:d.scale,position:this.position-d.scale,callback:function(){for(r=d.showLength-s;r<d.showLength;r++){d.selectedItems[r]&&this.slidesRegion.removeChild(d.selectedItems[r])}this.slidesRegion.style.left=this.position;d.selectedItems=a}.bind(this)};this.move(w)},nextSlides:function(){if(this.lock){return}if(typeof d.$next_i!=="undefined"&&!d.$next_i.hasClassName("on")){return}var a=null;if(d.isVideoList){d.min+=d.showLength*2;d.max+=d.showLength*2}else{d.min+=d.showLength;d.max+=d.showLength}if(d.isOther){d.$prev_i.addClassName("on")}else{d.$prev.show()}d.show();d.selectedItems=this.slidesRegion.immediateDescendants();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left=-d.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(i=0;i<d.showLength;i++){d.selectedItems[i]&&this.slidesRegion.removeChild(d.selectedItems[i])}this.slidesRegion.style.left=this.position;this.lock=false},d.durations.duration,this);return}a={node:this.slidesRegion,duration:this.duration,scale:-d.scale,position:this.position,callback:function(){for(i=0;i<d.showLength;i++){d.selectedItems[i]&&this.slidesRegion.removeChild(d.selectedItems[i])}this.slidesRegion.style.left=this.position}.bind(this)};this.move(a)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})}});Widgets.BehindSlidesControl=Class.create();Object.extend(Widgets.BehindSlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.BehindSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",prev:"moviePrev",next:"movieNext",presentNumber:"present_number",sumNumber:"sum_number",titleTxt:"title_txt",describeTxt:"describe_txt",duration:0.5,type:"neat",callback:null},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$presentNumber=$(this.presentNumber);this.$sumNumber=$(this.sumNumber);this.$titleTxt=$(this.titleTxt);this.$describeTxt=$(this.describeTxt);this.$images=this.$slidesRegion.immediateDescendants();this.imagesLen=this.$images.length;this.$slidesRegion.style.width=(this.$images[0].offsetWidth*this.imagesLen+100)+"px";if(this.$sumNumber){this.$sumNumber.innerHTML="/"+this.imagesLen}this.presentNum=1;if(this.$presentNumber){this.$presentNumber.innerHTML=this.presentNum}if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("imgabstract"),46)}},load:function(){if(typeof SlidesControl!=="undefined"){this.instanceSlidesControl()}else{$loadJs(["/js/2011/SlidesControl.js"],function(){this.instanceSlidesControl()}.bind(this))}},instanceSlidesControl:function(){var d=this;if(!this.$slidesRegion||this.$slidesRegion.children.length<2){return}var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",move:function(a){this.lock=true;d.moveMethod(a.scale);new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;a.callback&&a.callback()}.bind(this)})}})},moveMethod:function(b){if(b>0){this.presentNum-=1;if(this.presentNum<=0){this.presentNum=this.imagesLen}}else{this.presentNum+=1;if(this.presentNum>this.imagesLen){this.presentNum=1}}this.$presentNumber.innerHTML=this.presentNum;if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[this.presentNum-1].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[this.presentNum-1].readAttribute("imgabstract"),46)}this.callback&&this.callback()},destroyDOM:function(){this.$presentNumber=null;this.$sumNumber=null;this.$titleTxt=null;this.$describeTxt=null;this.$images=null;this.imagesLen=null}});var Fixedable=function(l,r){var l=$(l);var r=$(r);function m(b,e){b.setStyle({zIndex:100,width:b.offsetWidth+"px"});if(Mtime.browser.ie===6){b.style.position="absolute";document.body.style.backgroundImage="url(about:blank)";document.body.style.backgroundAttachment="fixed";var g=(typeof e.width!=="undefined")||b.offsetWidth,c=(typeof e.height!=="undefined")||b.offsetHeight,f=0;if(typeof e.top!=="undefined"){var a=$$(".c_content")[0]||$$(".c_out")[0];if(a){f=Position.cumulativeOffset(a)[1]}}var d=function(){var h=(typeof e.top!=="undefined")?e.top-f:(document.documentElement.clientHeight-e.bottom-c);h=h-Position.cumulativeOffset(b.up())[1];!isNaN(h)&&b.style.setExpression("top","eval(document.documentElement.scrollTop + "+h+") + 'px'")};d()}else{b.style.position="fixed";(typeof e.top!=="undefined")&&(b.style.top=e.top+"px");(typeof e.bottom!=="undefined")&&(b.style.bottom=e.bottom+"px");(typeof e.left!=="undefined")&&(b.style.left=e.left+"px");(typeof e.right!=="undefined")&&(b.style.right=e.right+"px")}return b}function s(a,b){a.setStyle({zIndex:"",width:""});if(Mtime.browser.ie===6){a.style.position="static";a.style.width="100%";a.style.top="";document.body.style.backgroundImage="";document.body.style.backgroundAttachment=""}else{a.style.position="";(typeof b.top!=="undefined")&&(a.style.top="");(typeof b.bottom!=="undefined")&&(a.style.bottom="");(typeof b.left!=="undefined")&&(a.style.left="");(typeof b.right!=="undefined")&&(a.style.right="")}}if(l&&r){var n=false,o=null;var p=function(){var a=0,b=0;if(typeof(window.pageYOffset)=="number"){b=window.pageYOffset;a=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollTop;a=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollTop;a=document.documentElement.scrollLeft}}}return[a,b]};var q=function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return[b,a]};var k=function(){var a=Position.cumulativeOffset(l.up())[1];var c=p()[1];var b=Position.cumulativeOffset(r)[1]+r.offsetHeight;if(c>(b-l.offsetHeight)||c<a){if(n){n=false;s(l,{top:0})}}else{if(c>a&&!n){m(l,{top:0});n=true}}};Event.observe(window,"scroll",k);Event.observe(window,"resize",k);return function(){Event.stopObserving(window,"scroll",k);Event.stopObserving(window,"resize",k)}}else{return null}};var AutoHeight=Class.create();Object.extend(AutoHeight,{getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},cssList:["font-family","font-size","font-style","font-weight","font-variant","line-height","margin-top","margin-bottom","margin-left","margin-right","overflow-x","overflow-y","padding-top","padding-bottom","padding-left","padding-right","word-break","word-wrap"],startAuto:function(b){b=$(b);lengthExpMax=210;normalTemplate="还可以输入{0}字";warnTemplate='<span class="c_red">字数超出{0}字</span>';this.handler=AutoHeight.auto.bind(b);Event.observe(b,"blur",this.handler);Event.observe(b,"focus",this.handler);Event.observe(b,"keyup",this.handler);Event.observe(b,"mouseup",this.handler);return AutoHeight.stopAuto.bind(b,this.handler)},auto:function(q){var z=this.up(".ele_replay").down('[_type="fd"]');var x=this.up();if(this.value.length==0){this.style.height="";z.innerHTML=String.format(normalTemplate,[lengthExpMax]);if(q.type==="blur"){AutoHeight.stopAuto(this)}return}if(!AutoHeight.mirrorCtn){AutoHeight.mirrorCtn=$(Builder.node("div"));document.body.appendChild(AutoHeight.mirrorCtn);AutoHeight.mirrorCtn.style.opacity="0";AutoHeight.mirrorCtn.style.zIndex=-1000;AutoHeight.mirrorCtn.style.position="absolute"}mirrorCtn=AutoHeight.mirrorCtn;cssList=AutoHeight.cssList;styleObj={};for(var r=0,s=cssList.length,l,y,u;r<s;++r){l=cssList[r];if((y=this.getStyle(l))){styleObj[l]=y}}mirrorCtn.setStyle(styleObj);mirrorCtn.setStyle({width:this.offsetWidth+"px"});var A=this.value;if(A.lastIndexOf("\n")!=-1&&A.lastIndexOf("\n")+1==A.length){A+="占"}mirrorCtn.innerHTML=A.replace(/\n/g,"<br/>");var w=AutoHeight.getXY(this);mirrorCtn.style.top=w.y+"px";mirrorCtn.style.left=w.x+"px";var v=mirrorCtn.offsetHeight;if(v<60){v=60}x.style.height=this.style.height=v+"px";if(A){var t=Widgets.Utils.strLen(A),o;if(t>0){o=lengthExpMax-t;if(o>=0){z.innerHTML=String.format(normalTemplate,[o])}else{z.innerHTML=String.format(warnTemplate,[Math.abs(o)])}}}z=x=v=null},stopAuto:function(e,f){var g=e.up();var h=g.up(".ele_replay").down(".mt6");h&&h.remove();e.value="发表评论";if(f){g.removeClassName("focus");e.style.height="30px";g.style.height="30px"}e.setAttribute("toggle","0");Event.stopObserving(e,"blur",AutoHeight.handler);Event.stopObserving(e,"focus",AutoHeight.handler);Event.stopObserving(e,"keyup",AutoHeight.handler);Event.stopObserving(e,"mouseup",AutoHeight.handler)}});!function(){function m(f,e){var d=0,a=f.split(""),p=[];e=(e||12)*2;var c=a.length;for(var b=0;b<c;++b){if(a[b].charCodeAt(0)<299){d++}else{d+=2}p.push(a[b]);if(d>=e-2){p.push("..");break}}return p.join("")}function l(e){var d=0,a=e.split("");var c=a.length;for(var b=0;b<c;++b){if(a[b].charCodeAt(0)<299){d++}else{d+=2}}return Math.ceil(d/2)}function k(b){var e=0,a,c=b.length;for(var d=0;d<c;d++){a=l(b[d]);if(a>e){e=a}}return e}function g(b){var y=b.value;var a=this.addLength||0;this.lengthExp=this.lengthExp||{};this.lengthExp.max=this.lengthExp.max||210;this.lengthExp.min=this.lengthExp.min||41;this.lengthExp.surl=this.lengthExp.surl||21;var c=y.trim().length;if(c>0&&y!=this.defaultText&&y.trim()!="发表评论"){var n=this.lengthExp.min,f=this.lengthExp.max,x=this.lengthExp.surl,o=y;var d=0;if(!this.notShortUrl){var z=y.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z\$\.\+\!\_\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];for(var e=0,c=z.length;e<c;e++){var w=z[e].bytelength2();if(/^(http:\/\/murl.tv)/.test(z[e])){continue}else{d+=w<=f?x:(w-f+x)}o=o.replace(z[e],"")}}return Math.ceil((d+o.bytelength2())/2)+a}else{return 0+a}}function h(r,d,q,f){var a=[];var c,b,s=Math.round((f*r)/d),e=Math.round(q*d/r);if(s<=q){c=s;b=f}else{if(e<=f){c=q;b=e}}a[0]=c;a[1]=b;return a}function j(c){var d=0,e=0;if(c.getBoundingClientRect){var a=c.getBoundingClientRect();var b=document.documentElement;d=Math.round(a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft);e=Math.round(a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop)}else{for(;c!=document.body;d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent){}}return{x:d,y:e}}Widgets.Utils={strShort:m,strLen:l,strArrayMax:k,getLength:g,getRatioSize:h,getXY:j}}();Fx.Move=Class.create();Object.extend(Object.extend(Fx.Move.prototype,Fx.Base.prototype),{setup:function(c){var d;if(this.options.distances){d=this.options.distances;this.currentLeft=d.left;this.currentTop=d.top;this.originalPosition=d.position;this.factor=1}else{this.steps=-1}},update:function(j,l){var d=this.factor*l;var k=this.currentLeft*d;var m=this.currentTop*d;var h={};if(j.options.scaleX){h.left=this.originalPosition+Math.round(k)+"px"}if(j.options.scaleY){h.top=this.originalPosition+Math.round(m)+"px"}this.element.setStyle(h)},end:function(b){if(b.options.callback){b.options.callback()}}});Widgets.Artwork=Class.create();Object.extend(Widgets.Artwork.prototype,Widgets.Base.prototype);Object.extend(Widgets.Artwork.prototype,{options:{width:0,height:0,imgUrl:"",isLoader:false,imageTemplate:'<div class="db_firstphoto" style="#{divStyle}"><img class="#{_className}" src="#{imgUrl}" width="#{width}" height="#{height}" style="#{imgStyle}"></div>',closeTemplate:'<a id="imgClose" href="javascript:void(0);" class="db_imgclose" title="关闭"></a>'},load:function(){if(!this.imgUrl&&(typeof isArtwork!=="undefined"&&isArtwork>0)){return}document.documentElement.style.overflow="hidden";this.clientHeight=document.documentElement.clientHeight;this.clientWidth=document.documentElement.clientWidth;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;if(typeof this.width==="undefined"||typeof this.height==="undefined"||this.width===0||this.height===0){var f;if(this.isLoader){f='<div><div class="db_picloading" style="height:1000px; width:100%; z-index:50;"><div class="load104"><i class="logo"></i><i class="loadimg"></i></div></div><div class="db_firstphoto" style="visibility:hidden;"><img id="img" src="'+this.imgUrl+'"></div></div>'}else{f='<div class="db_firstphoto" style="visibility:hidden;"><img id="img" src="'+this.imgUrl+'"></div>'}var d=Builder.build(f);document.body.appendChild(d);var e=$("img");e.onload=function(){this.width=e.width;this.height=e.height;d&&d.remove();this.buildHtml()}.bind(this)}else{this.buildHtml()}},buildHtml:function(){var j={divStyle:"height:"+this.clientHeight+"px;top:"+this.scrollTop+"px",imgUrl:this.imgUrl,width:this.width,height:this.height,_className:(this.clientHeight>=this.height&&this.clientWidth>=this.width)?"":"bimg",imgStyle:this.clientHeight>this.height?"margin-top:"+Math.floor((this.clientHeight-this.height)/2)+"px;":""},h,k=new Template(this.imageTemplate),g,f;h=k.evaluate(j);this.$artworkNode=Builder.build(h.toString());document.body.appendChild(this.$artworkNode);this.$imgClose=Builder.build(this.closeTemplate.toString());document.body.appendChild(this.$imgClose);this.changeHandler=setInterval(function(){if(this.clientHeight===document.documentElement.clientHeight&&this.clientWidth===document.documentElement.clientWidth){return}this.clientHeight=document.documentElement.clientHeight;this.clientWidth=document.documentElement.clientWidth;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;this.$artworkNode.style.height=this.clientHeight+"px";this.$artworkNode.style.top=this.scrollTop+"px";if(this.clientHeight>this.height||this.clientWidth>this.width){if(this.$image.hasClassName("bimg")){this.$image.removeClassName("bimg")}if(this.$image.hasClassName("simg")){this.$image.removeClassName("simg")}}else{var a=Widgets.Utils.getRatioSize(this.width,this.height,this.clientWidth,this.clientHeight);this.$image.style.width=a[0]+"px";this.$image.style.height=a[1]+"px"}}.bind(this),1500);this.$image=this.$artworkNode.down("img");this.imgCloseOnClickHandler=this.imgCloseOnClick.bind(this);Event.observe(this.$imgClose,"click",this.imgCloseOnClickHandler);if(this.$image.hasClassName("bimg")){this.imgClickHandler=this.imgClick.bind(this);Event.observe(this.$artworkNode,"click",this.imgClickHandler)}isArtwork=1},imgCloseOnClick:function(){this.$artworkNode.remove();this.$imgClose.remove();document.documentElement.style.overflow="";isArtwork=null;clearInterval(this.changeHandler);this.changeHandler=null},imgClick:function(){if(this.$image.hasClassName("bimg")){this.$image.removeClassName("bimg");this.$image.addClassName("simg");var b=Widgets.Utils.getRatioSize(this.width,this.height,this.clientWidth,this.clientHeight);this.$image.style.width=b[0]+"px";this.$image.style.height=b[1]+"px"}else{if(this.$image.hasClassName("simg")){this.$image.removeClassName("simg");this.$image.addClassName("bimg");this.$image.style.width=this.width+"px";this.$image.style.height=this.height+"px"}}},destroyEvent:function(){Event.stopObserving(this.$imgClose,"click",this.imgCloseOnClickHandler);Event.stopObserving(this.$artworkNode,"click",this.imgClickHandler)},destroyDOM:function(){this.clientHeight=null;this.clientWidth=null;this.$artworkNode=null;this.$imgClose=null;this.$image=null;this.imageTemplate=null;this.closeTemplate=null;this.width=null;this.height=null;if(this.changeHandler){clearInterval(this.changeHandler);this.changeHandler=null}}});Widgets.AwardSlidesControl=Class.create();Object.extend(Widgets.AwardSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(Widgets.AwardSlidesControl.prototype,{initializeEvent:function(){Widgets.SlidesControl.prototype.initializeEvent.apply(this);this.slidesRegionClickHandler=this.slidesRegionClick.bind(this);Event.observe(this.slidesRegion,"click",this.slidesRegionClickHandler.bind(this))},show:function(){var j=[];for(var g=this.min;g<this.length&&g<this.max;g++){var h=this.imgItems[g];var f=this.renderImage(h);var k=Builder.build(f);this.$slidesRegion.appendChild(k);j.push(k);if(g===0){if(this.isOther){this.$prev_i.removeClassName("on")}else{this.$prev.hide()}}if(g===this.length-1){if(this.type==="other"){if(this.moreLink!==""){this.nextBtnHtml.show()}else{this.$next_i.removeClassName("on")}}else{this.$next.hide()}}}this.selectedItems=j},load:function(){Widgets.SlidesControl.prototype.load.apply(this);this.type="award";this.$awardInfoRegion=$(this.awardInfoRegion);this.builderAwardInfo(0);this.selectedItems[0].addClassName("on");var d=this.selectedItems[0];var e=d.down("span"),f;if(e){f=$(Builder.node("span",{style:"background-image: url("+this.imgItems[0].DefaultImageUrl+");"}));d.insertBefore(f,e);e.remove()}d=e=f=null;this.clickIndex=0},slidesRegionClick:function(g){var f=Event.findElement(g,"dd"),h=0,j,k;this.festivalId=f.getAttribute("festivalid");if(this.festivalId){this.selectedItems=this.$slidesRegion.immediateDescendants();this.selectedItems.each(function(b){if(b.hasClassName("on")){b.removeClassName("on");var a=parseInt(b.getAttribute("festivalid"),10);this.imgItems.each(function(d,c){if(d.FestivalId===a){h=c}}.bind(this));j=b.down("span");if(j){k=$(Builder.node("span",{style:"background-image: url("+this.imgItems[h].BackgroundImageUrl+");"}));b.insertBefore(k,j);j.remove()}}}.bind(this));f.addClassName("on");this.festivalId=parseInt(this.festivalId,10);this.imgItems.each(function(b,a){if(b.FestivalId===this.festivalId){h=a}}.bind(this));if(h>=0){this.clickIndex=h;j=f.down("span");if(j){k=$(Builder.node("span",{style:"background-image: url("+this.imgItems[h].DefaultImageUrl+");"}));f.insertBefore(k,j);j.remove()}this.builderAwardInfo(h)}}f=h=j=k=null},builderAwardInfo:function(b){},instantiation:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.itemWidth,duration:this.duration,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=d.showLength-1;this.totalNum=d.length-d.showLength;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false},prevSlides:function(){if(this.lock){return}this.items=this.slidesRegion.immediateDescendants();var a=this.items[0],b,k;this.next.show();this.isMoreLink=false;var j=null;j={node:this.slidesRegion,duration:this.duration,scale:this.scale,position:this.position-this.scale,callback:function(){var e=this.items.last();this.slidesRegion.removeChild(e);this.slidesRegion.style.left=this.position}.bind(this)};this.currentIndex--;var h=this.currentIndex-(d.showLength-1);if(h<=-1){this.currentIndex=0;return}else{if(h===0){this.prev.hide()}}b=d.renderImage(d.imgItems[h]);k=Builder.build(b);this.slidesRegion.insertBefore(k,a);if(h===d.clickIndex){k.addClassName("on");k.down("span").style.backgroundImage="url("+d.imgItems[h].DefaultImageUrl+")"}this.move(j)},nextSlides:function(){if(this.lock){return}var a,f;var b=null;this.prev.show();this.items=this.slidesRegion.immediateDescendants();b={node:this.slidesRegion,duration:this.duration,scale:-this.scale,position:this.position,callback:function(){var e=this.items.shift();this.slidesRegion.removeChild(e);this.slidesRegion.style.left=this.position}.bind(this)};this.currentIndex++;if(this.currentIndex>=d.length-1){this.next.hide()}a=d.renderImage(d.imgItems[this.currentIndex]);f=Builder.build(a);if(this.currentIndex===d.clickIndex){f.addClassName("on")}this.slidesRegion.appendChild(f);this.move(b)}})}});Widgets.backTopControl=Class.create();Object.extend(Widgets.backTopControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.backTopControl.prototype,{options:{backTop_HTML:'<a href="#" onclick="return false" id="backTop" style="display:none" class="transition backtop " title="返回顶部"></a>'},initializeEvent:function(){this.mybackTopandler=this.backTop.bind(this);Event.observe(window,"scroll",this.mybackTopandler);Event.observe(window,"unload",this.close.bind(this))},destroyDOM:function(){this.backTopBtn.remove()},destroyEvent:function(){Event.stopObserving(window,"scroll",this.mybackTopandler)},close:function(){this.destroyDOM();this.destroyEvent()},load:function(){this.backTopBtn=Builder.build(this.backTop_HTML);document.body.appendChild(this.backTopBtn);Event.observe(this.backTopBtn,"click",function(){document.body.scrollIntoView()})},backTop:function(){var b=document.documentElement.scrollTop||document.body.scrollTop;if(Mtime.browser.ie&&Mtime.browser.ie<7){this.backTopBtn.style.top=document.documentElement.clientHeight+b-200+"px"}if(b<=0){this.backTopBtn.style.display="none"}else{this.backTopBtn.style.display="block"}}});Widgets.Comment=Class.create();Object.extend(Widgets.Comment.prototype,Widgets.Base.prototype);Object.extend(Widgets.Comment.prototype,{options:{container:"",lengthExpMax:210,pageClient:null,type:"",commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',commentCollBackTemplate:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a></p><p class="mt3 px12">{3}</p><p class="mt5 px12">{4}</p></div>',commentCollBackTemplate1:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a><span class="pl25">{3}</span></p><p class="mt5 px12">{4}</p></div>'},server:{AddTweetComment:function(p,q,n,l,k,o,j){var m=Mtime.isValue(n)?[p,q,n,l,false,0,false,k]:[p,q,0,l,false,0,false,k];return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","AddTweetCommentWithOptionCrossDomainByFlash",m,j,"/Service/Twitter.msi","post","20000",o)}},initializeDom:function(){this.$contentRegion=$(this.container);this.editors=[]},initializeEvent:function(){this.clickRegionHandler=this.onClickRegion.bind(this);Event.observe(this.$contentRegion,"click",this.clickRegionHandler);Event.observe(window,"unload",this.close.bind(this))},onClickRegion:function(u){var s=Event.element(u);var w=s.readAttribute("method");while(!w&&s!=document.body){s=s.up();w=s.readAttribute("method")}if(!w){return}switch(w){case"comment":Event.stop(u);var E=s.readAttribute("toggle");if(typeof E==="undefined"||E!=="1"){s.setAttribute("toggle","1")}else{return}var G=s.up(".mod_short");this.tweetid=G.readAttribute("tweetid");this.oldClickElementHtml=s.value;this.textarea=s;s.value="";s.style.height="60px";var y=s.up(".ele_replay");var A=s.up();A.style.height="60px";A.addClassName("focus");var x=Builder.build(this.commentTemplate);y&&y.appendChild(x);AutoHeight.startAuto(s);break;case"submit":Event.stop(u);var G=s.up(".mod_short");var F=G.readAttribute("tweetid");var r=G.down('[region="newcomment"]');var D=G.down("textarea");var t=D.value;var C;var B;B=B?B.checked:false;var v=Widgets.Utils.strLen(t);if(v>0&&v<=this.lengthExpMax&&!/^发表评论.*:$/.test(t)){var z=null;if(/发表评论.*:/.test(t)){z=this.replyParentid}if(this.pageClient&&!this.pageClient.isLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}this.server.AddTweetComment(t,F,this.replyParentid,C,B,s,function(b){if(b&&b.value&&this.addCommentErrorCheck(b)){if(!r){return}var c;if(this.type===""){c=this.commentCollBackTemplate}else{if(this.type==="movie"){c=this.commentCollBackTemplate1}}var a=String.format(c,[b.value.commentUserUrl,b.value.commentUserNickName,b.value.commentUserAvatar,b.value.commentTime,b.value.commentTextBody]);r.innerHTML=a;AutoHeight.stopAuto(D)}}.bind(this))}else{if(v==0||/^发表评论.*:$/.test(t)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{$alert("内容过长,请确认内容字符长度小于"+editor.lengthExp.max+"。",null,null,4)}AutoHeight.stopAuto(D)}break}},addCommentErrorCheck:function(j){var k=parseInt(j.value.success);if(k===1){var f=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"内容为空.";case -3:return"非法的用户.";case -4:return"微评不存在.";case -5:return"原回复已被删除.";case -6:return"在对方的黑名单中.";case -7:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var h=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"非法的用户.";case -3:return"原微评不存在.";case -4:return"原微评不存在.";case -5:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var g="";if(parseInt(j.value.commentId,10)<=0){g=f(parseInt(j.value.commentId,10))}if(!g&&j.value.isForward&&parseInt(j.value.forwardTweetId,10)<=0){g=h(parseInt(j.value.forwardTweetId,10))}if(!g&&j.value.isCommentToRoot&&parseInt(j.value.commentToRootId,10)<=0){g=f(parseInt(j.value.commentToRootId,10))}if(!g&&parseInt(j.value.replyResult,10)!=1){g=j.value.replyError||""}if(g){$alert(g,null,null,4);return false}else{return true}}else{if(k===-4){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-5){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-20){$alert("你发布的速度太快了，休息一下吧：）",null,null,4);return false}else{if(k===-30){$alert("非法用户",null,null,4);return false}}}}}}});Widgets.BlogComment=Class.create();Object.extend(Widgets.BlogComment.prototype,Widgets.Comment.prototype);Object.extend(Widgets.BlogComment.prototype,{options:{container:"",lengthExpMax:210,pageClient:null,clickTextareaCallBack:null,blurTextareaCallBack:null,isStyleChange:true,callback:null,commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',commentCollBackTemplate:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a></p><p class="mt3 px12">{3}</p><p class="mt5 px12">{4}</p></div>'},onClickRegion:function(p){var n=Event.element(p);var r=n.readAttribute("method");while(!r&&n!=document.body){n=n.up();r=n.readAttribute("method")}if(!r){return}switch(r){case"comment":Event.stop(p);var y=n.getAttribute("toggle");this.clickElement=n;if(typeof y==="undefined"||y!=="1"){n.setAttribute("toggle","1");var t=n.getAttribute("objid");var u=n.getAttribute("objtypeid");this.clickTextareaCallBack&&this.clickTextareaCallBack(u,t,n)}else{return}this.oldClickElementHtml=n.value;this.textarea=n;n.value="";n.style.height="60px";var v=n.up(".ele_replay");if(this.isStyleChange){var w=n.up();w.style.height="60px";w.addClassName("focus")}var s=Builder.build(this.commentTemplate);v&&v.appendChild(s);AutoHeight.startAuto(n);this.clickElementHandler=this.elementBlur.bind(this);Event.observe(n,"blur",this.clickElementHandler);break;case"submit":Event.stop(p);var v=n.up(".ele_replay");var x=v.down("textarea");var t=x.getAttribute("objid");var u=x.getAttribute("objtypeid");var o=x.value;var q=Widgets.Utils.strLen(o);if(q>0&&q<=this.lengthExpMax&&!/^发表评论.*:$/.test(o)){if(this.pageClient&&!this.pageClient.isLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}this.callback&&this.callback(o,u,t,x);if(!this.isStyleChange){AutoHeight.stopAuto(x,this.isStyleChange)}}else{if(q==0||/^发表评论.*:$/.test(o)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{$alert("内容过长,请确认内容字符长度小于"+editor.lengthExp.max+"。",null,null,4)}AutoHeight.stopAuto(x,this.isStyleChange)}break}},elementBlur:function(d){if(this.clickElement){var e=this.clickElement.getAttribute("objid");var f=this.clickElement.getAttribute("objtypeid");this.blurTextareaCallBack&&this.blurTextareaCallBack(f,e,this.clickElement);Event.stopObserving(this,"blur",this.clickElementHandler);e=f=this.clickElement=null}}});var GoodsComment=Class.create();Object.extend(GoodsComment.prototype,Widgets.Comment.prototype);Object.extend(GoodsComment.prototype,{options:{container:"",lengthExpMax:210,focusClassName:null,commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',callback:null,clickTextareaCallBack:null,blurTextareaCallBack:null},onClickRegion:function(o){var m=Event.element(o);var q=m.readAttribute("method");while(!q&&m!=document.body){m=m.up();q=m.readAttribute("method")}if(!q){var u=$$(".ele_replay")[0];var v=u.down("textarea");NewAutoHeight.stopAuto(v);return}switch(q){case"comment":Event.stop(o);var w=m.getAttribute("toggle");this.clickElement=m;if(typeof w==="undefined"||w!=="1"){m.setAttribute("toggle","1");var s=m.getAttribute("objid");var t=m.getAttribute("objtypeid");this.clickTextareaCallBack&&this.clickTextareaCallBack(t,s,m)}else{return}this.oldClickElementHtml=m.value;this.textarea=m;m.value="";m.style.height="60px";var u=m.up(".ele_replay");var r=Builder.build(this.commentTemplate);if(u){u.appendChild(r);if(this.focusClassName&&!u.hasClassName(this.focusClassName)){u.addClassName(this.focusClassName)}}NewAutoHeight.startAuto(m,this.focusClassName);break;case"submit":Event.stop(o);var u=m.up(".ele_replay");var v=u.down("textarea");var s=v.getAttribute("objid");var t=v.getAttribute("objtypeid");var n=v.value;var p=Widgets.Utils.strLen(n);if(p>0&&p<=this.lengthExpMax&&!/^发表评论.*$/.test(n)){this.callback&&this.callback(n,t,s,v);NewAutoHeight.stopAuto(v)}else{if(p==0||/^发表评论.*$/.test(n)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{NewAutoHeight.stopAuto(v);$alert("内容过长,请确认内容字符长度小于"+this.lengthExpMax+"。",null,null,4)}}break}}});var NewAutoHeight=Class.create();Object.extend(NewAutoHeight,{getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},cssList:["font-family","font-size","font-style","font-weight","font-variant","line-height","margin-top","margin-bottom","margin-left","margin-right","overflow-x","overflow-y","padding-top","padding-bottom","padding-left","padding-right","word-break","word-wrap"],startAuto:function(c,d){c=$(c);lengthExpMax=210;normalTemplate="还可以输入{0}字";NewAutoHeight.focusClassName=d;warnTemplate='<span class="c_red">字数超出{0}字</span>';this.handler=NewAutoHeight.auto.bind(c);Event.observe(c,"blur",this.handler);Event.observe(c,"focus",this.handler);Event.observe(c,"keyup",this.handler);Event.observe(c,"mouseup",this.handler);return NewAutoHeight.stopAuto.bind(c,this.handler)},auto:function(q){var z=this.up(".ele_replay").down('[_type="fd"]');var x=this.up();if(this.value.length==0){return}if(!NewAutoHeight.mirrorCtn){NewAutoHeight.mirrorCtn=$(Builder.node("div"));document.body.appendChild(NewAutoHeight.mirrorCtn);NewAutoHeight.mirrorCtn.style.opacity="0";NewAutoHeight.mirrorCtn.style.zIndex=-1000;NewAutoHeight.mirrorCtn.style.position="absolute"}mirrorCtn=NewAutoHeight.mirrorCtn;cssList=NewAutoHeight.cssList;styleObj={};for(var r=0,s=cssList.length,l,y,u;r<s;++r){l=cssList[r];if((y=this.getStyle(l))){styleObj[l]=y}}mirrorCtn.setStyle(styleObj);mirrorCtn.setStyle({width:this.offsetWidth+"px"});var A=this.value;if(A.lastIndexOf("\n")!=-1&&A.lastIndexOf("\n")+1==A.length){A+="占"}mirrorCtn.innerHTML=A.replace(/\n/g,"<br/>");var w=NewAutoHeight.getXY(this);mirrorCtn.style.top=w.y+"px";mirrorCtn.style.left=w.x+"px";var v=mirrorCtn.offsetHeight;if(v<60){v=60}if(A){var t=Widgets.Utils.strLen(A),o;if(t>0){o=lengthExpMax-t;if(o>=0){z.innerHTML=String.format(normalTemplate,[o])}else{z.innerHTML=String.format(warnTemplate,[Math.abs(o)])}}}z=x=v=null},stopAuto:function(d){var e=d.up(".ele_replay");if(!e){return}var f=e.down(".mt6");f&&f.remove();d.value="发表评论";if(NewAutoHeight.focusClassName&&e.hasClassName(NewAutoHeight.focusClassName)){e.removeClassName(NewAutoHeight.focusClassName)}e.style.height=d.style.height="40px";d.setAttribute("toggle","0");Event.stopObserving(d,"blur",NewAutoHeight.handler);Event.stopObserving(d,"focus",NewAutoHeight.handler);Event.stopObserving(d,"keyup",NewAutoHeight.handler);Event.stopObserving(d,"mouseup",NewAutoHeight.handler)}});Widgets.DistanceSlidesControl=Class.create();Object.extend(Widgets.DistanceSlidesControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.DistanceSlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",showRegionWidth:695,slidesRegionWidth:1000,currentPosition:0,itemWidth:0,duration:0.5,type:"neat"},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.$prev=$(this.prev);this.$next=$(this.next);this.span=this.$next.next("span.shadow")},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.$prev,"click",this.onPrevClickHandler);Event.observe(this.$next,"click",this.onNextClickHandler);Event.observe(window,"unload",this.close.bind(this))},load:function(){this.reset()},onLoader:function(b){},getItems:function(){this.$slidesRegions=this.$slidesRegion.immediateDescendants();this.length=this.$slidesRegions.length;if(this.itemWidth>0){this.amount=this.itemWidth*this.length}else{for(var b=0;b<this.length;b++){this.amount+=this.$slidesRegions[b].clientWidth}}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth)},reset:function(){this.isReset=true;this.currentPosition=0;this.$slidesRegion.style.left=this.currentPosition+"px";this.pageIndex=0;this.amount=0;this.getItems();if(this.amount>this.slidesRegionWidth){this.$next.show();if(this.currentPosition===0){this.$prev.hide()}else{this.$prev.show()}}else{this.$prev.hide();this.$next.hide()}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$next.show();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.$prev.hide()}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.prevSlides()}},onNextClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$prev.show();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){var e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.nextSlides()}},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();if(this.span){this.span.show()}this.pageIndex--;d=this.slidesRegionWidth;if(this.pageIndex<=0){d=Math.abs(this.currentPosition);this.$prev.hide()}c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0}}.bind(this)};this.move(c);this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.$prev.show();this.pageIndex++;var e;f=-this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e)}}.bind(this)};this.move(d);this.currentPosition-=this.slidesRegionWidth},move:function(b){this.lock=true;new Fx.Move(b.node,{scaleX:true,duration:b.duration,distances:{left:b.scale,position:b.position},callback:function(){this.lock=false;b.callback&&b.callback()}.bind(this)})},destroyEvent:function(){this.onPrevClickHandler&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.$next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null}});Widgets.indexDistanceSlidesControl=Class.create();Object.extend(Widgets.indexDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.indexDistanceSlidesControl.prototype,{initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.$prev=$(this.prev);this.$next=$(this.next);this.spanr=this.$next.next("i.shadowr");this.spanl=this.$next.next("i.shadowl");this.spanl&&(this.spanl.hide())},getItems:function(){this.$slidesRegions=this.$slidesRegion.immediateDescendants();this.length=this.$slidesRegions.length;if(this.itemWidth>0){this.amount=this.itemWidth*this.length}else{for(var b=0;b<this.length;b++){this.amount+=this.$slidesRegions[b].clientWidth}}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth)-1},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.spanr.show();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$next.show();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.$prev.hide();this.spanl&&(this.spanl.hide())}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.prevSlides()}},onNextClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.spanl.show();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$prev.show();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;this.$slidesRegion.style.left=this.currentPosition+"px";if(this.pageIndex>=this.amountIndex-1){var e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.$next.hide();this.spanr&&(this.spanr.hide())}}else{this.nextSlides()}},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();this.pageIndex--;d=this.slidesRegionWidth;c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0;this.spanl&&(this.spanl.hide())}}.bind(this)};this.move(c);if(this.pageIndex<=0){this.pageIndex=0;d=Math.abs(this.currentPosition);this.$prev.hide()}this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.$prev.show();this.pageIndex++;var e;f=-this.slidesRegionWidth;d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.spanr&&(this.spanr.hide())}}.bind(this)};this.move(d);if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.$next.hide();if(this.span){this.span.hide()}}this.currentPosition-=this.slidesRegionWidth}});Widgets.ShowButtonDistanceSlidesControl=Class.create();Object.extend(Widgets.ShowButtonDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.ShowButtonDistanceSlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",prevCss:"",nextCss:"",showRegionWidth:695,slidesRegionWidth:1000,currentPosition:0,itemWidth:0,duration:0.5,type:"neat"},reset:function(){this.isReset=true;this.currentPosition=0;this.$slidesRegion.style.left=this.currentPosition+"px";this.pageIndex=0;this.amount=0;this.getItems();if(this.amount>this.slidesRegionWidth){this.showNextbtn();if(this.currentPosition===0){this.hidePrevbtn()}else{this.showPrevbtn()}}else{this.$prev.hide();this.$next.hide()}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.showNextbtn();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.hidePrevbtn()}this.$slidesRegion.style.left=this.currentPosition+"px"},showPrevbtn:function(){if(this.prevCss!=""){if(this.$prev.hasClassName(this.prevCss)){this.$prev.removeClassName(this.prevCss)}}else{this.$prev.show()}},hidePrevbtn:function(){if(this.prevCss!=""){if(!this.$prev.hasClassName(this.prevCss)){this.$prev.addClassName(this.prevCss)}}else{this.$prev.show()}},showNextbtn:function(){if(this.nextCss!=""){if(this.$next.hasClassName(this.nextCss)){this.$next.removeClassName(this.nextCss)}}else{this.$next.show()}},hideNextbtn:function(){if(this.nextCss!=""){if(!this.$next.hasClassName(this.nextCss)){this.$next.addClassName(this.nextCss)}}else{this.$next.hide()}},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.showPrevbtn();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){this.hideNextbtn();if(this.span){this.span.hide()}}this.$slidesRegion.style.left=this.currentPosition+"px"},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();this.showNextbtn();if(this.span){this.span.show()}this.pageIndex--;d=this.slidesRegionWidth;if(this.pageIndex<=0){d=Math.abs(this.currentPosition);this.hidePrevbtn()}c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0}}.bind(this)};this.move(c);this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var d=null;var f=0;this.showPrevbtn();this.pageIndex++;var e;f=-this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;f=f+(this.slidesRegionWidth-e);this.hideNextbtn();if(this.span){this.span.hide()}}d={node:this.slidesRegion,duration:this.duration,scale:f,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){e=(this.amount-this.showRegionWidth)%this.slidesRegionWidth;this.currentPosition=this.currentPosition+(this.slidesRegionWidth-e)}}.bind(this)};this.move(d);this.currentPosition-=this.slidesRegionWidth}});Widgets.WholePageDistanceSlidesControl=Class.create();Object.extend(Widgets.WholePageDistanceSlidesControl.prototype,Widgets.DistanceSlidesControl.prototype);Object.extend(Widgets.WholePageDistanceSlidesControl.prototype,{onPrevClick:function(d){if(this.lock){return}var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.$next.show();var e=this.currentPosition;this.currentPosition+=this.slidesRegionWidth;if(this.currentPosition>=0){this.currentPosition=0;this.$prev.hide()}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px";setTimeout(function(){this.lock=false}.bind(this),600)}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}},onNextClick:function(d){if(this.lock){return}var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}this.$prev.show();this.pageIndex++;var e=this.currentPosition;this.currentPosition-=this.slidesRegionWidth;if((this.showRegionWidth-this.currentPosition)>=this.amount){this.currentPosition=-(this.amount-this.showRegionWidth);this.$next.hide();if(this.span){this.span.hide()}}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px";setTimeout(function(){this.lock=false}.bind(this),600)}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}},slideMethod:function(e,h,f){var g={element:e,duration:this.duration,speed:10,startScale:h,endScale:f,callback:function(){this.lock=false}.bind(this)};this.lock=true;this.move(g)},move:function(k){var m=k.speed;var h=k.startScale;var j=k.endScale;var g=k.startScale;function l(){var a=false;if(h>j){g-=m;if(g<=j){g=j;a=true}}else{if(h<j){g+=m;if(g>=j){g=j;a=true}}else{g=j;a=true}}k.element.setStyle({left:g+"px"});if(a){k.callback()}else{setTimeout(l,k.duration)}}l()}});Widgets.FilterComponent=Class.create();Object.extend(Widgets.FilterComponent.prototype,Widgets.Base.prototype);Object.extend(Widgets.FilterComponent.prototype,{options:{container:"filters",filterArray:["最新","最热","最近三个月"],currentIndex:0,callback:null,filterWidth:50,itemWidth:15},initializeDom:function(){this.$container=$(this.container);this.builderHtml()},initializeEvent:function(){if(this.$filterContainer){this.containerOverHandler=this.containerOver.bind(this);Event.observe(this.$filterContainer,"mouseover",this.containerOverHandler);this.containerOutHandler=this.containerOut.bind(this);Event.observe(this.$filterContainer,"mouseout",this.containerOutHandler)}if(this.$dbSeldrop){this.dbSeldropClickHandler=this.dbSeldropClick.bind(this);Event.observe(this.$dbSeldrop,"click",this.dbSeldropClickHandler)}Event.observe(window,"unload",this.close.bind(this))},containerOver:function(b){this.handleOutTimer();Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout)}this.$filterContainer.addClassName("open");this.$filterContainer.style.height=this._height+25+"px";this.$dbSeldrop.style.height=this._height+"px";this.$filterContainer.style.width=this._width+"px"},300,this)},containerOut:function(b){this.handleOutTimer();Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){this.$filterContainer.style.height="0px";this.$dbSeldrop.style.height="0px";FunctionExt.defer(function(){this.$filterContainer.removeClassName("open");this.$filterContainer.style.width=this.currentTxtWidth+"px"},100,this)},100,this)},dbSeldropClick:function(g){var f=Event.findElement(g,"p"),j=f.readAttribute("serial"),h=this.currentIndex;this.currentIndex=parseInt(j,10);var k=this.filterArray[this.currentIndex];if(k===this.$currentBtn.innerHTML){return}f.addClassName("active");this.$dbSeldrops[h].removeClassName("active");this.$currentBtn.innerHTML=k;this.callback&&this.callback(j);this.currentTxtWidth=this.filterWidth+this.itemWidth*Widgets.Utils.strLen(k);this.containerOut(g)},handleOutTimer:function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout);this.collectBoxTimeout=null}},builderHtml:function(){var j=25,k=Widgets.Utils.strArrayMax(this.filterArray),g=this.filterArray.length,h=new StringBuilder(),f=this.filterArray[this.currentIndex];this.currentTxtWidth=this.filterWidth+this.itemWidth*Widgets.Utils.strLen(f);this._height=j*g;this._width=this.filterWidth+this.itemWidth*k;this.$container.style.width=this.currentTxtWidth+"px";h.append('<div id="filterContainer" class="db_selinner" style="width:'+this.currentTxtWidth+'px"><i></i>');h.append('<div id="currentBtn" method="currentBtn" class="db_selon">'+f+"</div>");h.append('<div id="dbseldrop" class="db_seldrop">');for(i=0;i<g;i++){if(i===this.currentIndex){h.append('<p serial="'+i+'" class="active"><em></em>'+this.filterArray[i]+"</p>")}else{h.append('<p serial="'+i+'"><em></em>'+this.filterArray[i]+"</p>")}}h.append("</div></div>");this.$container.innerHTML=h.toString();this.$filterContainer=$("filterContainer");this.$currentBtn=$("currentBtn");this.$dbSeldrop=$("dbseldrop");this.$dbSeldrops=this.$dbSeldrop.immediateDescendants()},destroyEvent:function(){if(this.$filterContainer){Event.stopObserving(this.$filterContainer,"mouseover",this.containerOverHandler);Event.stopObserving(this.$filterContainer,"mouseout",this.containerOutHandler)}if(this.$dbSeldrop){Event.stopObserving(this.$dbSeldrop,"click",this.dbSeldropClickHandler)}},destroyDOM:function(){this.containerOverHandler=null;this.containerOutHandler=null;this.dbSeldropClickHandler=null;this.$filterContainer=null;this.$dbSeldrop=null;this.$container=null;this.$currentBtn=null;this.$dbSeldrops=null}});Widgets.FixSpan=Class.create();Object.extend(Widgets.FixSpan.prototype,Widgets.Base.prototype);Object.extend(Widgets.FixSpan.prototype,{options:{container:"",prev:"",next:""},initializeDom:function(b){if(this.container){this.$container=$(this.container);this.$conParent=this.$container.up();this.$conTop=this.$conParent.previous()}if(this.prev){this.$prev=$(this.prev);this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.next){this.$next=$(this.next);this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}this.viewWidth=document.documentElement.clientWidth;if(this.$conParent){this.fixHeight=this.$conTop.offsetHeight+this.$conParent.offsetHeight}if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");this.$prev.addClassName("fixed1024")}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");this.$next.addClassName("fixed1024")}}if(Mtime.browser.ie===6){this.$prev.style.position="absolute";this.$prev.style.marginLeft=-275+"px";this.$prev.style.top=299+"px";this.$next.style.position="absolute";this.$next.style.marginLeft=235+"px";this.$next.style.top=299+"px";if(this.viewWidth<=1100){this.$prev.style.marginLeft=-225+"px";this.$next.style.marginRight=0;this.$next.style.right=50+"px"}}},initializeEvent:function(){this.fixedSpanHandler=this.fixedSpan.bind(this);this.resizeSpanHandler=this.resizeSpan.bind(this);Event.observe(window,"scroll",this.fixedSpanHandler);Event.observe(window,"resize",this.resizeSpanHandler);Event.stopObserving(window,"unload",this.close.bind(this))},resizeSpan:function(){this.viewWidth=document.documentElement.clientWidth;if(this.$prev&&Mtime.browser.ie!==6&&this.fixHeight>this.tHeight){this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.$next&&Mtime.browser.ie!==6&&this.fixHeight>this.tHeight){this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");this.$prev.addClassName("fixed1024")}if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px"}else{this.$prev.style.left=""}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");this.$next.addClassName("fixed1024")}if(this.fixHeight<=this.tHeight){this.$next.style.marginRight=(this.viewWidth-1000)/2+"px"}else{this.$next.style.right=""}if(Mtime.browser.ie===6){if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px"}else{this.$prev.style.marginLeft=-225+"px";this.$prev.style.left=""}this.$next.style.marginRight=0;this.$next.style.right=50+"px"}}else{if(this.$prev.hasClassName("fixed1024")){this.$prev.removeClassName("fixed1024");this.$prev.addClassName("fixed")}if(this.fixHeight<=this.tHeight){this.$prev.style.left="";this.$prev.style.marginLeft=""}else{this.$prev.style.left=""}if(this.$next.hasClassName("fixed1024")){this.$next.removeClassName("fixed1024");this.$next.addClassName("fixed")}if(this.fixHeight<=this.tHeight){this.$next.style.right="";this.$next.style.marginRight=""}else{this.$next.style.right=""}if(Mtime.browser.ie===6){if(this.fixHeight<=this.tHeight){this.$prev.style.marginLeft=0;this.$prev.style.left=0}else{this.$prev.style.marginLeft=-275+"px";this.$prev.style.left=""}this.$next.style.marginLeft=235+"px";this.$next.style.marginRight="";this.$next.style.right=""}}},fixedSpan:function(){this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;this.tHeight=this.scrollTop+document.documentElement.clientHeight;if(this.$prev&&Mtime.browser.ie!==6&&this.fixHeight<=this.tHeight){this.prevTopHeight=this.$prev.offsetTop-this.$prev.offsetHeight*2}if(this.$next&&Mtime.browser.ie!==6&&this.fixHeight<=this.tHeight){this.nextTopHeight=this.$next.offsetTop-this.$next.offsetHeight*2}this.viewWidth=document.documentElement.clientWidth;this.prevDynamicHeight=this.prevTopHeight+this.$prev.offsetHeight*2+16;this.nextDynamicHeight=this.nextTopHeight+this.$next.offsetHeight*2+16;if(this.fixHeight<=this.tHeight){if(this.viewWidth<=1100){if(this.$prev.hasClassName("fixed1024")){this.$prev.removeClassName("fixed1024");if(Mtime.browser.ie){this.$prev.style.top=this.prevDynamicHeight+this.scrollTop+"px";this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px";this.ie6UnFix(this.$prev,this.$prev.offsetTop+220)}}else{this.$prev.style.top=this.prevTopHeight+this.scrollTop+"px";this.$prev.style.marginLeft=(this.viewWidth-1000)/2+"px"}}if(this.$next.hasClassName("fixed1024")){this.$next.removeClassName("fixed1024");if(Mtime.browser.ie){this.$next.style.top=this.nextDynamicHeight+this.scrollTop+"px";this.$next.style.marginRight=(this.viewWidth-1000)/2+"px";if(this.viewWidth<1000){this.$next.style.marginRight=-(this.viewWidth-1000)/2+"px"}if(Mtime.browser.ie===6){this.$next.style.marginRight=0;this.$next.style.right=50+"px";this.ie6UnFix(this.$next,this.$next.offsetTop+220)}}else{this.$next.style.top=this.nextTopHeight+this.scrollTop+"px";this.$next.style.marginRight=(this.viewWidth-1000)/2+"px";if(this.viewWidth<1000){this.$next.style.marginRight=-(this.viewWidth-1000)/2+"px"}}}}else{if(this.$prev.hasClassName("fixed")){this.$prev.removeClassName("fixed");if(Mtime.browser.ie){this.$prev.style.top=this.prevDynamicHeight+this.scrollTop+"px";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.ie6UnFix(this.$prev,this.$prev.offsetTop+218)}}else{this.$prev.style.top=this.prevTopHeight+this.scrollTop+"px"}}if(this.$next.hasClassName("fixed")){this.$next.removeClassName("fixed");if(Mtime.browser.ie){this.$next.style.top=this.nextDynamicHeight+this.scrollTop+"px";if(Mtime.browser.ie===6){this.$next.style.marginLeft=0;this.ie6UnFix(this.$next,this.$next.offsetTop+218)}}else{this.$next.style.top=this.nextTopHeight+this.scrollTop+"px"}}}}else{if(this.viewWidth<=1100){if(!this.$prev.hasClassName("fixed1024")){this.$prev.addClassName("fixed1024");this.$prev.style.top="";this.$prev.style.left="";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=0;this.$prev.style.left=50+"px"}else{this.$prev.style.marginLeft=""}}if(!this.$next.hasClassName("fixed1024")){this.$next.addClassName("fixed1024");this.$next.style.top="";this.$next.style.right="";if(Mtime.browser.ie===6){this.$next.style.marginLeft=0;this.$next.style.right=50+"px"}else{this.$next.style.marginRight=""}}if(Mtime.browser.ie===6&&this.$next.hasClassName("fixed1024")&&this.$prev.hasClassName("fixed1024")){this.ie6Fix(this.$prev,this.prevDynamicHeight+203);this.ie6Fix(this.$next,this.nextDynamicHeight+203)}}else{if(!this.$prev.hasClassName("fixed")){this.$prev.addClassName("fixed");this.$prev.style.top="";this.$prev.style.left="";if(Mtime.browser.ie===6){this.$prev.style.marginLeft=-275+"px"}}if(!this.$next.hasClassName("fixed")){this.$next.addClassName("fixed");this.$next.style.top="";this.$next.style.right="";if(Mtime.browser.ie===6){this.$next.style.marginLeft=235+"px"}}if(Mtime.browser.ie===6&&this.$next.hasClassName("fixed")&&this.$prev.hasClassName("fixed")){this.ie6Fix(this.$prev,this.prevDynamicHeight+203);this.ie6Fix(this.$next,this.nextDynamicHeight+203)}}}},ie6Fix:function(c,d){document.documentElement.style.backgroundImage="url(about:blank)";document.documentElement.style.backgroundAttachment="fixed";!isNaN(d)&&c.style.setExpression("top","eval(document.documentElement.scrollTop + "+d+")")},ie6UnFix:function(c,d){document.documentElement.style.backgroundImage="";document.documentElement.style.backgroundAttachment="";!isNaN(d)&&c.style.setExpression("top","eval("+d+") + 'px'")},destroyEvent:function(){if(this.fixedSpanHandler){Event.stopObserving(window,"scroll",this.fixedSpanHandler)}if(this.resizeSpanHandler){Event.stopObserving(window,"resize",this.resizeSpanHandler)}},destroyDOM:function(){this.$container=null;this.$conParent=null;this.$conTop=null;this.$prev=null;this.$next=null;this.viewWidth=null;this.fixHeight=null;this.prevTopHeight=null;this.nextTopHeight=null;this.scrollTop=null;this.tHeight=null}});Widgets.IndexTopSlidesControl=Class.create();Object.extend(Widgets.IndexTopSlidesControl.prototype,Widgets.BehindSlidesControl.prototype);Object.extend(Widgets.IndexTopSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",dotSlidesRegion:"",backSlidesRegion:"",txtSlidesRegion:"",advertisementRegion:"",prev:"prev",next:"next",autoTimeout:null,items:[],imageTemplate:"",duration:0.5,type:"neat",toRemoveFrames:[]},initializeDom:function(){this.removeFrames(this.toRemoveFrames);this.$slidesRegion=$(this.slidesRegion);if(!this.$slidesRegion){return}this.$presentNumber=$(this.presentNumber);this.$sumNumber=$(this.sumNumber);this.$titleTxt=$(this.titleTxt);this.$describeTxt=$(this.describeTxt);this.$images=this.$slidesRegion.immediateDescendants();this.imagesLen=this.$images.length;if(this.$sumNumber){this.$sumNumber.innerHTML="/"+this.imagesLen}this.presentNum=1;if(this.$presentNumber){this.$presentNumber.innerHTML=this.presentNum}if(this.$titleTxt){this.$titleTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("title"),24)}if(this.$describeTxt){this.$describeTxt.innerHTML=Widgets.Utils.strShort(this.$images[0].readAttribute("imgabstract"),46)}},removeFrames:function(d){if(!d||d.length==0){return}this.$slidesRegion=$(this.slidesRegion);if(this.$slidesRegion){this.$slidesRegions=this.$slidesRegion.immediateDescendants()}this.$dotSlidesRegion=$(this.dotSlidesRegion);if(this.$dotSlidesRegion){this.$dotSlidesRegions=this.$dotSlidesRegion.immediateDescendants()}this.$backSlidesRegion=$(this.backSlidesRegion);if(this.$backSlidesRegion){this.$backSlidesRegions=this.$backSlidesRegion.immediateDescendants()}this.$txtSlidesRegion=$(this.txtSlidesRegion);if(this.$txtSlidesRegion){this.$txtSlidesRegions=this.$txtSlidesRegion.immediateDescendants()}this.$advertisementRegion=$(this.advertisementRegion);if(this.$advertisementRegion){this.$advertisementRegions=this.$advertisementRegion.immediateDescendants()}for(var c=0;c<d.length;c++){this.removeFrame(this.$slidesRegions,d[c]);this.removeFrame(this.$dotSlidesRegions,d[c]);this.removeFrame(this.$backSlidesRegions,d[c]);this.removeFrame(this.$txtSlidesRegions,d[c]);this.removeFrame(this.$advertisementRegions,d[c])}},removeFrame:function(d,c){if(!d||d.length==0){return}if(d.length>c){$(d[c]).remove()}},destroyDOM:function(){this.$presentNumber=null;this.$sumNumber=null;this.$titleTxt=null;this.$describeTxt=null;this.$images=null;this.imagesLen=null;if(this.mySlidesControl){this.mySlidesControl.close()}},instanceSlidesControl:function(){if(!this.$slidesRegion){return}var b=this;this.mySlidesControl=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.length=0;if(this.slidesRegion){this.items=this.slidesRegion.immediateDescendants();this.length=this.items.length;this.clientHeight=document.documentElement.clientHeight||document.body.clientHeight}this.lock=false;this.$dotSlidesRegion=$(b.dotSlidesRegion);if(this.$dotSlidesRegion){this.$dotSlidesRegions=this.$dotSlidesRegion.immediateDescendants()}this.$backSlidesRegion=$(b.backSlidesRegion);if(this.$backSlidesRegion){this.$backSlidesRegions=this.$backSlidesRegion.immediateDescendants()}this.$txtSlidesRegion=$(b.txtSlidesRegion);if(this.$txtSlidesRegion){this.$txtSlidesRegions=this.$txtSlidesRegion.immediateDescendants();if(this.$txtSlidesRegions){var a=this.$txtSlidesRegions[0];var f=a.getAttribute("rectype");if(f==="special"){this.$txtSlidesRegion.style.zIndex=1}}}this.$adRegion=$(b.advertisementRegion);if(this.$adRegion){this.$adRegion.style.display="none";this.$adRegions=this.$adRegion.immediateDescendants()}this.prevIndex=0;for(var e=0;e<this.length;e++){if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].adClose=this.$adRegions[e].down('i[method="close"]');this.$adRegions[e].adTip=this.$adRegions[e].down('div[method="tip"]');if(this.$adRegions[e].adTip&&this.$adRegions[e].adTip.childElements().length>0){this.$adRegions[e].removeClassName("none");this.$adRegions[e].setAttribute("tiptype","1")}}if(e===0){this.items[e].style.opacity=1;this.items[e].style.zIndex=3;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].style.opacity=1;this.$adRegions[e].style.zIndex=3;if(this.$adRegions[e].adTip&&this.$adRegions[e].adTip.childElements().length>0){this.$adRegion.style.display="block"}}if(this.$txtSlidesRegion&&this.$txtSlidesRegions&&this.$txtSlidesRegions.length>0){this.$txtSlidesRegions[e].style.opacity=1;this.$txtSlidesRegions[e].style.display="block"}if(this.$dotSlidesRegion&&this.$dotSlidesRegions&&this.$dotSlidesRegions.length>0){if(this.$dotSlidesRegions.length==1){this.$dotSlidesRegion.style.display="none";if(this.prev){this.prev.style.display="none"}if(this.next){this.next.style.display="none"}}else{this.$dotSlidesRegions[e].addClassName("on")}}}else{if(Mtime.browser.ie>0&&Mtime.browser.ie<=9){this.items[e].style.display="none"}this.items[e].style.opacity=0;this.items[e].style.zIndex=1;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.$adRegions[e].style.opacity=0;this.$adRegions[e].style.zIndex=1}}}this.timeOutMethod()},initializeEvent:function(){this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);this.slidesRegionClickHendler=this.slidesRegionClick.bind(this);if(this.slidesRegion){Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)}if(this.$adRegion){Event.observe(this.$adRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.$adRegion,"mouseout",this.slidesRegionOutHendler);Event.observe(this.$adRegion,"click",this.slidesRegionClickHendler)}if(this.prev){this.onPrevClickHandler=this.onPrevClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.prev,"mouseover",this.slidesRegionOverHendler);Event.observe(this.prev,"mouseout",this.slidesRegionOutHendler)}if(this.next){this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.next,"click",this.onNextClickHandler);Event.observe(this.next,"mouseover",this.slidesRegionOverHendler);Event.observe(this.next,"mouseout",this.slidesRegionOutHendler)}if(this.$dotSlidesRegion){this.dotSlidesRegionClickHandler=this.dotSlidesRegionClick.bind(this);Event.observe(this.$dotSlidesRegion,"click",this.dotSlidesRegionClickHandler);Event.observe(this.$dotSlidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.$dotSlidesRegion,"mouseout",this.slidesRegionOutHendler)}Event.observe(window,"unload",this.close.bind(this))},onPrevClick:function(a){var d=a.target||a.srcElement;Event.stop(a);if(this.lock){return}if(this.amount&&this.currentIndex<1){this.currentIndex=this.amount-1}else{if(this.currentIndex<1){this.currentIndex=this.length-1}else{this.currentIndex--}}this.myTimeout&&clearTimeout(this.myTimeout);this.move()},onNextClick:function(a){var d=a.target||a.srcElement;Event.stop(a);if(this.lock){return}if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.myTimeout&&clearTimeout(this.myTimeout);this.move()},move:function(a){this.lock=true;this.slidesRegionMethod();this.backSlidesRegionsMethod();this.dotSlidesRegionsMethod();this.txtSlidesRegionsMethod();this.prevIndex=this.currentIndex},slidesRegionMethod:function(){if(this.slidesRegion){var q=this.items[this.prevIndex],p=this.items[this.currentIndex],a,l,o,n,k,m;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){a=this.$adRegions[this.prevIndex];l=this.$adRegions[this.currentIndex];o=this.$adRegions[this.currentIndex].adTip;n=l.getAttribute("tiptype");k=a.getAttribute("tiptype");m=l.getAttribute("tiptype")}if(q!==p){if(!q.hasClassName("transition8")){q.addClassName("transition8")}if(!p.hasClassName("transition8")){p.addClassName("transition8")}if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){if(!a.hasClassName("transition8")){a.addClassName("transition8")}if(!l.hasClassName("transition8")){l.addClassName("transition8")}this.beforeAdMthod(l,o,n)}p.style.zIndex=3;q.style.zIndex=1;q.style.opacity=0;p.style.opacity=1;if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){n=l.getAttribute("tiptype");if(n){a.style.zIndex=1;l.style.zIndex=3;a.style.opacity=0;l.style.opacity=1;a.style.filter="alpha(opacity=0)";l.style.filter="alpha(opacity=100)"}else{if(this.$adRegion){this.$adRegion.style.display="none";a.addClassName("none");l.addClassName("none");a.style.zIndex=1;l.style.zIndex=1;a.style.opacity=0;l.style.opacity=0;a.style.filter="alpha(opacity=0)";l.style.filter="alpha(opacity=0)"}}}if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.timeOutMethod();if(this.$adRegion&&this.$adRegions&&this.$adRegions.length>0){this.afterAdMethod(a,k)}if(!this.$txtSlidesRegions||(this.$txtSlidesRegions&&this.$txtSlidesRegions.length<=0)){this.lock=false}q=p=a=l=o=k=m=n=null}.bind(this),800)}else{this.lock=false;q.style.display="none";p.style.display="block";this.timeOutMethod();this.afterAdMethod(a,k);q=p=a=l=o=k=m=n=null}}}},beforeAdMthod:function(a,f,e){if(!e&&f&&f.childElements().length>0){a.removeClassName("none");a.setAttribute("tiptype","1");if(this.$adRegion){this.$adRegion.style.display="block"}}else{if(e==="1"){if(this.$adRegion){this.$adRegion.style.display="block"}}}},afterAdMethod:function(a,d){if(d==="1"){a.addClassName("none");a.setAttribute("tiptype","2")}if(d==="2"){a.removeClassName("none");a.setAttribute("tiptype","1")}},backSlidesRegionsMethod:function(){if(this.$backSlidesRegions){var d=this.$backSlidesRegions[this.prevIndex],a=this.$backSlidesRegions[this.currentIndex];if(d!==a){if(!d.hasClassName("transition3")){d.addClassName("transition3")}if(!a.hasClassName("transition3")){a.addClassName("transition3")}a.style.opacity=1;d.style.opacity=0;if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){a.style.zIndex=3;d.style.zIndex=1;d=a=null}.bind(this),300)}else{a.style.zIndex=3;d.style.zIndex=1;d=a=null}}}},dotSlidesRegionsMethod:function(){if(this.$dotSlidesRegions){var d=this.$dotSlidesRegions[this.prevIndex],a=this.$dotSlidesRegions[this.currentIndex];if(d.hasClassName("on")){d.removeClassName("on")}if(!a.hasClassName("on")){a.addClassName("on")}d=a=null}},txtSlidesRegionsMethod:function(){if(this.$txtSlidesRegions){var e=this.$txtSlidesRegions[this.prevIndex],a=this.$txtSlidesRegions[this.currentIndex];if(e!==a){if(this.$txtSlidesRegion.style.zIndex==="1"||this.$txtSlidesRegion.style.zIndex===1){this.$txtSlidesRegion.style.zIndex=3}if(!e.hasClassName("transition4")){e.addClassName("transition4")}var f=a.getAttribute("rectype");if(f==="special"){this.$txtSlidesRegion.style.zIndex=1}if(!a.hasClassName("transition6")){a.addClassName("transition6")}if(Mtime.browser.ie===0||Mtime.browser.ie>9){e.style.opacity=0;FunctionExt.defer(function(){a.style.display="block";e.style.display="none"}.bind(this),400);FunctionExt.defer(function(){a.style.opacity=1;this.lock=false;e=a=f=null}.bind(this),600)}else{a.style.opacity=1;a.style.display="block";e.style.display="none";e=a=f=null}}}},dotSlidesRegionClick:function(h){Event.stop(h);var g=Event.element(h),k;var a=this.$dotSlidesRegion.immediateDescendants(),j;if(g&&!g.hasClassName("on")){if(this.lock){return}k=parseInt(g.innerHTML,10);if(!isNaN(k)){for(j=0;j<a.length;j++){if(a[j].innerHTML==k){this.currentIndex=j;this.move();console.log(a[j].innerHTML+"=="+j)}}}}},timeOutMethod:function(){this.myTimeout&&clearTimeout(this.myTimeout);var a,e=false,f;f=this.getXY(this.slidesRegion);a=document.documentElement.scrollTop||document.body.scrollTop;if(f.y>(a-400)&&f.y<(a+this.clientHeight+550)){e=true}if(this.autoTimeout){if(e){this.myTimeout=setTimeout(function(){f=this.getXY(this.slidesRegion);a=document.documentElement.scrollTop||document.body.scrollTop;if(f.y>(a-400)&&f.y<(a+this.clientHeight+550)){e=true}else{e=false}if(e){if(this.amount&&this.currentIndex>this.amount-2){this.currentIndex=0}else{if(this.currentIndex>this.length-2){this.currentIndex=0}else{this.currentIndex++}}this.nextSlides()}else{this.myTimeout=setTimeout(function(){this.timeOutMethod()}.bind(this),3000)}a=e=f=null}.bind(this),this.autoTimeout*1000)}else{a=e=f=null;this.myTimeout=setTimeout(function(){this.timeOutMethod()}.bind(this),3000)}}},slidesRegionOver:function(a){this.myTimeout&&clearTimeout(this.myTimeout)},slidesRegionOut:function(a){this.timeOutMethod()},slidesRegionClick:function(f){var a=Event.element(f);var h=a.getAttribute("method");if(h==="close"){Event.stop(f);var g=a.up("div.ddtiper");if(g.getAttribute("method")==="tipbox"){g.addClassName("none");if(this.$adRegion){this.$adRegion.style.display="none"}}}},getXY:function(j){var k=0,l=0;if(j.getBoundingClientRect){var a=j.getBoundingClientRect();var h=document.documentElement;k=Math.round(a.left+Math.max(h.scrollLeft,document.body.scrollLeft)-h.clientLeft);l=Math.round(a.top+Math.max(h.scrollTop,document.body.scrollTop)-h.clientTop)}else{for(;j!=document.body;k+=j.offsetLeft,l+=j.offsetTop,j=j.offsetParent){}}return{x:k,y:l}},close:function(){this.destroyEvent();this.destroyDOM()},destroyEvent:function(){if(this.$adRegion){Event.stopObserving(this.$adRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.$adRegion,"mouseout",this.slidesRegionOutHendler);Event.stopObserving(this.$adRegion,"click",this.slidesRegionClickHendler)}if(this.slidesRegion){Event.stopObserving(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)}if(this.prev){Event.stopObserving(this.prev,"click",this.onPrevClickHandler);Event.stopObserving(this.prev,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.prev,"mouseout",this.slidesRegionOutHendler)}if(this.next){Event.stopObserving(this.next,"click",this.onNextClickHandler);Event.stopObserving(this.next,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.next,"mouseout",this.slidesRegionOutHendler)}if(this.$dotSlidesRegion){Event.stopObserving(this.$dotSlidesRegion,"click",this.dotSlidesRegionClickHandler);Event.stopObserving(this.$dotSlidesRegion,"mouseover",this.slidesRegionOverHendler);Event.stopObserving(this.$dotSlidesRegion,"mouseout",this.slidesRegionOutHendler)}},destroyDOM:function(){this.$adRegion=null;this.slidesRegion=null;this.prev=null;this.next=null;this.currentIndex=null;this.position=null;this.items=null;this.length=null;this.lock=null;this.$dotSlidesRegion=null;this.clientHeight=null}})}});Widgets.InfiniteScroll=Class.create();Object.extend(Widgets.InfiniteScroll.prototype,Widgets.Base.prototype);Object.extend(Widgets.InfiniteScroll.prototype,{options:{container:"",images:[],showRow:3,ddList:[],loading:"",pages:"pageDiv",type:"images",objType:1},indexNmu:0,descriptionSize:16,types:[6,1,41,31,5,21],subTypes:[[-1,6001,6002,6003],[-1,101,102,103,105],[-1,4101,4102,4103,4104],[-1],[-1],[-1,2104,2101,2103,2102]],subNavTabs:[["全部图片","官方剧照","截图","其它"],["全部图片","正式海报","预告海报","角色海报","其它海报"],["全部图片","官方工作照","定妆照","概念图","片场照"],["全部图片"],["全部图片"],["全部图片","蓝光封套","DVD封套","原声碟封套","录像带封套"]],imageTemplate:'<div class="db_pictypemod"><p><a class="pic_outer" href="#{imgDetailUrl}" target="_blank"><img width="220" alt="#{title}" src="#{img_220}" />#{statusRegion}</a></p><div class="p9 c_94 px12"><p class="c_a5">#{descriptionRegion}</p><div class="clearfix mt6">#{commentRegion}#{width}x#{height}</div></div></div>',imageCommentTemplate:'<span class="fr"><a class="icon_piccom" target="_blank" href="#{imgDetailUrl}"><i></i>#{commentCount}</a></span>',initializeDom:function(){this.ddList=[];this.$container=$(this.container);if(!this.$container){return}this.$loading=$(this.loading);if(this.$loading){this.$loading.hide()}this.$pages=$(this.pages);var c,d=false;if(this.type==="images"){this.imagesLen=this.images.length;for(c=0;c<this.imagesLen;c++){if(this.images[c].length>this.showRow){d=true}}}else{this.ddList=this.$container.immediateDescendants();this.imagesLen=this.ddList.length;for(c=0;c<this.imagesLen;c++){if(this.ddList[c].immediateDescendants().length>this.showRow){d=true}}}if(this.$pages){$hide(this.$pages)}if(!d){if(this.$pages){$show(this.$pages)}return}this.clientHeight=document.documentElement.clientHeight},initializeEvent:function(){this.onScrollDrawSeatHandler=this.onScrollDrawSeat.bind(this);Event.observe(window,"scroll",this.onScrollDrawSeatHandler);Event.observe(window,"unload",this.close.bind(this))},load:function(){if(this.type==="images"){for(var d=0;d<this.imagesLen;d++){var c=document.createElement("dd");this.ddList.push(c);this.$container.appendChild(c)}this.itemsLen=this.imagesLen;this.builderHtml()}else{this.items=[];for(var d=0;d<this.imagesLen;d++){if(this.ddList[d]){this.items.push(this.ddList[d].immediateDescendants())}}this.itemsLen=this.items.length;this.showItem()}},onScrollDrawSeat:function(g){if(this.indexNmu<this.itemsLen){var f=document.documentElement.scrollTop||document.body.scrollTop,e=document.body.offsetHeight;var h=f+this.clientHeight;if(f+this.clientHeight>=e-500){if(this.type==="images"){this.builderHtml()}else{this.showItem()}}f=e=h=null}},showItem:function(){if(this.itemsLen>0){for(i=0;i<this.itemsLen;i++){this.show(this.items[i])}}},show:function(g){var h=g.length,f;if(h===0){this.indexNmu++;if(this.indexNmu>=this.itemsLen){if(this.$loading){this.$loading.hide()}if(this.$pages){$show(this.$pages)}}return}for(var e=0;e<h&&e<this.showRow;e++){f=g.shift();$show(f)}},builderHtml:function(){var e=false,f;for(var d=0;d<this.imagesLen;d++){f=this.images[d].length;if(f>this.showRow){e=true}this.renderImage(this.ddList[d],this.images[d])}if(!e&&this.$pages){$show(this.$pages)}},renderImage:function(n,r){var q,u=new Template(this.imageTemplate),m=new Template(this.imageCommentTemplate),s=r.length,p,t;if(s===0){this.indexNmu++;if(this.indexNmu>=this.itemsLen){if(this.$loading){this.$loading.hide()}if(this.$pages){this.$pages.show()}}return}for(var o=0;o<s&&o<this.showRow;o++){p=r.shift();if(this.objType===1){p.descriptionRegion=this.getDescription(p)}else{if(this.objType===2){p.descriptionRegion=p.description}}p.commentRegion=p.commentCount>0?m.evaluate(p):"";p.statusRegion=p.status==4?"<span>待审核</span>":"";q=u.evaluate(p);var l=new StringBuilder();l.append(q);t=Builder.build(l.toString());n.appendChild(t)}},getDescription:function(j){var g="";switch(j.type){case 1:case 5:case 21:var k=this.types.indexOf(j.type);var l=this.subTypes[k].indexOf(j.subType);if(l>0){g=this.subNavTabs[k][l]}else{if(j.type===5){g="桌面"}}var m=j.title.indexOf("(");var h=j.title.indexOf(")");if(m>0&&h>m){g+=" "+j.title.substr(m+1,h-m-1);g=g.Trim()}break;default:g=j.description;break}g=g.bytelength()>this.descriptionSize*2?g.substr(0,this.descriptionSize-1)+"..":g;return g},destroyEvent:function(){Event.stopObserving(window,"scroll",this.onScrollDrawSeatHandler);Event.stopObserving(window,"unload",this.close.bind(this))},destroyDOM:function(){this.$container=null;this.imagesLen=null;this.images=null;this.ddList=[];this.itemsLen=null;this.scrollHeight=null;this.scrollGap=null;this.types=null;this.subTypes=null;this.subNavTabs=null;this.imageTemplate=null;this.imageCommentTemplate=null;this.onScrollDrawSeatHandler=null}});if(typeof(Widgets)=="undefined"){var Widgets=Class.create()}Widgets.Loading=function(){var h='<div class="db_picloading" style="height:{0}px; width:100%; z-index:105;"><div class="load104"><i class="logo"></i><i class="loadimg"></i></div></div>',e=document.documentElement.clientHeight,g=Builder.build(String.format(h,[e]));document.body.scrollIntoView();document.documentElement.style.overflow="hidden";document.body.appendChild(g);function f(){document.documentElement.style.overflow="";document.body.removeChild(g);h=null;e=null;g=null}return{close:f}};Widgets.LoopSlidesControl=Class.create();Object.extend(Widgets.LoopSlidesControl.prototype,Widgets.SlidesControl.prototype);Object.extend(Widgets.LoopSlidesControl.prototype,{instantiation:function(){var d=this;if(this.length<=this.showLength){this.$prev.hide();this.$next.hide();return}else{this.$prev.show();this.$next.show()}this.moveWidth=this.itemWidth*this.showLength;this.min=this.showLength-1;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:d.scale,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false;this.isLoop=false;this.timeOutMethod()},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler);this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler);Event.observe(this.prev,"mouseover",this.slidesRegionOverHendler);Event.observe(this.prev,"mouseout",this.slidesRegionOutHendler);Event.observe(this.next,"mouseover",this.slidesRegionOverHendler);Event.observe(this.next,"mouseout",this.slidesRegionOutHendler)},prevSlides:function(){if(this.lock){return}var t=null;var a=[],s,u,v,w,y=[],r,b,q=0,p;var x=d.min-d.showLength;for(p=0;p<d.showLength;p++){x--;if(x<0){x=d.length-1}y[p]=x}d.min=x+d.showLength;for(p=0;p<d.showLength;p++){r=d.imgItems[y[p]];b=d.renderImage(r);w=Builder.build(b);a.push(w);d.selectedItems=this.slidesRegion.immediateDescendants();firstItem=d.selectedItems[0];this.slidesRegion.insertBefore(w,firstItem)}d.scale=d.moveWidth;this.slidesRegion.style.left=this.position-d.scale+"px";if(Mtime.browser.ie===0||Mtime.browser.ie>9){FunctionExt.defer(function(){this.lock=true;this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left="0px"},10,this);FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(p=d.showLength-1;p<d.showLength*2;p++){d.selectedItems[p]&&this.slidesRegion.removeChild(d.selectedItems[p])}this.lock=false},d.durations.duration,this);return}t={node:this.slidesRegion,duration:this.duration,scale:d.scale,position:this.position-d.scale,callback:function(){for(p=d.showLength-1;p<d.showLength*2;p++){d.selectedItems[p]&&this.slidesRegion.removeChild(d.selectedItems[p])}this.slidesRegion.style.left=this.position;d.selectedItems=a}.bind(this)};this.move(t)},nextSlides:function(){if(this.lock){return}var l=null,b,o=[];var n=d.min;for(b=0;b<d.showLength;b++){n++;if(n>=d.length){n=0}o[b]=n}d.min=n;for(b=0;b<d.showLength;b++){var k=d.imgItems[o[b]];var a=d.renderImage(k);var m=Builder.build(a);this.slidesRegion.appendChild(m)}d.selectedItems=this.slidesRegion.immediateDescendants();if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.lock=true;this.slidesRegion.addClassName(d.durations.className);this.slidesRegion.style.left=-d.scale+"px";FunctionExt.defer(function(){this.slidesRegion.removeClassName(d.durations.className);for(b=0;b<d.showLength;b++){d.selectedItems[b]&&this.slidesRegion.removeChild(d.selectedItems[b])}this.slidesRegion.style.left=this.position;this.lock=false;this.timeOutMethod()},d.durations.duration,this);return}l={node:this.slidesRegion,duration:this.duration,scale:-d.scale,position:this.position,callback:function(){for(b=0;b<d.showLength;b++){d.selectedItems[b]&&this.slidesRegion.removeChild(d.selectedItems[b])}this.slidesRegion.style.left=this.position}.bind(this)};this.move(l)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;this.timeOutMethod();a.callback&&a.callback()}.bind(this)})},timeOutMethod:function(){this.myTimeout&&clearInterval(this.myTimeout);if(this.autoTimeout&&!this.isLoop){this.myTimeout=setInterval(function(){this.nextSlides();this.myTimeout&&clearInterval(this.myTimeout)}.bind(this),this.autoTimeout*1000)}},slidesRegionOver:function(a){this.myTimeout&&clearInterval(this.myTimeout);this.isLoop=true},slidesRegionOut:function(a){this.isLoop=false;this.timeOutMethod()}})}});Widgets.TopPicSlide=Class.create();Object.extend(Widgets.TopPicSlide.prototype,Widgets.Base.prototype);Object.extend(Widgets.TopPicSlide.prototype,{options:{container:"",prev:"",next:"",slidesRegion:"",tabName:"",autoTimeout:7000},iNow:0,initializeDom:function(){this.$container=$(this.container);if(!this.$container){return}if(this.prev){this.$prev=$(this.prev)}if(this.next){this.$next=$(this.next)}if(this.slidesRegion){this.$slidesRegion=$(this.slidesRegion);this.slidesImgs=this.$slidesRegion.getElementsByTagName("dd");for(var b=0;b<this.slidesImgs.length;b++){this.slidesImgs[b].style.opacity=0;this.slidesImgs[b].style.filter="alpha(opacity=0)"}this.slidesImgs[0].style.opacity=1;this.slidesImgs[0].style.filter="alpha(opacity=100)";this.slidesImgs[0].style.zIndex=1}if(this.tabName){this.$tabName=$(this.tabName);this.btns=this.$tabName.getElementsByTagName("li")}this.autoSlide()},initializeEvent:function(){this.onConMouseOverHandler=this.onConMouseOver.bind(this);this.onConMouseOutHandler=this.onConMouseOut.bind(this);Event.observe(this.$container,"mouseover",this.onConMouseOverHandler);Event.observe(this.$container,"mouseout",this.onConMouseOutHandler);this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.$prev,"click",this.onPrevClickHandler);Event.observe(this.$next,"click",this.onNextClickHandler);this.onBtnClickHandler=this.onBtnClick.bind(this);for(var b=0;b<this.btns.length;b++){this.btns[b].index=b;Event.observe(this.btns[b],"click",this.onBtnClickHandler)}Event.observe(window,"unload",this.close.bind(this))},autoSlide:function(){if(this.autoTimeout){this.autoFadeTimerHandler=this.autoFade.bind(this);this.timer=setInterval(this.autoFadeTimerHandler,this.autoTimeout)}},onConMouseOver:function(){clearInterval(this.timer)},onConMouseOut:function(){if(this.autoTimeout){this.autoFadeTimerHandler=this.autoFade.bind(this);this.timer=setInterval(this.autoFadeTimerHandler,this.autoTimeout)}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.autoFadePrev()},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);this.autoFade()},onBtnClick:function(f){var e=Event.element(f);var h=f.target||f.srcElement;Event.stop(f);if(e.hasClassName("on")){return false}else{for(var g=0;g<this.btns.length;g++){this.btns[g].removeClassName("on")}e.addClassName("on");for(var g=0;g<this.slidesImgs.length;g++){this.fadeOut(this.slidesImgs[g])}this.fadeIn(this.slidesImgs[e.index]);this.iNow=e.index}},autoFade:function(){if(this.iNow===this.slidesImgs.length-1){this.iNow=0}else{this.iNow++}for(var c=0;c<this.slidesImgs.length;c++){this.fadeOut(this.slidesImgs[c])}this.fadeIn(this.slidesImgs[this.iNow]);for(var d=0;d<this.btns.length;d++){this.btns[d].removeClassName("on")}this.btns[this.iNow].addClassName("on")},autoFadePrev:function(){if(this.iNow===0){this.iNow=this.slidesImgs.length-1}else{this.iNow--}for(var c=0;c<this.slidesImgs.length;c++){this.fadeOut(this.slidesImgs[c])}this.fadeIn(this.slidesImgs[this.iNow]);for(var d=0;d<this.btns.length;d++){this.btns[d].removeClassName("on")}this.btns[this.iNow].addClassName("on")},fadeIn:function(e){var f=0;if(Mtime.browser.ie){var d=this.getStyle(e,"filter")}else{var d=this.getStyle(e,"opacity")}if(d==="1"||d==="alpha(opacity=100)"){return false}clearInterval(e.timer);e.timer=setInterval(function(){var a=5;if(f===100){clearInterval(e.timer)}else{f+=a;e.style.opacity=f/100;e.style.filter="alpha(opacity="+f+")";e.style.zIndex=1}}.bind(this),30)},fadeOut:function(e){var f=100;if(Mtime.browser.ie){var d=this.getStyle(e,"filter")}else{var d=this.getStyle(e,"opacity")}if(d==="0"||d==="alpha(opacity=0)"){return false}clearInterval(e.timer);e.timer=setInterval(function(){var a=-5;if(f===0){clearInterval(e.timer)}else{f+=a;e.style.opacity=f/100;e.style.filter="alpha(opacity="+f+")";e.style.zIndex=""}}.bind(this),30)},getStyle:function(d,c){if(d.currentStyle){return d.currentStyle[c]}else{return getComputedStyle(d,false)[c]}},destroyEvent:function(){this.onConMouseOverHandler&&Event.stopObserving(this.$container,"mouseover",this.onConMouseOverHandler);this.onConMouseOutHandler&&Event.stopObserving(this.$container,"mouseout",this.onConMouseOutHandler);this.onPrevClickHandler&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.$next,"click",this.onNextClickHandler);if(this.onBtnClickHandler){for(var b=0;b<this.btns.length;b++){Event.stopObserving(this.btns[b],"click",this.onBtnClickHandler)}}},destroyDom:function(){this.$container=null;this.$prev=null;this.$next=null;this.$slidesRegion=null;this.slidesImgs=null;this.$tabName=null;this.btns=null}});Widgets.VideoListTopVideoControl=Class.create();Object.extend(Widgets.VideoListTopVideoControl.prototype,Widgets.Base.prototype);Object.extend(Widgets.VideoListTopVideoControl.prototype,{server:{getVideoInfo:function(d,c){return Mtime.Component.Ajax.request(siteApiUrl,"Mtime.Api.Pages.VideoService","GetVideoInfo",[d],c,"/Service/Video.api?Ajax_CallBack=true","get","10000")}},options:{container:"db_videobox",topVideoContainer:"db_videoinner",playBtn:"playbtn",videoTitle:"videotitle",topVideoList:"topvideolist",playerContainer:"playercontainer",isNewsVideo:false,playerWidth:1000,playerHeight:563,mp4Template:'<video width="1000" height="563" x-webkit-airplay="allow" controls="true" preload="none" src="#{mp4URL}"></video>',webTemplate:'<object width="#{width}" height="#{height}" autoactive="true" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="videoplayer" name="flashfirebug0"><param value="#{swfPath}?vid=#{vid}&mid=#{mid}&autoplay=1&w=#{width}&h=#{height}#{debug}" name="movie"><param value="high" name="quality"><param value="true" name="allowFullScreen"><param value="false" name="menu"><param value="transparent" name="wmode"><param value="always" name="allowScriptAccess"><embed width="#{width}" height="#{height}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="#{swfPath}?vid=#{vid}&mid=#{mid}&autoplay=1&w=#{width}&h=#{height}#{debug}" play="true" allowfullscreen="true" allowscriptaccess="always" wmode="transparent" id="flashfirebug0" name="flashfirebug0"></object>'},initializeDom:function(){this.$container=$(this.container);this.$topVideoContainer=$(this.topVideoContainer);this.$playBtn=$(this.playBtn);this.$videoTitle=$(this.videoTitle);this.$topVideoList=$(this.topVideoList);this.topVideoLists=this.$topVideoList.immediateDescendants();this.topVideoLists[0].addClassName("on");this.$playerContainer=$(this.playerContainer);this.indexNum=0;this.isBrowser=this.browserRedirect();if(!this.isBrowser){window.videoPlayStop=this.videoPlayStop.bind(this);window.videoPlayPlay=this.videoPlayPlay.bind(this)}this.opacity=1;this.$topVideoContainer.addClassName("transition6")},initializeEvent:function(){this.playBtnClickHandler=this.playBtnClick.bind(this);Event.observe(this.$playBtn,"click",this.playBtnClickHandler);Event.observe(this.$videoTitle,"click",this.playBtnClickHandler);this.topVideoListClickHandler=this.topVideoListClick.bind(this);this.topVideoListMouseoverHandler=this.topVideoListMouseover.bind(this);this.topVideoListMouseoutHandler=this.topVideoListMouseout.bind(this);Event.observe(this.$topVideoList,"click",this.topVideoListClickHandler);Event.observe(this.$topVideoList,"mouseover",this.topVideoListMouseoverHandler);Event.observe(this.$topVideoList,"mouseout",this.topVideoListMouseoutHandler);Event.observe(window,"unload",this.close.bind(this))},playBtnClick:function(b){Event.stop(b);this.currTrailer=this.topVideoLists[0];this.play();this.render()},play:function(){this.$topVideoContainer.style.opacity=0;this.playMethod()},playMethod:function(){var b=this.currTrailer.readAttribute("vid");this.mid=this.currTrailer.readAttribute("mid");if(b){b=parseInt(b,10);this.videoBuilder(b)}},videoBuilder:function(k){if(k!=""&&k!="0"){if(this.isBrowser){this.getmp4URL(k)}else{var g="http://static1.mtime.cn/static",f;this.playerTemplate='<a id="closebtn" href="#" title="关闭" class="close transition4"></a>'+this.webTemplate;var j=new Template(this.playerTemplate);var h=j.evaluate({vid:k,mid:this.mid,bodyheight:document.body.offsetHeight,width:this.playerWidth,height:this.playerHeight,swfPath:g+"/flash/newvideoplayer.swf",debug:debug?"&debug=true":""});this.videoBuilderMethod(h)}}},getmp4URL:function(b){if(b){this.server.getVideoInfo(b,function(e){if(e&&e.value&&e.value.mp4URL){this.playerTemplate='<a id="closebtn" href="#" title="关闭" class="close transition4"></a>'+this.mp4Template;var f=new Template(this.playerTemplate);var a=f.evaluate({bodyheight:document.body.offsetHeight,mp4URL:e.value.mp4URL,debug:debug?"&debug=true":""});this.videoBuilderMethod(a)}}.bind(this))}},videoBuilderMethod:function(b){this.$playerContainer.innerHTML=b;this.$playerContainer.style.display="block";this.$closeBtn=$("closebtn");this.$videoplayer=$("videoplayer");Event.observe(this.$closeBtn,"click",this.closeBtnClick.bind(this))},videoplayerOver:function(d){var c=Event.element(d);this.videoObject=c.up(".db_videoobject");if(this.$playerContainer===c.up(".db_videoobject")){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.show()}else{this.$closeBtn.style.opacity=1}}},videoplayerOut:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}this.playerContainerTimeout=FunctionExt.defer(function(){if(this.$playerContainer===this.videoObject){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}}},200,this)},closeBtnOver:function(b){if(this.playerContainerTimeout!==null){clearTimeout(this.playerContainerTimeout)}},closeBtnClick:function(b){b&&Event.stop(b);this.closeMethod()},closeMethod:function(){this.$topVideoContainer.style.opacity=1;this.$playerContainer.hide();this.$playerContainer.innerHTML="";Event.stopObserving(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.stopObserving(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.stopObserving(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this));Event.stopObserving(this.$closeBtn,"click",this.closeBtnClick.bind(this));this.$closeBtn=null;this.$videoplayer=null},playNext:function(){this.currTrailer=this.currTrailer.next();if(!this.currTrailer){if(this.isNewsVideo){this.closeMethod();return}this.currTrailer=this.$topVideoList.down("dd")}this.playMethod()},render:function(){},videoPlayStop:function(){},videoPlayPlay:function(){FunctionExt.defer(function(){if(Mtime.browser.ie&&Mtime.browser.ie<9){this.$closeBtn.hide()}else{this.$closeBtn.style.opacity=0}},3000,this);Event.observe(this.$videoplayer,"mouseover",this.videoplayerOver.bind(this));Event.observe(this.$videoplayer,"mouseout",this.videoplayerOut.bind(this));Event.observe(this.$closeBtn,"mouseover",this.closeBtnOver.bind(this))},topVideoListClick:function(b){this.currTrailer=Event.findElement(b,"dd");if(this.currTrailer!==document&&this.currTrailer.readAttribute("vid")){this.play();this.render()}},topVideoListMouseover:function(e){var d=Event.findElement(e,"dd");var f=this.topVideoLists.indexOf(d);if(f>0&&d!==document&&d.readAttribute("vid")){this.topVideoLists[0].removeClassName("on");d.addClassName("on")}},topVideoListMouseout:function(e){var d=Event.findElement(e,"dd");var f=this.topVideoLists.indexOf(d);if(f>0&&d!==document&&d.readAttribute("vid")){this.topVideoLists[0].addClassName("on");d.removeClassName("on")}},setOpacity:function(d){var c=navigator.userAgent.toLowerCase();if(this.opacity<0){this.opacity=0}if(this.opacity>1){this.opacity=1}if(Mtime.browser.ie&&Mtime.browser.ie<9){d.style.filter="alpha(opacity="+(this.opacity*100)+")"}else{d.style.opacity=this.opacity}},browserRedirect:function(){var m=navigator.userAgent.toLowerCase();var h=m.match(/ipad/i)=="ipad";var j=m.match(/iphone/i)=="iphone";var k=m.match(/iphone/i)=="ipod";var g=m.match(/android/i)=="android";var l=m.match(/windows mobile/i)=="windows mobile";if(h||j||k||g||l){return true}return false},destroyEvent:function(){},destroyDOM:function(){this.$container=null;this.$topVideoContainer=null;this.$playBtn=null;this.$videoxTitle=null;this.$topVideoList=null;this.topVideoLists=null;this.$playerContainer=null;if(this.$closeBtn){this.$closeBtn=null}}});var MtimeShareRelatedObjectTypes={Movie:1,Person:2,UserPhoto:5,Blog:6,Group:9,ForumTopic:10,MoviePicture:11,PersonPicture:21,Activity:22,Cinema:33,Video:41,List:50,CMSNews:51,CMSGalleryImage:52,Twitter:54,CMSSpecialTopic:59,GameVote:63,Link:64,GameQuiz:67,Festival:82,FestivalEvent:83,CommunityFeature:84,TopList:90,DETSeatOrder:85,MediaReview:336,SCMGoodsComment:9911};var ShareRelatedObjectTypes={MovieIsReleased:1001,MovieUpcoming:1002,MovieHasAwards:1003,MovieGeneral:1004,MovieContentPlot:1005,MovieRoleDescInfo:1006,MovieRoleDescAll:1007,MovieBehindCurtain:1008,MovieVerseLines:1009,MovieBehindTemplate:1010,MovieTelecinePage:1011,PersonFavorableComment:2001,News:5101,ImageNews:5102,MovieLongComment:9991,MovieShortComment:9992,MovieLeaveComment:9993,VideoMovie:4101,VideoPerson:4102,PictureMovie:11,PicturePerson:21,Cinema:33,IndexNewsTop:9981,Movie:1111,Blog:6001,ForumTopic:7001,Activity:2201,MediaReview:3361,Link:6401,OffsiteLink:64011,GoodsDetail:99991,NewsComment:51011,VideoMovieComment:41011,VideoPersonComment:41021,SCMGoodsDetail:99992,TopList:9000};var ShareControlStyleType={FloatStyle:1,ListStyle:2,OnlyShare:3,OnlyShareSCM:4};var ShareTabType={shareToMtimeFriend:{name:"shareToMtimeFriend",text:"时光好友"},shareToEMail:{name:"shareToEMail",text:"邮件地址"},shareToWeb:{name:"shareToWeb",text:"其他网站"},showQrCode:{name:"showQrCode",text:"二维码"}};var GlobalUrlValue="";var ShareControlDialogBase=Class.create();Object.extend(ShareControlDialogBase.prototype,{name:"ShareControlDialogBase",title:"分享到我的时光",closed:false,dialog:null,tabContentRegion:null,options:{shareControl:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.tabContentRegion},destroyDOM:function(){this.shareControl=this.dialog=this.tabHeaderRegion=this.tabContentRegion=null},initializeControl:function(){this.dialog=new Dialog({title:this.title,content:this.tabContentRegion,windowClassName:"w600",closeCallback:this.close.bind(this)})},destroyControl:function(){},initializeEvent:function(){},destroyEvent:function(){},load:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareToMtimeFriendDialog=Class.create();Object.extend(ShareToMtimeFriendDialog.prototype,ShareControlDialogBase.prototype);Object.extend(ShareToMtimeFriendDialog.prototype,{defaultPrompt:"还可以输入210个字",reasonDefaultTxt:"分享理由",reasonMaxLength:210,dialogTemplate:new Template('<div class="sharemid"><span class="load48" style="display:none;" _type="loading"></span><div class="editshare"><span _type="digit_feedback">#{defaultPrompt}</span> <textarea _type="txtreason" class="curr">#{defaultText}</textarea></div><div class="#{middleShareClassName} clearfix" _type="addition_region">#{middleShareHtml}</div></div>'),closed:false,selectFirstImage:false,content:null,txtReason:null,shareButton:null,onClickShareButtonHandler:null,getShareInfoAdditionalInfo:function(f,e,d){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfoAdditionalInfo",[f,e],d,"/community.api?Ajax_CallBack=true","get","20000")}},getShortenUrl:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","ShortenUrl",[d],c,"/Service/Twitter.msi","get","20000")},loadEditorJs:function(b){if(typeof(Weibo)!="undefined"&&Weibo.Face&&Weibo.Image&&Weibo.Sync&&Weibo.Syntax&&Weibo.Topic&&Weibo.Video){b&&b()}else{if(self.debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js"],function(){b&&b()})}else{$loadJs("/js/2011/weiboEditor.js",function(){b&&b()})}}},load:function(){},initializeDOM:function(){ShareControlDialogBase.prototype.initializeDOM.apply(this);var b=this.shareControl.shareInfo;this.textAreaContent=this.reasonDefaultTxt;if(this.shareControl.shareMtimeContent){this.textAreaContent=this.shareControl.shareMtimeContent()}this.content=Builder.build(this.dialogTemplate.evaluate({defaultPrompt:this.defaultPrompt,defaultText:this.textAreaContent,middleShareClassName:this.shareControl.middleShareClassName,middleShareHtml:this.shareControl.getMiddleShareHtml()}));this.shareButton=$(Builder.node("a",{className:"sharelink"},["分 享"]));this.tabContentRegion=this.content},initializeControl:function(){ShareControlDialogBase.prototype.initializeControl.apply(this);if(this.dialog.buttonRegion){this.dialog.buttonRegion.appendChild(this.shareButton);this.dialog.buttonRegion.addClassName("btnshare")}this.txtReason=this.content.down('[_type="txtreason"]');this.editorTextbox=new Textbox({text:this.txtReason,watermarkText:"",focusClassName:"",blurClassName:""});this.editorTextbox.text.value=this.textAreaContent;var f=this;if(this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.CMSNews||this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.Cinema||this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.SCMGoodsComment){if(this.shareControl.getShareObjectPicUrl){this.shareImageUrl=this.shareControl.getShareObjectPicUrl()}}this.loadEditorJs(function(){f.editor=new Weibo.Editor({editor:f.txtReason});new Weibo.Feedback({editor:f.editor,digitFeedback:{target:f.content.down('[_type="digit_feedback"]'),normalTemplate:"还可以输入{2}个字",warnTemplate:'<font color="red">字数超出{3}字</font>'}})});var e=this.shareControl.shareInfo;var d=this.content.down('[_type="loading"]');if(e.needAdditionalInfo){d.show();this.getShareInfoAdditionalInfo(this.shareControl.relatedObjType,this.shareControl.getShareObjectId(),function(y){if(y&&y.value&&(y.value.picUrls||y.value.videoUrls||y.value.extPicUrls)){var v="",s="",C="";var u=['<ul class="infotab clearfix" _type="nav">'];var a=y.value;if((a.picUrls&&a.picUrls.length>0)||(y.value.extPicUrls&&y.value.extPicUrls.length>0)){if(a.extPicUrls&&a.extPicUrls.length>0){if(a.picUrls){a.picUrls=a.extPicUrls.concat(a.picUrls)}else{a.picUrls=y.value.extPicUrls}}u.push('<li _type="image" class="curr"><i class="i_share_pic">&nbsp;</i>选择一张图片<i class="i_share_select">&nbsp;</i></li>');var c=['<div class="infoslist" _type="images"><div class="infoscroll">'];if(a.picUrls.length>5){c.push('<a href="#" onclick="return false;" _type="turnleft" class="i_share_prev">&nbsp;</a><a href="#" class="i_share_next" _type="turnright" onclick="return false;">&nbsp;</a>')}c.push('<div _type="slidesregion" class="scrollmid">');a.picUrls.each(function(h,g){if(g%5==0){if(g/5!=0){c.push("</ul>");c.push('<ul style="display:none;">')}else{c.push("<ul>")}}c.push('<li _imageurl="'+h+'" name="tab"><img src="'+h+'" width="90" /></li>')});c.push("</ul></div></div></div>");s=c.join("")}if(a.videoUrls&&a.videoUrls.length>0){var B=[];if(u.length==1){u.push('<li _type="video" class="curr"><i class="i_share_play">&nbsp;</i>选择一个视频<i class="i_share_select">&nbsp;</i></li>');B=['<div class="infoslist" _type="videos"><div class="infoscroll">']}else{u.push('<li _type="video"><i class="i_share_play">&nbsp;</i>选择一个视频</li>');B=['<div class="infoslist" _type="videos" style="display:none"><div class="infoscroll">']}if(a.videoUrls.length>5){B.push('<a href="#" onclick="return false;" _type="turnleft" class="i_share_prev">&nbsp;</a><a href="#" class="i_share_next" _type="turnright" onclick="return false;">&nbsp;</a>')}B.push('<div _type="slidesregion" class="scrollmid">');a.videoCoverUrls.each(function(h,g){if(g%5==0){if(g/5!=0){B.push("</ul>");B.push('<ul style="display:none;">')}else{B.push("<ul>")}}B.push('<li _videourl="'+a.videoUrls[g].url+'" title="'+a.videoUrls[g].title+'" name="tab"><img src="'+h+'" width="90"></li>')});B.push("</ul></div></div></div>");C=B.join("")}u.push("</ul>");v=u.join("");var b=f.content.down('[_type="addition_region"]');v&&b.appendChild(Builder.build(v));s&&b.appendChild(Builder.build(s));C&&b.appendChild(Builder.build(C));f.navRegion=f.content.down('[_type="nav"]');if(f.navRegion.childElements().length<2){f.navRegion=null}f.imagesRegion=f.content.down('[_type="images"]');f.videosRegion=f.content.down('[_type="videos"]');if(f.selectFirstImage&&f.imagesRegion){var t=f.imagesRegion.down("li[_imageurl]");imgUrl=t.readAttribute("_imageurl");f.shareImageUrl=imgUrl;t.addClassName("curr");var z='<i class="i_sharecurr"></i>';t.appendChild(Builder.build(z))}if(f.navRegion){f.navControlHandler=f.navControl.bind(f);Event.observe(f.navRegion,"click",f.navControlHandler)}if(f.imagesRegion||f.videosRegion){f.selectImageOrVideoHandler=f.selectImageOrVideo.bind(f);f.imagesRegion&&Event.observe(f.imagesRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&Event.observe(f.videosRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&(f.videoCheckTimeout=setTimeout(f.videoCheck.bind(f),500));if(a.picUrls&&a.picUrls.length>5){var x=f.imagesRegion.down('[_type="turnleft"]');var w=f.imagesRegion.down('[_type="turnright"]');var A=f.imagesRegion.down('[_type="slidesregion"]');f.buildSlidesControl(A,w,x)}if(a.videoUrls&&a.videoUrls.length>5){var x=f.videosRegion.down('[_type="turnleft"]');var w=f.videosRegion.down('[_type="turnright"]');var A=f.videosRegion.down('[_type="slidesregion"]');f.buildSlidesControl(A,w,x)}}}d.hide()})}},buildSlidesControl:function(m,k,l){var g=m.childElements();if(g.length>1){var h=0;var j=g.length;Event.observe(k,"click",function(){$(g[h]).hide();if(h!=j-1){++h}else{h=0}$(g[h]).show()});Event.observe(l,"click",function(){$(g[h]).hide();if(h!=0){h=0}else{h=j-1}$(g[h]).show()})}},destroyDOM:function(){this.editor.destroy();ShareControlDialogBase.prototype.destroyDOM.apply(this);this.content=null;this.txtReason=null;this.shareButton=null;if(this.textAreaContent){this.textAreaContent=null}},initializeEvent:function(){ShareControlDialogBase.prototype.initializeEvent.apply(this);this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);Event.observe(this.shareButton,"click",this.onClickShareButtonHandler)},destroyEvent:function(){this.navRegion&&Event.stopObserving(this.navRegion,"click",this.navControlHandler);this.imagesRegion&&Event.stopObserving(this.imagesRegion,"click",this.selectImageOrVideoHandler);this.videosRegion&&Event.stopObserving(this.videosRegion,"click",this.selectImageOrVideoHandler);this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);Event.stopObserving(this.shareButton,"click",this.onClickShareButtonHandler);ShareControlDialogBase.prototype.destroyEvent.apply(this)},navControl:function(m){var l=Event.findElement(m,"li");if(l!=document&&!l.hasClassName("curr")){var n=l.up();var o=l.getAttribute("_type");var h=n.down(".curr");var k=h.getAttribute("_type");var j=h.down(".i_share_select");j&&j.remove();h.removeClassName("curr");l.addClassName("curr");l.appendChild(Builder.build('<i class="i_share_select"></i>'));this.content.down('[_type="'+k+'s"]').hide();this.content.down('[_type="'+o+'s"]').show()}},videoCheck:function(){this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);this.videoCheckTimeout=null;var d=this.editorTextbox.getValue();if(this.shareVideoUrl&&d.indexOf(this.shareVideoUrl)==-1){var c=this.videosRegion.down('li[shortenurl="'+this.shareVideoUrl+'"]');if(c){c.removeClassName("curr");this.shareVideoUrl=null}}this.videoCheckTimeout=setTimeout(this.videoCheck.bind(this),500)},selectImageOrVideo:function(n){var m=Event.findElement(n,"li");if(m!=document&&(m.hasAttribute("_imageurl")||m.hasAttribute("_videourl"))){if(m.hasClassName("curr")){if(m.hasAttribute("_imageurl")){this.shareImageUrl=null}else{var t=this.shareVideoUrl;if(t){var u=this.editorTextbox.getValue().replace(new RegExp(t,"ig"),"");this.editor.editor.value="";this.editor.insertText(u)}this.shareVideoUrl=null}var q=m.down(".i_sharecurr");q&&q.remove();m.removeClassName("curr")}else{if(m.hasAttribute("_imageurl")){this.shareImageUrl=m.getAttribute("_imageurl");var o=m.up('[_type="images"]').down(".curr");var p=o&&o.down(".i_sharecurr");o&&o.removeClassName("curr");p&&p.remove();m.addClassName("curr");m.appendChild(Builder.build('<i class="i_sharecurr"></i>'))}else{var t=this.shareVideoUrl;var u=this.editorTextbox.getValue().replace(new RegExp(t,"ig"),"");this.editor.editor.value="";this.editor.insertText(u);t=m.getAttribute("_videourl");var r=m.getAttribute("shortenurl");var s=this;var l=function(){s.editor.insertText(s.shareVideoUrl+" ");var a=m.up('[_type="videos"]').down(".curr");var b=a&&a.down(".i_sharecurr");a&&a.removeClassName("curr");b&&b.remove();m.addClassName("curr");m.appendChild(Builder.build('<i class="i_sharecurr"></i>'))};if(r){this.shareVideoUrl=r;l()}else{this.getShortenUrl(t,function(a){if(a&&a.value&&a.value.errorCode!=1){r=a.value.shortenUrl;m.setAttribute("shortenurl",r);s.shareVideoUrl=r;l()}})}}}}},saveShareCallback:function(c){if(c){var d=c.value;switch(d){case -2:$alert("您在时光网发布的内容违反互联网管理规定，对此帐户予禁言处理。",null,null,1);this.dialog.close();break;case -1:$alert("转发理由含有敏感词，请修改后再试",null,null,1);this.dialog.close();break;case 0:$alert("转发失败，请稍后再试",null,null,1);this.dialog.close();break;case 1:case 2:$alert("转发成功",null,null,1);if(this.shareControl.shareSuccessCallBack){this.shareControl.shareSuccessCallBack()}this.dialog.close();break;default:this.dialog.close();break}}},saveTweetShareCallback:function(d){var c=null;switch(d.value){case -5:c="原作者微评正在审核中，如有不便敬请谅解!";break;case -9:case -4:case -3:case -2:case 0:c="转发微评失败";break;case -1:c="转发微评失败,内容过长";break;case -11:c="转发微评失败,您被禁言";break;case -10:c="转发微评失败,内容包含敏感词";break;case -20:c="你发布的速度太快了，休息一下吧：）";break}if(c){$alert(c,null,null,1)}else{$alert("转发成功",null,null,1);if(this.shareControl.shareSuccessCallBack){this.shareControl.shareSuccessCallBack()}}this.dialog.close()},onClickShareButton:function(f){var j=this.txtReason.value.trim();var h=this.editor.getLength();if(h>this.editor.lengthExp.max){return}else{var g=this.shareImageUrl?this.shareImageUrl:"";var k="";this.shareControl.saveShare(j,this.saveShareCallback.bind(this),this.saveTweetShareCallback.bind(this),this.shareButton,g,k)}}});var ShareControlBase=Class.create();Object.extend(ShareControlBase.prototype,{name:"ShareControlBase",EXCERPT_SIZE:50,closed:false,MtimeShareRelatedObjectTypes:$H(MtimeShareRelatedObjectTypes),ShareRelatedObjectTypes:$H(ShareRelatedObjectTypes),avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.showQrCode],relatedObjType:0,shareRelatedObjType:0,isAjaxData:true,shareButton:null,shareInfo:null,shareContainer:null,shareControlStyleType:ShareControlStyleType.FloatStyle,middleShareClassName:"boxshare",server:{saveShareInfo:function(l,k,j,g,h,m){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","SaveShareInfoCrossDomainByFlash",[l,k,j,h,m],g,"/community.api?Ajax_CallBack=true","post","20000")}},ForwardTweet:function(f,e,d){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","ForwardTweetCrossDomainByFlash",f,e,"/Service/Twitter.msi","post","20000",d)},getIsLogin:function(b){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetIsLogin",[],b,"/community.api?Ajax_CallBack=true","get","20000")}},getShareInfo:function(l,k,j,h,g,m){if(siteCommunityServiceUrl){if(h===""){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfo",[l,k,j],g,"/community.api?Ajax_CallBack=true","get","20000",m)}else{return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfoExpand",[l,k,j,h],g,"/community.api?Ajax_CallBack=true","get","20000",m)}}}},ButtonInfoMap:$H({toWeixin:{name:"toWeixin",shareClassName:"weixin",text:"微信",type:ShareTabType.showQrCode,urlFormat:"javascript:ShowQrCode('');"},toSinaMicroblogging:{name:"toSinaMicroblogging",shareClassName:"sinaweibo",text:"新浪微博",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://service.t.sina.com.cn/share/share.php?appkey=166678827&pic={2}&ralateUid=1663735900&url={0}&title={1}');"},toQQ:{name:"toQQ",shareClassName:"qq",text:"QQ",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://connect.qq.com/widget/shareqq/index.html?url={0}&desc=&title={1}&summary=&pics={2}&flash=&site=http://www.mtime.com');"},toQzone:{name:"toQzone",shareClassName:"qzone",text:"QQ空间",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={0}&desc={1}');"},toEMail:{name:"toEMail",shareClassName:"email",text:"电子邮件",type:ShareTabType.shareToEMail,urlFormat:"mailto:?subject={3}&body={4}"},toMtime:{name:"toMtime",shareClassName:"mytime",text:"我的时光",type:ShareTabType.shareToMtimeFriend}}),options:{desc:"",expandMovieId:0,shareContainer:null,shareButton:null,autoLoad:true,callback:null,shareSuccessCallBack:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},typeMapping:function(){if(this.isAjaxData){if(this.shareRelatedObjType==0){if(this.relatedObjType==0){throw"shareRelatedObjType not set and relatedObjType not set!"}switch(this.relatedObjType){case MtimeShareRelatedObjectTypes.Movie:this.shareRelatedObjType=ShareRelatedObjectTypes.MovieGeneral;break;case MtimeShareRelatedObjectTypes.Person:this.shareRelatedObjType=ShareRelatedObjectTypes.PersonNotFavorableComment;break;case MtimeShareRelatedObjectTypes.CMSNews:this.shareRelatedObjType=ShareRelatedObjectTypes.NewsGeneral;break;case MtimeShareRelatedObjectTypes.MoviePicture:this.shareRelatedObjType=ShareRelatedObjectTypes.PictureMovie;break;case MtimeShareRelatedObjectTypes.PersonPicture:this.shareRelatedObjType=ShareRelatedObjectTypes.PicturePerson;break;case MtimeShareRelatedObjectTypes.Cinema:this.shareRelatedObjType=ShareRelatedObjectTypes.Cinema;break;default:throw"relatedObjType not Mapping shareRelatedObjType!";break}}}},initialize:function(b){this.setOptions(b);this.initializeField();this.typeMapping();this.initializeDOM();this.initializeEvent();this.load();this.render();this.initializeControl();Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){this.avaliableTabs=$A(this.avaliableTabs);this.collectBoxId=null},initializeDOM:function(){var g=this.ButtonInfoMap.values();var h=[];var k=siteCommunityServiceUrl+"/ShareHandler.ashx?shareRelatedObjType="+this.shareRelatedObjType+"&relatedId="+this.getShareObjectId()+"&expandId="+this.getShareExpandId()+"&expandContext="+decodeURIComponent(this.getShareExpandContext())+"&screenshotImageUrl="+this.getScreenshotImageUrl();if(this.shareButton&&this.shareContainer){this.shareContainer.hide();if(this.shareControlStyleType==ShareControlStyleType.FloatStyle){h.push('<ul class="clearfix">');for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></li>")}else{if(f.name==="toEMail"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></li>")}else{if(f.name==="toWeixin"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:ShowQrCode(\''+this.link+"');\" >"+f.text+"</a></li>")}else{h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></li>")}}}}h.push("</ul>");this.shareContainer.innerHTML=h.join("")}else{if(this.shareControlStyleType==ShareControlStyleType.ListStyle){for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></p>")}else{if(f.name==="toEMail"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}else{if(f.name==="toWeixin"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:ShowQrCode(\''+this.link+"');\" >"+f.text+"</a></p>")}else{h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}}}}this.shareContainer.innerHTML=h.join("")}else{throw"shareControlStyleType does not implemented!"}}}else{if(this.shareButton&&!this.shareContainer){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){this.shareContainer=Builder.node("div",{className:"inner newsharebar"},[Builder.node("div",{className:"smtimebar"},[Builder.node("div",{className:"sharebox"})])]);for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></p>")}else{if(f.name==="toEMail"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}else{if(f.name==="toWeixin"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:ShowQrCode(\''+this.link+"');\" >"+f.text+"</a></p>")}else{h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}}}}this.shareContainer.getElementsBySelector("div.sharebox")[0].innerHTML=h.join("")}}}},destroyDOM:function(){if(this.shareButton){this.shareButton=null}if(this.shareContainer){this.shareContainer=null}if(this.collectBoxId){this.collectBoxId=null}if(this.windowOpen){this.windowOpen=null}},initializeEvent:function(){if(!this.autoLoad){this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);if(this.shareButton){this.shareButton.observe("click",this.onClickShareButtonHandler)}}this.onClickshareContainerHandler=this.onClickshareContainer.bindAsEventListener(this);if(this.shareContainer){this.shareContainer.observe("click",this.onClickshareContainerHandler)}},destroyEvent:function(){if(this.shareButton){this.shareButton.stopObserving("click",this.onClickShareButtonHandler)}if(this.shareContainer){this.shareContainer.stopObserving("click",this.onClickshareContainerHandler)}},initializeControl:function(){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){var d=this;var c=this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM;this.collectBox=new DialogBox({element:this.shareButton,content:this.shareContainer.outerHTML,arrowNew:true,onClick:function(b){var g=Event.pointerX(b);var h=Event.pointerY(b);var a=Event.element(b);if(a!=this.element&&!a.descendantOf(this.element)&&!a.descendantOf(this.windowElement)&&!Position.within(this.windowElement,g,h)){this.close();d.close()}},setupDimensions:function(){if(c){this.windowElement.addClassName("my_shop")}var y=0,A=0;var C=this.windowElement.getDimensions();var D=C.width;var B=C.height;var w=this.elementX+this.elementWidth/2;var x=this.elementY;var t=w;var u=x+this.elementHeight;if(this.arrowNew){var b=this.cardId.down("em."+this.indicationStyle)}else{var b=this.cardId.down("p."+this.indicationStyle)}var a;if(b===undefined||b===null){a=17}else{a=b.getHeight()}switch(this.positionType){case 0:y=t-47;A=u+a;break;case 1:y=t-(D-47);A=u+a;break;case 2:y=w-47;A=x-a-B;break;case 3:y=w-(D-47);A=x-a-B;break;default:y=t-47;A=u+a;break}var E=0;if(this.overlay){E=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{E=Windows.getZIndex()+1}if(Mtime.browser.ie&&Mtime.browser.ie>=7){var s=this.element.getHeight();var v=this.element.getStyle("fontSize");var z=parseInt(v.slice(0,2),10);if(this.element.innerHTML!==""&&s>z+10){y=200}}this.windowElement.setStyle({position:"absolute",top:A+"px",left:y+"px",zIndex:E})}});this.collectBoxId=$(this.collectBox.id);if(this.collectBoxId){this.collectBoxId.observe("click",this.onClickshareContainerHandler)}}},destroyControl:function(){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){if(this.collectBox){this.collectBox.close();this.collectBox=null}}},load:function(){if(this.autoLoad&&this.isAjaxData){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),this.getShareInfoCallback.bind(this),this.shareContainer)}},render:function(){},renderWebShareLinks:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))},shareInfoLoaded:function(){},getShareInfoCallback:function(b){if(typeof getShareInfoResult!="undefined"&&getShareInfoResult.value){this.shareInfo=getShareInfoResult.value;this.shareInfoLoaded();this.renderWebShareLinks();if(this.autoLoad){this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);if(this.shareButton){this.shareButton.observe("click",this.onClickShareButtonHandler)}}this.showShareDialog(b)}else{$alert("加载对象信息出错，请刷新页面重试")}},onClickShareButton:function(d){var c=Event.findElement(d,"div");this.callback&&this.callback(c);if(c.hasClassName("curr")){c.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}else{if(c.hasClassName("notcurr")){c.removeClassName("notcurr")}c.addClassName("curr");if(this.shareContainer){this.shareContainer.show()}}Event.stop(d)},onClickshareContainer:function(C){var B=Event.findElement(C,"a");if(!B||!B.readAttribute){return}var J=B.readAttribute("method");if(!J){return}if(this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindTemplate){var I=this.shareContainer.up().up().up().down("ul").getElementsBySelector("li");if(typeof I!="undefined"&&I!=null&&I.length>0){var A=I[0];var G=A.readAttribute("title");var F=A.readAttribute("imgabstract");var H=A.down("img").readAttribute("src");this.title=G;this.pic=H;this.desc=F;var O=this.getShareObjectUrl();var N=this.getShareObjectTitle();var K="";var M=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var v=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){K=this.getShareObjectPicUrl()}var w=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,O,N,K)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,O,N,K,M,v)}}.bind(this))}}else{if(this.shareRelatedObjType===ShareRelatedObjectTypes.ImageNews){if(this.imageId!=this.expandMovieId){this.shareInfo=null;this.expandMovieId=this.imageId;var y=this.ButtonInfoMap.values();var D=[];var L=siteCommunityServiceUrl+"/ShareHandler.ashx?shareRelatedObjType="+this.shareRelatedObjType+"&relatedId="+this.getShareObjectId()+"&expandId="+this.getShareExpandId()+"&screenshotImageUrl="+this.getScreenshotImageUrl();var z=L+"&method="+J;if(this.shareButton&&this.shareContainer){if(this.shareControlStyleType==ShareControlStyleType.FloatStyle){D.push('<ul class="clearfix">');for(var E=0;E<y.length;++E){var x=y[E];if(this.avaliableTabs.indexOf(x.type)<0){continue}if(x.name==="toMtime"){D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:void(0);">'+x.text+"</a></li>")}else{if(x.name==="toEMail"){D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:EmailIframe(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></li>")}else{D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:GlobalSiteShare(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></li>")}}}D.push("</ul>");this.shareContainer.innerHTML=D.join("")}else{if(this.shareControlStyleType==ShareControlStyleType.ListStyle){for(var E=0;E<y.length;++E){var x=y[E];if(this.avaliableTabs.indexOf(x.type)<0){continue}if(x.name==="toMtime"){D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:void(0);">'+x.text+"</a></p>")}else{if(x.name==="toEMail"){D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:EmailIframe(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></p>")}else{D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:GlobalSiteShare(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></p>")}}}this.shareContainer.innerHTML=D.join("")}}}GlobalUrlValue=z}}}if(this.shareInfo===null&&this.isAjaxData){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),this.getShareInfoCallback.bind(this,J),this.shareContainer)}else{this.showShareDialog(J,C)}},shareTrack:function(d){var f=null;if(this.shareRelatedObjType!=0){this.ShareRelatedObjectTypes.find(function(a){if(a.value===this.relatedObjType){f=a.key}return false}.bind(this))}else{this.MtimeShareRelatedObjectTypes.find(function(a){if(a.value===this.relatedObjType){f=a.key}return false}.bind(this))}if(!f){return}var e=String.format("M11_Common_Share{0}_{1}",f,d);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackClick("M11_Common",e)}},showShareDialog:function(e,f){var d=this.ButtonInfoMap[e];if(!d){return}if(d.type==ShareTabType.shareToWeb||d.type==ShareTabType.shareToEMail){if(!f){}if(this.shareSuccessCallBack){this.shareSuccessCallBack()}this.shareTrack(e)}else{if(d.type==ShareTabType.showQrCode){if(this.shareSuccessCallBack){this.shareSuccessCallBack()}this.shareTrack(e)}else{if(f){Event.stop(f)}if(!this.shareInfo||typeof(this.shareInfo.isLogin)=="undefined"||this.shareInfo.isLogin==null){this.server.getIsLogin(function(){if(typeof(getIsLogin)!="undefined"&&getIsLogin.value){if(!getIsLogin.value.isLogin){$redirect(this.getSignInUrl());return}switch(d.type){case ShareTabType.shareToMtimeFriend:this.showShareToMtimeFriendDialog();if(this.shareButton){if(this.shareButton.hasClassName("curr")){this.shareButton.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}}break;default:throw"ButtonType does not implemented"}}}.bind(this))}else{if(!this.shareInfo.isLogin){$redirect(this.getSignInUrl());return}switch(d.type){case ShareTabType.shareToMtimeFriend:this.showShareToMtimeFriendDialog();if(this.shareButton){if(this.shareButton.hasClassName("curr")){this.shareButton.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}}break;default:throw"ButtonType does not implemented"}}}}},showShareToMtimeFriendDialog:function(){new ShareToMtimeFriendDialog({shareControl:this})},getSignInUrl:function(){return siteMcUrl+"/member/signin/operation/?redirectUrl="+encodeURIComponent(location.href)},getShareObjectUrl:function(){return""},getShareObjectPicUrl:function(){return""},getShareObjectMailTitle:function(){return""},getShareObjectTitle:function(){return""},getShareObjectId:function(){return 0},getShareExpandId:function(){return 0},getShareExpandContext:function(){return""},getScreenshotImageUrl:function(){return""},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},getShareObjectDefaultRecommendSuffix:function(){return""},getMiddleShareHtml:function(){return""},saveShareInternal:function(k,h,n,l,j,o){if(this.shareRelatedObjType==ShareRelatedObjectTypes.MovieShortComment||this.shareRelatedObjType==ShareRelatedObjectTypes.MovieLeaveComment){this.server.ForwardTweet([k,this.getShareObjectId(),false,false],n,l)}else{var m=this.getShareObjectId();if(this.shareRelatedObjType===ShareRelatedObjectTypes.MovieContentPlot||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieRoleDescInfo||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindCurtain||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieVerseLines||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindTemplate||this.shareRelatedObjType===ShareRelatedObjectTypes.MediaReview){m=this.expandMovieId}this.server.saveShareInfo(this.relatedObjType,m,k,h,j,o)}},onSaveShareCallback:function(c,d){if(d){c(d)}},onTweetSaveShareCallback:function(c,d){if(d){c(d)}},saveShare:function(j,g,l,k,h,m){this.saveShareInternal(j,this.onSaveShareCallback.bind(this,g),this.onTweetSaveShareCallback.bind(this,l),k,h,m)},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareMovieControl=Class.create();Object.extend(ShareMovieControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieControl.prototype,{name:"ShareMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.Movie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieIsReleasedControl=Class.create();Object.extend(ShareMovieIsReleasedControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieIsReleasedControl.prototype,{name:"ShareMovieIsReleasedControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieIsReleased,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieUpcomingControl=Class.create();Object.extend(ShareMovieUpcomingControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieUpcomingControl.prototype,{name:"ShareMovieUpcomingControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieUpcoming,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieHasAwardsControl=Class.create();Object.extend(ShareMovieHasAwardsControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieHasAwardsControl.prototype,{name:"ShareMovieHasAwardsControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieHasAwards,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieGeneralControl=Class.create();Object.extend(ShareMovieGeneralControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieGeneralControl.prototype,{name:"ShareMovieGeneralControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieGeneral,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieContentPlotControl=Class.create();Object.extend(ShareMovieContentPlotControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieContentPlotControl.prototype,{name:"ShareMovieContentPlotControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieContentPlot,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieParagraphId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieParagraphLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieParagraphId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》剧情";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieRoleDescInfoControl=Class.create();Object.extend(ShareMovieRoleDescInfoControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieRoleDescInfoControl.prototype,{name:"ShareMovieRoleDescInfoControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieRoleDescInfo,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieRoleId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieRoleLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieRoleId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》角色介绍";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieRoleDescAllControl=Class.create();Object.extend(ShareMovieRoleDescAllControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieRoleDescAllControl.prototype,{name:"ShareMovieRoleDescAllControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieRoleDescAll,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieRoleLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》角色介绍";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieBehindCurtainControl=Class.create();Object.extend(ShareMovieBehindCurtainControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieBehindCurtainControl.prototype,{name:"ShareMovieBehindCurtainControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieBehindCurtain,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{behindSectionID:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.behindSectionLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.behindSectionID},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.getScreenshotImageUrl()},getScreenshotImageUrl:function(){if(this.shareInfo){return this.shareInfo.screenshotImageUrl}else{return""}},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》幕后看点";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieVerseLinesControl=Class.create();Object.extend(ShareMovieVerseLinesControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieVerseLinesControl.prototype,{name:"ShareMovieVerseLinesControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieVerseLines,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{behindSectionID:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.behindSectionLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.behindSectionID},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.getScreenshotImageUrl()},getScreenshotImageUrl:function(){if(this.shareInfo){return this.shareInfo.screenshotImageUrl}else{return""}},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》台词金句";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieBehindTemplateControl=Class.create();Object.extend(ShareMovieBehindTemplateControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieBehindTemplateControl.prototype,{name:"ShareMovieBehindTemplateControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieBehindTemplate,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",movieId:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),render:function(){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),function(){if(typeof getShareInfoResult!="undefined"&&getShareInfoResult.value){this.shareInfo=getShareInfoResult.value}else{$alert("加载对象信息出错，请刷新页面重试")}var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}.bind(this),this.shareContainer)},getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.title+" "+this.desc+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return"《"+this.shareInfo.movieName+"》-"+this.title+" "+this.desc+this.link},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return this.movieId},getShareObjectMailTitle:function(){return this.shareInfo.movieName},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》幕后";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieTelecinePageControl=Class.create();Object.extend(ShareMovieTelecinePageControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieTelecinePageControl.prototype,{name:"ShareMovieTelecinePageControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{date:new Date(),movieTitle:"",cityName:"",imageUrl:"",link:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),load:function(){this.getImagePath(null);ShareControlBase.prototype.load.apply(this)},getImagePath:function(b){if(!this.imageUrl){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UploadPicByUrl",[this.link],function(a){if(a&&a.value&&a.value.ImagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetThumbnailImageUrlByImagePath",[a.value.ImagePath],function(d){if(d&&d.value&&d.value.ImageUrl){this.imageUrl=a.value.ImagePath;this.link=d.value.ImageUrl;b&&b()}}.bind(this),"/Service/Twitter.msi","get","20000")}}.bind(this),"/Service/Twitter.msi","get","20000")}else{b&&b()}},getMiddleShareHtml:function(){var d=[];var c=this.date+" "+this.cityName+" 最新影讯";d.push('<div class="picmid"><a title="'+this.movieTitle+'" target="_blank" href="'+this.link+'"><img alt="'+this.movieTitle+'" src="'+this.imageUrl+'" /></a></div>');d.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.movieTitle+"</a></h2><p>"+c+"</p></div>");return d.join("")},shareMtimeContent:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 最新影讯 "+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 最新影讯地址："+this.link},getShareObjectPicUrl:function(){return this.imageUrl},getShareObjectMailTitle:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 影讯"},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl();j=j.replace(new RegExp("&","ig"),"^PIC^")}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var SharePersonFavorableCommentControl=Class.create();Object.extend(SharePersonFavorableCommentControl.prototype,ShareControlBase.prototype);Object.extend(SharePersonFavorableCommentControl.prototype,{name:"SharePersonFavorableCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Person,shareRelatedObjType:ShareRelatedObjectTypes.PersonFavorableComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{personId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.personName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.personName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.personName+"</a></h2><h3>"+this.shareInfo.personNameEn+"</h3><ul><li>"+this.shareInfo.personSex+"，"+this.shareInfo.personConstellation+"</li><li>职业："+this.shareInfo.personProfessions+"</li></ul></div>");return b.join("")},shareMtimeContent:function(){return"分享影人"},getShareObjectUrl:function(){return this.shareInfo.personLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.personId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e='关于"'+this.getShareObjectMailTitle()+'"';var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareNewsControl=Class.create();Object.extend(ShareNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareNewsControl.prototype,{name:"ShareNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,shareRelatedObjType:ShareRelatedObjectTypes.News,isPicNews:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享新闻"},getShareObjectUrl:function(){return this.shareInfo.newsLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.newsId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="电影新闻分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareImageNewsControl=Class.create();Object.extend(ShareImageNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareImageNewsControl.prototype,{name:"ShareImageNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSGalleryImage,shareRelatedObjType:ShareRelatedObjectTypes.ImageNews,isPicNews:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.isPicNews=true},initializeField:function(){ShareControlBase.prototype.initializeField.apply(this);this.expandMovieId=this.imageId},getMiddleShareHtml:function(){var d=[];var e=this.shareInfo.imageNewTitle;var f=this.shareInfo.imageTitle;d.push('<div class="picmid"><a title="'+e+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+e+'" src="'+this.getShareObjectPicUrl()+'" /></a></div>');d.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+e+"</a></h2><p>"+f+"</p></div>");return d.join("")},shareMtimeContent:function(){return"分享新闻"},getShareObjectUrl:function(){return this.shareInfo.newsLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="电影新闻分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieLongCommentControl=Class.create();Object.extend(ShareMovieLongCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieLongCommentControl.prototype,{name:"ShareMovieLongCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Blog,shareRelatedObjType:ShareRelatedObjectTypes.MovieLongComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{blogId:0,urlTypeId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享影评"},getShareObjectUrl:function(){return this.shareInfo.blogLink},getShareObjectTitle:function(){this.shareInfo.title=this.shareInfo.title.replace(/\"/g,"＂");return this.shareInfo.title},getShareObjectId:function(){return this.blogId},getShareExpandId:function(){return this.urlTypeId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[影评分享]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieShortCommentControl=Class.create();Object.extend(ShareMovieShortCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieShortCommentControl.prototype,{name:"ShareMovieShortCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Twitter,shareRelatedObjType:ShareRelatedObjectTypes.MovieShortComment,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{tweetId:0}),shareMtimeContent:function(){return"分享微评"},getShareObjectUrl:function(){return this.shareInfo.tweetLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.tweetId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="关于《"+this.getShareObjectMailTitle()+"》的短评";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieLeaveCommentControl=Class.create();Object.extend(ShareMovieLeaveCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieLeaveCommentControl.prototype,{name:"ShareMovieLeaveCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Twitter,shareRelatedObjType:ShareRelatedObjectTypes.MovieLeaveComment,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{tweetId:0}),shareMtimeContent:function(){return"分享微评"},getShareObjectUrl:function(){return this.shareInfo.tweetLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.tweetId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e='关于"'+this.getShareObjectMailTitle()+'"';var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoMovieControl=Class.create();Object.extend(ShareVideoMovieControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoMovieControl.prototype,{name:"ShareVideoMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoMovie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享视频"},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoPersonControl=Class.create();Object.extend(ShareVideoPersonControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoPersonControl.prototype,{name:"ShareVideoPersonControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoPerson,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,personId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享视频"},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return this.personId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var SharePictureMovieControl=Class.create();Object.extend(SharePictureMovieControl.prototype,ShareControlBase.prototype);Object.extend(SharePictureMovieControl.prototype,{name:"SharePictureMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.MoviePicture,shareRelatedObjType:ShareRelatedObjectTypes.PictureMovie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.specificImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.movieName+"</a></h2><p>"+this.shareInfo.specificImageTypeName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享图片"},getShareObjectUrl:function(){return this.shareInfo.imageLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享图片："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var SharePicturePersonControl=Class.create();Object.extend(SharePicturePersonControl.prototype,ShareControlBase.prototype);Object.extend(SharePicturePersonControl.prototype,{name:"SharePicturePersonControl",relatedObjType:MtimeShareRelatedObjectTypes.PersonPicture,shareRelatedObjType:ShareRelatedObjectTypes.PicturePerson,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.personName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.personName+'" src="'+this.shareInfo.specificImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.personName+"</a></h2><p>"+this.shareInfo.specificImageTypeName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享图片"},getShareObjectUrl:function(){return this.shareInfo.imageLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return this.personId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享图片："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareCinemaControl=Class.create();Object.extend(ShareCinemaControl.prototype,ShareControlBase.prototype);Object.extend(ShareCinemaControl.prototype,{name:"ShareCinemaControl",relatedObjType:MtimeShareRelatedObjectTypes.Cinema,shareRelatedObjType:ShareRelatedObjectTypes.Cinema,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{cinemaId:0,date:new Date()}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.cinemaName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.cinemaName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.cinemaName+"</a></h2><p>"+this.shareInfo.description+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareExpandContext:function(){return encodeURIComponent(this.getDatetime())},getShareObjectUrl:function(){return this.shareInfo.cinemaLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.cinemaId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getDatetime:function(){var m=this.date.getFullYear();var k=this.date.getMonth()+1;var h=this.date.getDate();var l=k.toString();if(k<10){l="0"+l}var j=h.toString();if(h<10){j="0"+j}var g=m+"年"+l+"月"+h+"日";return g},renderWebShareLinks:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl().replace(/\&/g,"^PIC^")}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))},getShareObjectDefaultRecommendContent:function(h){var f=this.getDatetime();var g='"'+this.getShareObjectMailTitle()+'"'+f+"影讯";var e=this.getShareObjectTitle();if(h==="subject"){return g}else{return e}}});var ShareUniversalControl=Class.create();Object.extend(ShareUniversalControl.prototype,ShareControlBase.prototype);Object.extend(ShareUniversalControl.prototype,{name:"ShareUniversalControl",relatedObjType:51,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",fullTitle:"",link:"",pic:"",desc:"",newsId:0,shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.title+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.title+'" src="'+this.getShareObjectPicUrl()+'" style="width:96px;height:96px" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.title+"</a></h2></div>");return b.join("")},shareMtimeContent:function(){return this.title+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.fullTitle+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return this.newsId},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareBlogControl=Class.create();Object.extend(ShareBlogControl.prototype,ShareControlBase.prototype);Object.extend(ShareBlogControl.prototype,{name:"ShareBlogControl",relatedObjType:MtimeShareRelatedObjectTypes.Blog,shareRelatedObjType:ShareRelatedObjectTypes.Blog,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{blogId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享文章"},getShareObjectUrl:function(){return this.shareInfo.blogLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.blogId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享文章]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareForumTopicControl=Class.create();Object.extend(ShareForumTopicControl.prototype,ShareControlBase.prototype);Object.extend(ShareForumTopicControl.prototype,{name:"ShareForumTopicControl",relatedObjType:MtimeShareRelatedObjectTypes.ForumTopic,shareRelatedObjType:ShareRelatedObjectTypes.ForumTopic,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{topicId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享文章"},getShareObjectUrl:function(){return this.shareInfo.topicLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.topicId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享文章]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareActivityControl=Class.create();Object.extend(ShareActivityControl.prototype,ShareControlBase.prototype);Object.extend(ShareActivityControl.prototype,{name:"ShareActivityControl",relatedObjType:MtimeShareRelatedObjectTypes.Activity,shareRelatedObjType:ShareRelatedObjectTypes.Activity,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{activityId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享活动"},getShareObjectUrl:function(){return this.shareInfo.activityLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.activityId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享活动]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMediaReviewControl=Class.create();Object.extend(ShareMediaReviewControl.prototype,ShareControlBase.prototype);Object.extend(ShareMediaReviewControl.prototype,{name:"ShareMediaReviewControl",relatedObjType:MtimeShareRelatedObjectTypes.MediaReview,shareRelatedObjType:ShareRelatedObjectTypes.MediaReview,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{mediaReviewId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.mediaReviewLink},getShareObjectTitle:function(){this.shareInfo.title=this.shareInfo.title.replace(/\"/g,"＂");return this.shareInfo.title},getShareObjectId:function(){return this.mediaReviewId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》媒体影评";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareLinkControl=Class.create();Object.extend(ShareLinkControl.prototype,ShareControlBase.prototype);Object.extend(ShareLinkControl.prototype,{name:"ShareLinkControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",mtimeDefaultContent:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),shareMtimeContent:function(){return this.mtimeDefaultContent},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareOffsiteLinkControl=Class.create();Object.extend(ShareOffsiteLinkControl.prototype,ShareControlBase.prototype);Object.extend(ShareOffsiteLinkControl.prototype,{name:"ShareOffsiteLinkControl",relatedObjType:MtimeShareRelatedObjectTypes.OffsiteLink,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",mtimeDefaultContent:""}),shareMtimeContent:function(){return this.mtimeDefaultContent},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},initializeDOM:function(){var f=this.ButtonInfoMap.values();var g=[];if(this.shareContainer){for(var h=0;h<f.length;++h){var e=f[h];if(this.avaliableTabs.indexOf(e.type)<0){continue}if(e.name==="toMtime"||e.name==="toQzone"){}else{if(e.name==="toEMail"){g.push('<a class="'+e.shareClassName+'" method="'+e.name+'" href="###" >'+e.text+"</a>")}else{g.push('<a class="'+e.shareClassName+'" method="'+e.name+'" href="###" target="_self" >'+e.text+"</a>")}}}this.shareContainer.innerHTML=g.join("")}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareGoodsDetailControl=Class.create();Object.extend(ShareGoodsDetailControl.prototype,ShareControlBase.prototype);Object.extend(ShareGoodsDetailControl.prototype,{name:"ShareGoodsDetailControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.title+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.title+'" src="'+this.pic+'" /></a></div>');return b.join("")},shareMtimeContent:function(){return"分享商品"},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareNewsCommentControl=Class.create();Object.extend(ShareNewsCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareNewsCommentControl.prototype,{name:"ShareNewsCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,shareRelatedObjType:ShareRelatedObjectTypes.NewsComment,isPicNews:false,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0,commentContext:"",newsTitle:"",newsUrl:"",shareInfo:{isLogin:null,needAdditionalInfo:true}}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.newsTitle;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.newsUrl},getShareObjectTitle:function(){return"<"+this.commentContext+"> 评：新闻 【"+this.newsTitle+"】 <"+this.newsUrl+">"},getShareObjectId:function(){return this.newsId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.newsTitle},getShareObjectDefaultRecommendContent:function(f){var e="新闻评论分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareVideoMovieCommentControl=Class.create();Object.extend(ShareVideoMovieCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoMovieCommentControl.prototype,{name:"ShareVideoMovieCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoMovieComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,commentContext:""}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return 0},getShareExpandContext:function(){return encodeURIComponent(this.commentContext)},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频评论："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoPersonCommentControl=Class.create();Object.extend(ShareVideoPersonCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoPersonCommentControl.prototype,{name:"ShareVideoPersonCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoPersonComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,personId:0,commentContext:""}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return this.personId},getShareExpandContext:function(){return encodeURIComponent(this.commentContext)},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频评论："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareSCMGoodsCommentControl=Class.create();Object.extend(ShareSCMGoodsCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareSCMGoodsCommentControl.prototype,{name:"ShareSCMGoodsCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.SCMGoodsComment,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{goodsName:"",commentText:"",link:"",goodsImageUrl:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var c=[];var d=this.goodsImageUrl.substring(0,this.goodsImageUrl.lastIndexOf("."))+"_160X160";d+=this.goodsImageUrl.substring(this.goodsImageUrl.lastIndexOf("."));c.push('<div class="picmid"><a title="'+this.goodsName+'" target="_blank" href="'+this.link+'"><img alt="'+this.goodsName+'" src="'+d+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.goodsName+"</a></h2></div>");return c.join("")},shareMtimeContent:function(){return"【商品】"+this.goodsName+': "'+this.commentText+'" '+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.goodsName+': "'+this.commentText+'" '+this.link},getShareObjectMailTitle:function(){return"商品评论分享："+this.goodsName},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.goodsImageUrl},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.goodsName,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareSCMGoodsDetailControl=Class.create();Object.extend(ShareSCMGoodsDetailControl.prototype,ShareControlBase.prototype);Object.extend(ShareSCMGoodsDetailControl.prototype,{name:"ShareSCMGoodsDetailControl",relatedObjType:MtimeShareRelatedObjectTypes.SCMGoodsComment,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{goodsName:"",link:"",goodsImageUrl:"",desc:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var c=[];var d=this.goodsImageUrl.substring(0,this.goodsImageUrl.lastIndexOf("."))+"_160X160";d+=this.goodsImageUrl.substring(this.goodsImageUrl.lastIndexOf("."));c.push('<div class="picmid"><a title="'+this.goodsName+'" target="_blank" href="'+this.link+'"><img alt="'+this.goodsName+'" src="'+d+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.goodsName+"</a></h2></div>");return c.join("")},shareMtimeContent:function(){return this.goodsName+" | "+this.desc},onClickShareButton:function(d){var c=Event.findElement(d,"dd");this.callback&&this.callback(c);if(c.hasClassName("on")){c.removeClassName("on");if(this.shareContainer){this.shareContainer.hide()}}else{if(c.hasClassName("notcurr")){c.removeClassName("notcurr")}c.addClassName("on");if(this.shareContainer){this.shareContainer.show()}}Event.stop(d)},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.goodsName+" | "+this.desc+" | 时光商城"},getShareObjectMailTitle:function(){return"分享商品："+this.goodsName},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.goodsImageUrl},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d="分享商品： "+this.getShareObjectTitle()+" "+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.goodsName,this.link,e,this.desc,d)},render:function(){var q=this.getShareObjectUrl();var p=this.getShareObjectTitle();var n="";var m=this.goodsName;var l=this.desc;var o=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var j=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){n=this.getShareObjectPicUrl()}var k=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){if(c=="toSinaMicroblogging"||c=="toTencentMicroblogging"){a.href=String.format(b.urlFormat,q,p,n)}else{a.href=String.format(b.urlFormat,q,m,n,p,l)}}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,q,m,n,p,l,o,j)}}.bind(this))}});var ShareTopListControl=Class.create();Object.extend(ShareTopListControl.prototype,ShareControlBase.prototype);Object.extend(ShareTopListControl.prototype,{name:"ShareTopListControl",relatedObjType:MtimeShareRelatedObjectTypes.TopList,shareRelatedObjType:ShareRelatedObjectTypes.TopList,isPicNews:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{topListId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){var b=this.shareInfo.description;if(b.bytelength()>this.EXCERPT_SIZE*2){b=b.substr(0,this.EXCERPT_SIZE)+"..."}return b},getShareObjectUrl:function(){return this.shareInfo.link},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.topListId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享一个时光热榜-"+this.getShareObjectMailTitle();var d="你好，这个时光热榜不错哦，我猜你会喜欢！《"+this.getShareObjectMailTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}}});var ShareControlManager=Class.create();Object.extend(ShareControlManager.prototype,{controls:null,initialize:function(){this.controls=[]},swtichNewControl:function(e,h){var f=parseInt(e.shareRelatedObjType,10);var g;switch(f){case ShareRelatedObjectTypes.Movie:g=new ShareMovieControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieIsReleased:g=new ShareMovieIsReleasedControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieUpcoming:g=new ShareMovieUpcomingControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieHasAwards:g=new ShareMovieHasAwardsControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieGeneral:g=new ShareMovieGeneralControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieContentPlot:g=new ShareMovieContentPlotControl({shareControlStyleType:h,movieParagraphId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieRoleDescInfo:g=new ShareMovieRoleDescInfoControl({shareControlStyleType:h,movieRoleId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieRoleDescAll:g=new ShareMovieRoleDescAllControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieBehindCurtain:g=new ShareMovieBehindCurtainControl({shareControlStyleType:h,behindSectionID:e.relatedId,screenshotImageUrl:e.screenshotImageUrl,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieVerseLines:g=new ShareMovieVerseLinesControl({shareControlStyleType:h,behindSectionID:e.relatedId,screenshotImageUrl:e.screenshotImageUrl,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieBehindTemplate:g=new ShareMovieBehindTemplateControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,desc:e.desc,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieTelecinePage:g=new ShareMovieTelecinePageControl({shareControlStyleType:h,shareButton:e.shareButton,shareContainer:e.shareContainer,movieTitle:e.movieTitle,cityName:e.cityName,imageUrl:e.imageUrl,date:e.date,link:e.link,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PersonFavorableComment:g=new SharePersonFavorableCommentControl({shareControlStyleType:h,personId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.News:g=new ShareNewsControl({shareControlStyleType:h,newsId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.ImageNews:g=new ShareImageNewsControl({shareControlStyleType:h,imageId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieLongComment:g=new ShareMovieLongCommentControl({shareControlStyleType:h,blogId:e.relatedId,urlTypeId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieShortComment:g=new ShareMovieShortCommentControl({shareControlStyleType:h,tweetId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieLeaveComment:g=new ShareMovieLeaveCommentControl({shareControlStyleType:h,tweetId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.VideoMovie:g=new ShareVideoMovieControl({shareControlStyleType:h,videoId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.VideoPerson:g=new ShareVideoPersonControl({shareControlStyleType:h,videoId:e.relatedId,personId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PictureMovie:g=new SharePictureMovieControl({shareControlStyleType:h,imageId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,desc:e.desc,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PicturePerson:g=new SharePicturePersonControl({shareControlStyleType:h,imageId:e.relatedId,personId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,desc:e.desc,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Cinema:g=new ShareCinemaControl({shareControlStyleType:h,cinemaId:e.relatedId,date:e.date,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.IndexNewsTop:g=new ShareUniversalControl({shareControlStyleType:h,newsId:e.relatedId,title:e.title,fullTitle:e.fullTitle,link:e.link,pic:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Blog:g=new ShareBlogControl({shareControlStyleType:h,blogId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.ForumTopic:g=new ShareForumTopicControl({shareControlStyleType:h,topicId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Activity:g=new ShareActivityControl({shareControlStyleType:h,activityId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MediaReview:g=new ShareMediaReviewControl({shareControlStyleType:h,mediaReviewId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Link:g=new ShareLinkControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.OffsiteLink:g=new ShareOffsiteLinkControl({title:e.title,link:e.link,pic:e.pic,desc:e.desc,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.GoodsDetail:g=new ShareGoodsDetailControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.SCMGoodsDetail:g=new ShareSCMGoodsDetailControl({shareControlStyleType:h,goodsName:e.title,link:e.link,goodsImageUrl:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;default:break}return g},initShareControl:function(c){var d=[];c.each(function(a){var b;var h=ShareControlStyleType.FloatStyle;if(a.shareControlStyleType){h=a.shareControlStyleType}var j=parseInt(a.shareRelatedObjType,10);var k=this;var b=k.swtichNewControl(a,h);if(b){this.controls.push(b);d.push(b)}}.bind(this));return d},destroyControl:function(){this.controls.each(function(b){b.close()});this.controls=null},close:function(){if(!this.closed){this.closed=true;this.destroyControl()}}});function EmailIframe(d){var c=document.createElement("iframe");c.style.display="none";c.style.width="0px";c.style.height="0px";c.src=d;document.body.appendChild(c);setTimeout(function(){document.body.removeChild(c)},8000)}function GlobalSiteShare(z){if(GlobalUrlValue!==""){z=GlobalUrlValue;GlobalUrlValue=""}var q=z.indexOf("?");if(q>0){var w=z.substring(q);var u=z.substring(0,q);var p=[];var y=w.substring(1);var v=y.split("&");for(var s=0;s<v.length;s++){var x=v[s].indexOf("=");if(x==-1){continue}var j=v[s].substring(0,x);var A=v[s].substring(x+1);A=A.replace(/\^PIC\^/g,encodeURIComponent("&"));p.push({key:j,value:decodeURIComponent(A)})}var r=null;if(p.length>0){r=u+"?";for(var t=0;t<p.length;t++){if(t!=0){r+="&"}r+=p[t].key+"="+encodeURIComponent(p[t].value)}}if(r!=null){z=r}}window.open(z)}function ShowQrCode(f){var d="";if(getNewValue){d=encodeURIComponent(getNewValue(location.href))}else{d=encodeURIComponent(location.href)}d=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+d;var e=[];e.push('<div class="tc">');e.push('<h4 class="px18">分享到微信朋友圈</h4>');e.push('<p><img width="232" height="232" alt="二维码" src="'+d+'"></p>');e.push('<p class="c_666 px14">扫描上方二维码 分享到微信</p>');e.push("</div>");this.dialog=new Dialog({title:"",content:e.join("")})}if(typeof(CinemaWidgets)=="undefined"){var CinemaWidgets=Class.create()}CinemaWidgets.SlidesControl=Class.create();Object.extend(CinemaWidgets.SlidesControl.prototype,Widgets.Base.prototype);Object.extend(CinemaWidgets.SlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",slidesRegionWidth:1000,currentPosition:0,duration:0.5,type:"neat"},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.$slidesRegions=this.$slidesRegion.immediateDescendants();this.$prev=$(this.prev);this.$next=$(this.next)},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);this.$prev&&Event.observe(this.$prev,"click",this.onPrevClickHandler);this.$next&&Event.observe(this.$next,"click",this.onNextClickHandler);Event.observe(window,"load",this.onLoader.bind(this));Event.observe(window,"unload",this.close.bind(this))},onLoader:function(b){this.reset()},reset:function(){this.currentPosition=0;this.$slidesRegion.style.left=this.currentPosition+"px";this.pageIndex=0;this.amount=0;this.length=this.$slidesRegions.length;for(var b=0;b<this.length;b++){this.amount+=this.$slidesRegions[b].clientWidth}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth);if(this.amount>this.slidesRegionWidth){this.$prev&&this.$prev.show();this.$next&&this.$next.show();if(this.currentPosition===0){this.$prev&&this.$prev.hide()}}else{this.$prev&&this.$prev.hide();this.$next&&this.$next.hide()}},onPrevClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$next.show();this.pageIndex--;this.currentPosition+=this.slidesRegionWidth;if(this.pageIndex<=0){this.currentPosition=0;this.$prev.hide()}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.prevSlides()}},onNextClick:function(c){var d=c.target||c.srcElement;Event.stop(c);if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$prev.show();this.pageIndex++;this.currentPosition-=this.slidesRegionWidth;if(this.pageIndex>=this.amountIndex-1){this.currentPosition=-(this.amount-this.slidesRegionWidth);this.$next.hide()}this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.nextSlides()}},prevSlides:function(){if(this.lock){return}var c=null;var d=0;this.$next.show();this.pageIndex--;d=this.slidesRegionWidth*this.pageIndex;if(this.pageIndex<=0){d=Math.abs(this.currentPosition);this.$prev.hide()}c={node:this.slidesRegion,duration:this.duration,scale:d,position:this.currentPosition,callback:function(){if(this.pageIndex<=0){this.currentPosition=0}}.bind(this)};this.move(c);this.currentPosition+=this.slidesRegionWidth},nextSlides:function(){if(this.lock){return}var c=null;var d=0;this.$prev.show();this.pageIndex++;d=this.slidesRegionWidth*this.pageIndex;if(this.pageIndex>=this.amountIndex-1){d=this.amount-this.slidesRegionWidth*this.pageIndex;this.$next.hide()}c={node:this.slidesRegion,duration:this.duration,scale:-d,position:this.currentPosition,callback:function(){if(this.pageIndex>=this.amountIndex-1){this.currentPosition=-(this.amount-this.slidesRegionWidth)}}.bind(this)};this.move(c);this.currentPosition-=this.slidesRegionWidth},move:function(b){this.lock=true;new Fx.Move(b.node,{scaleX:true,duration:b.duration,distances:{left:b.scale,position:b.position},callback:function(){this.lock=false;b.callback&&b.callback()}.bind(this)})},destroyEvent:function(){this.onPrevClickHandler&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.onNextClickHandler&&Event.stopObserving(this.$next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null}});CinemaWidgets.CinemaTopSlidesControl=Class.create();Object.extend(CinemaWidgets.CinemaTopSlidesControl.prototype,Widgets.BehindSlidesControl.prototype);Object.extend(CinemaWidgets.CinemaTopSlidesControl.prototype,{options:{slidesRegion:"movieSlidesItems",prev:"prev",next:"next",autoTimeout:7,duration:0.5,type:"neat"},instanceSlidesControl:function(){var d=this;var c=new SlidesControl({slidesRegion:this.slidesRegion,prev:this.prev,next:this.next,scale:this.$images[0].offsetWidth,duration:this.duration,type:"neat",autoTimeout:this.autoTimeout,initializeField:function(){this.slidesRegion=$(this.slidesRegion);this.prev=$(this.prev);this.next=$(this.next);this.currentIndex=0;this.position=0;this.items=this.slidesRegion.childElements();this.length=this.items.length;this.lock=false;this.timeOutMethod()},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);Event.observe(this.prev,"click",this.onPrevClickHandler);Event.observe(this.next,"click",this.onNextClickHandler);this.slidesRegionOverHendler=this.slidesRegionOver.bind(this);this.slidesRegionOutHendler=this.slidesRegionOut.bind(this);Event.observe(this.slidesRegion,"mouseover",this.slidesRegionOverHendler);Event.observe(this.slidesRegion,"mouseout",this.slidesRegionOutHendler)},onPrevClick:function(a){var b=a.target||a.srcElement;Event.stop(a);this.prevSlides();this.myTimeout&&clearInterval(this.myTimeout)},onNextClick:function(a){var b=a.target||a.srcElement;Event.stop(a);this.nextSlides();this.myTimeout&&clearInterval(this.myTimeout)},move:function(a){this.lock=true;new Fx.Move(a.node,{scaleX:true,duration:a.duration,distances:{left:a.scale,position:a.position},callback:function(){this.lock=false;this.timeOutMethod();a.callback&&a.callback()}.bind(this)})},timeOutMethod:function(){this.myTimeout&&clearInterval(this.myTimeout);this.myTimeout=setInterval(this.nextSlides.bind(this),this.autoTimeout*1000)},slidesRegionOver:function(a){this.myTimeout&&clearInterval(this.myTimeout)},slidesRegionOut:function(a){this.timeOutMethod()}})}});CinemaWidgets.DistanceSlidesControl=Class.create();Object.extend(CinemaWidgets.DistanceSlidesControl.prototype,Widgets.Base.prototype);Object.extend(CinemaWidgets.DistanceSlidesControl.prototype,{options:{slidesRegion:"",prev:"",next:"",showRegionWidth:695,slidesRegionWidth:1050,currentPosition:0,itemWidth:0,marginWidth:0,duration:0.5,type:"neat",movieListShadow:"",currentIndex:null,endCallBack:null,leaveEndCallBack:null},initializeDom:function(){this.$slidesRegion=$(this.slidesRegion);this.slidesRegions=this.$slidesRegion.immediateDescendants();this.length=this.slidesRegions.length;if(this.currentIndex){var q=this.getXY(this.$slidesRegion);var l=this.slidesRegions[this.currentIndex];var k=this.getXY(l);var p=q.x+this.showRegionWidth;var j=k.x+l.getWidth();var o,m,n;if(p<j){o=p-j;this.$slidesRegion.style.left=o+"px";this.currentPosition=o}p=q=l=k=j=o=m=n=null}if(Mtime.browser.ie>0||Mtime.browser.ie<9){this.$slidesRegion.addClassName("transition6")}this.movieListShadow=$(this.movieListShadow);this.$prev=$(this.prev);this.$next=$(this.next);if(this.$next){}},initializeEvent:function(){this.onPrevClickHandler=this.onPrevClick.bind(this);this.onNextClickHandler=this.onNextClick.bind(this);this.$prev&&this.$prev.observe("click",this.onPrevClickHandler);this.$next&&this.$next.observe("click",this.onNextClickHandler);Event.observe(window,"unload",this.close.bind(this))},load:function(){if(this.currentIndex===0||this.currentIndex==null){this.reset()}else{this.loadMethod()}},onLoader:function(b){},getXY:function(b){if(Widgets&&Widgets.Utils&&Widgets.Utils.getXY){return Widgets.Utils.getXY(b)}return null},getItems:function(){this.$slidesRegions=this.$slidesRegion.immediateDescendants();if(this.itemWidth>0){this.amount=this.itemWidth*this.length}else{for(var b=0;b<this.length;b++){this.amount+=this.slidesRegions[b].offsetWidth+this.marginWidth}}this.$slidesRegion.style.width=this.amount+100+"px";this.amountIndex=Math.ceil(this.amount/this.slidesRegionWidth)},reset:function(){this.isReset=true;this.$slidesRegion.style.left=this.currentPosition+"px";this.loadMethod()},loadMethod:function(){this.pageIndex=0;this.amount=0;this.getItems();if(this.amount>this.slidesRegionWidth){this.$next&&this.$next.show();if(this.currentPosition===0){this.$prev&&this.$prev.hide()}else{this.$prev&&this.$prev.show()}}else{this.$prev&&this.$prev.hide();this.$next&&this.$next.hide()}},onClickItem:function(p){if(p){var m=p;var s=this.getXY(this.$slidesRegion);var r=s.x+this.showRegionWidth;var l=this.getXY(m);var k=l.x+m.getWidth();var q=0,n,o;if(r<k){q=r-k}else{if(r<k){q=k-r}}this.$slidesRegion.style.left=q+"px";r=s=m=l=k=q=null}},onPrevClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(this.movieListShadow){this.movieListShadow.show()}this.$next.show();if(this.leaveEndCallBack&&!this.hasCall){this.leaveEndCallBack();this.hasCall=true}var e=this.currentPosition;this.currentPosition+=this.slidesRegionWidth;if(this.currentPosition>=0){this.currentPosition=0;this.$prev.hide()}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}},onNextClick:function(d){var f=d.target||d.srcElement;Event.stop(d);if(this.amount<=this.slidesRegionWidth){this.getItems();return}if(this.movieListShadow){this.movieListShadow.hide()}this.$prev.show();var e=this.currentPosition;this.currentPosition-=this.slidesRegionWidth;if((this.showRegionWidth-this.currentPosition)>=this.amount){this.currentPosition=-(this.amount-this.showRegionWidth);this.$next.hide();this.endCallBack&&this.endCallBack()}if(Mtime.browser.ie===0||Mtime.browser.ie>9){this.$slidesRegion.style.left=this.currentPosition+"px"}else{this.slideMethod(this.$slidesRegion,e,this.currentPosition)}this.hasCall=false},slideMethod:function(e,h,f){if(this.lock){return}var g={element:e,duration:this.duration*10,speed:5,startScale:h,endScale:f,callback:function(){this.lock=false}.bind(this)};this.move(g)},move:function(k){var m=k.speed;var h=k.startScale;var j=k.endScale;var g=k.startScale;function l(){var a=false;if(h>j){g-=m;if(g<=j){g=j;a=true}}else{if(h<j){g+=m;if(g>=j){g=j;a=true}}else{g=j;a=true}}k.element.setStyle({left:g+"px"});if(a){k.callback()}else{setTimeout(l,k.duration)}}l()},destroyEvent:function(){this.$prev&&Event.stopObserving(this.$prev,"click",this.onPrevClickHandler);this.$next&&Event.stopObserving(this.$next,"click",this.onNextClickHandler)},destroyDOM:function(){this.slidesRegion=null;this.prev=null;this.next=null}});var TheaterFilter=Class.create();Object.extend(TheaterFilter.prototype,{options:{theaters:[],district:0,searchInput:"",searchBtn:"",searchTip:"",resultRegion:"",showCount:5,historyDataCookieName:"theaterSearchHistoryCookie",filterCallback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeControl();this.initializeEvent()},initializeControl:function(){this.autoComplete=new SearchAutoComplete({text:this.$searchInput,textWatermarkText:"搜索影院",listRegion:this.$searchTip,itemTemplate:'<dd value="#{cid}"><a title="#{cname}" href="#" target="_blank" onclick="return false;"><span class="fr px12">#{dsname}</span>#{sname}</a></dd>',idFieldName:"cid",titleFieldName:"cname",searchDatas:null,defaultSearchDatas:null,getSearchDataCallback:function(b){this.searchTheater(b)}.bind(this),choiceCount:8,isAlwayShowList:true,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:this.filterHandler,onClickListRegion:function(d){var c=Event.findElement(d,"dd");if(c!=document){this.removeObserver();this.selectedEntry(c);if(this.onEnterCallback){this.onEnterCallback(this.getValue())}}},selectEntry:function(){this.active=false;var b=this.getCurrentEntry();if(b){this.removeObserver();this.selectedEntry(b)}}})},initializeField:function(){this.$searchInput=$(this.searchInput);this.$searchBtn=$(this.searchBtn);this.$searchTip=$(this.searchTip);this.$searchTip&&this.$searchTip.hide();this.$resultRegion=$(this.resultRegion);this.filterHandler=this.filter.bind(this)},initializeEvent:function(){Event.observe(this.$searchBtn,"click",this.filterHandler)},searchTheater:function(callback){var theaters=[];var keyword=this.$searchInput.value;if(keyword==""){var historyData=getCookie(this.historyDataCookieName);if(historyData&&historyData!=""){theaters=eval(historyData);this.autoComplete.defaultSearchDatas=theaters}}else{this.theaters.each(function(theater){if(theater.cname.toLowerCase().indexOf(keyword.toLowerCase())!=-1||!keyword){theaters.push(theater)}}.bind(this))}callback&&callback(theaters)},setDistrict:function(b){this.district=parseInt(b);this.autoComplete.textbox.clear();this.filter()},setTheater:function(d){d=parseInt(d);var c=this.theaters.select(function(a){return a.Id==d})[0];if(c){this.district=0;this.autoComplete.textbox.setValue(c.Name);this.filter(c)}},filter:function(f){this.$searchTip.hide();var e=[];var d=this.autoComplete.textbox.getValue();this.theaters.each(function(a){if(f&&f.cid){if(a.cid==f.cid){e.push(a);this.addHistoryData(f)}}else{if(a.cname.indexOf(d)!=-1){e.push(a)}}}.bind(this));this.filterCallback&&this.filterCallback(e)},addHistoryData:function(theater){var currentTheater={cid:theater.cid,cname:theater.cname,sname:theater.sname,dsname:theater.dsname};var historyDatas=getCookie(this.historyDataCookieName);var cookieDomain=window.location.hostname;if(typeof historyDatas!="undefined"&&historyDatas!=""){historyDatas=eval(historyDatas);var endIndex=Math.max(historyDatas.length-this.showCount,0);for(var i=historyDatas.length-1;i>=endIndex;i--){if(theater.cid==historyDatas[i].cid){historyDatas.splice(i,1);return}}historyDatas.push(currentTheater);if(historyDatas.length>this.showCount){historyDatas.shift()}setCookie(this.historyDataCookieName,historyDatas.toJSON(),cookieDomain)}else{var historyDatas=[];historyDatas.push(currentTheater);setCookie(this.historyDataCookieName,historyDatas.toJSON(),cookieDomain)}},destroyField:function(){},destroyEvent:function(){Event.stopObserving(this.$searchBtn,"click",this.filterHandler)},destroyControl:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyField();this.destroyed=true}}});var TheaterCustomerDialog=Class.create();Object.extend(Object.extend(TheaterCustomerDialog.prototype,Window.prototype),{options:{windowClassName:"",windowStyle:""},initializeWindow:function(){var b=this.uniqueId;this.id="window08_"+b},addDOM:function(){this.windowElement=Builder.build('<div><div class="'+this.windowClassName+'" style="'+this.windowStyle+'">'+this.content+"</div></div>")},destroyDOM:function(){},render:function(){this.open();setTimeout(function(){this.windowElement.down().setStyle({zoom:1})}.bind(this),50);if(this.closeTimeout>0){this.timerId=setTimeout(this.autoClose.bind(this),this.closeTimeout*1000)}},load:function(){this.readyCallback&&this.readyCallback(this)},setupDimensions:function(){var m=this.dimensions.viewport.height/2+this.pagePosition.y;var l=this.dimensions.viewport.width/2+this.pagePosition.x;var j=this.windowElement.down().getDimensions();var k=j.width,h=j.height;var g=(m-parseFloat(h)/2);if(g<=0){g=this.fixTopHeight}this.windowElement.setStyle({position:"absolute",top:g+"px",left:(l-parseFloat(k)/2)+"px",zIndex:this.overlay?parseInt(this.overlay.getStyle("zIndex"))+1:Windows.getZIndex()});this.windowElement.down().setStyle({zIndex:parseInt(this.windowElement.getStyle("zIndex"))+1})},autoClose:function(){if(this.timerId){clearTimeout(this.timerId)}this.close()},dispose:function(){}});var TheaterMap=Class.create();Object.extend(TheaterMap.prototype,{options:{mapRegion:null,theaterSelectCallback:null,theaters:null,showInfoWindow:true,InfoWindowTemplate:new Template('<div><p class="mt6">地址：#{Address}</p>  <p class="mt6">电话：#{Telephone}</p>  <p class="mt9">#{_URLHTML}</p><p class="line_dot mt12 mb12">&nbsp;</p>  <p><a href="#" onclick="return false;" method="to" class="onbold">到这里去</a> | <a href="#" onclick="return false;" method="from">从这里出发</a></p>  <p class="mt9"><input type="text" class="w95 txt"><a href="#" onclick="return false;" class="i_btn_ws ml9" method="bt">公交</a><a href="#" onclick="return false;" class="i_btn_ws ml9" method="dt">驾车</a></p></div>'),durl:new Template("http://map.baidu.com/?newmap=1&tn=B_NORMAL_MAP&i=0,1,1&s=nav%26sn%3D2%24%24%24%24%24%24#{from}%24%240%24%24%24%24%26en%3D2%24%24%24%24%24%24#{to}%24%240%24%24%24%24%26pn%3D0%26rn%3D5%26sy%3D0&sc=0"),burl:new Template("http://map.baidu.com/?newmap=1&tn=B_NORMAL_MAP&i=0,1,1&s=bt%26sn%3D2%24%24%24%24%24%24#{from}%24%240%24%24%24%24%26en%3D2%24%24%24%24%24%24#{to}%24%240%24%24%24%24%26pn%3D0%26rn%3D5%26sy%3D0&sc=0")},loadBaiduMapLib:function(b){if(window.BMap){b&&b()}else{$loadJs(["http://api.map.baidu.com/getscript?v=1.2","http://static1.mtime.cn/static/convertor.js"],function(){$loadCss("http://api.map.baidu.com/res/12/bmap.css",function(){b&&b()})})}},initialize:function(b){this.setOptions(b);this.mapRegion=$(this.mapRegion);if(this.mapRegion){this.initializeField();this.loadBaiduMapLib(function(){if(!this.initialized){this.initialized=true;this.initializeControl();this.initializeEvent();this.initializeCallback&&this.initializeCallback()}}.bind(this))}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){for(var d=0;d<10;++d){this.icons.push(new BMap.Icon(cssServer+"/images/2011/mapnum.png",new BMap.Size(23,34),{imageOffset:new BMap.Size(0-d*23,0)}))}var e=new BMap.Map(this.mapRegion);e.enableScrollWheelZoom();e.addControl(new BMap.NavigationControl());if(this.cityName){e.centerAndZoom(this.cityName,12)}else{var f=new BMap.Point(116.404,39.915);e.centerAndZoom(f,5)}this.map=e;this.markTheaters(this.theaters)},initializeField:function(){this.TheaterInfoWindows={};this.TheaterBaiduPoints={};this.icons=[]},initializeEvent:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyField:function(){},getTheaterInfoWindow:function(m,l){if(m){var j=null;j=this.TheaterInfoWindows[m.Id];if(!j){var g=[];if(m.HasOnlineTicket){g.push('<a href="'+m.ShowtimeUrl+'" target="_blank" class="i_btn_bs">购票</a>')}else{if(m.ShowtimeUrl){g.push('<a href="'+m.ShowtimeUrl+'" target="_blank" class="i_btn_bs">查影讯</a>')}}m._URLHTML=g.join("");var h=Builder.build(this.InfoWindowTemplate.evaluate(m));var k={width:400,height:0,title:"<h3>"+m.NameCn+"</h3>",offset:new BMap.Size(0,-15)};j=new BMap.InfoWindow(h,k);Event.observe(h,"click",function(b){var a=Event.findElement(b,"a");var e=null;if(a!=document&&(e=a.getAttribute("method"))){var r=h.down('a[method="to"]');var d=h.down('a[method="from"]');var s=h.down(".onbold").getAttribute("method");var f=h.down("input").value;switch(e){case"to":r.addClassName("onbold");d.removeClassName("onbold");break;case"from":d.addClassName("onbold");r.removeClassName("onbold");break;case"bt":if(f){var c,q;if(s=="to"){c=f;q=m.NameCn}else{c=m.NameCn;q=f}window.open(this.burl.evaluate({from:c,to:q}))}break;case"dt":if(f){var c,q;if(s=="to"){c=f;q=m.NameCn}else{c=m.NameCn;q=f}window.open(this.durl.evaluate({from:c,to:q}))}break;default:break}}}.bind(this));this.TheaterInfoWindows[m.Id]=j}return j}},pointConvert:function(h,f){var e=this.TheaterBaiduPoints[h.Id];if(e){f&&f(e)}else{var g=null;if(h.dulongitude!=0&&h.dulatitude!=0){g=new BMap.Point(h.dulongitude,h.dulatitude);this.TheaterBaiduPoints[h.Id]=g;f&&f(g)}else{g=new BMap.Point(h.Longitude,h.Latitude);BMap&&BMap.Convertor&&BMap.Convertor.translate(g,2,function(a){this.TheaterBaiduPoints[h.Id]=a;f&&f(a)}.bind(this))}}},markTheaters:function(f){if(this.map&&f){if(this.marked){this.unmarkTheaters()}var d=this.map;var e=[];f.each(function(b,a){this.pointConvert(b,function(k){var j=new BMap.Marker(k,{title:b.NameCn,icon:this.icons[a]}),c;d.addOverlay(j);if(this.showInfoWindow){c=this.getTheaterInfoWindow(b,k)}if(c||b.clickCallback){j.addEventListener("click",function(g){c&&this.openInfoWindow(c,k);b.clickCallback&&b.clickCallback(b)})}e.push(k);if(e.length==f.length){if(e.length>1){d.setViewport(e)}else{d.centerAndZoom(e[0],13);this.showInfoWindow&&this.openInfoWindow(f[0])}}}.bind(this))}.bind(this));this.marked=true}},unmarkTheaters:function(){this.map.clearOverlays();var b=this.map.getInfoWindow();b&&this.closeInfoWindow(b);this.TheaterInfoWindows={}},openInfoWindow:function(f){if(!this.map){return false}var d=this.TheaterInfoWindows[f.Id];if(d){var e=this.map;this.pointConvert(f,function(a){e.centerAndZoom(a,e.getZoom());e.openInfoWindow(d,a)})}}});var TheaterMapDialog=Class.create();Object.extend(TheaterMapDialog.prototype,{server:{getCinemaMap:function(d,c){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetCinemaMap",[d],c,"/Cinema.api","get","20000")}},options:{theater:{Id:1,NameCn:"首都电影院",Address:"首都电影地址",Telephone:"010-66086662",Longitude:116.379998,Latitude:39.9169,Rating:9.1,Roadline:""},contentTemplate:new Template('<div class="share_tiper"><div class="c_maptit"><div class="btn_close" _type="close"><a title="关闭" href="#" onclick="return false;"></a></div><div class="clearfix"><h3 class="fl yahei px24 normal lh10">#{NameCn}</h3><div class="point ml12 px14">#{RatingHTML}</div></div>#{RoadlineHTML}</div><div class="c_mapbox" _type="map"></div></div>')},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){if(this.theater.Rating>0){var c=Math.floor(this.theater.Rating);var d=this.theater.Rating-c;this.theater.RatingHTML=String.format('<span class="total">{0}</span><span class="total2">.{1}</span>',c,Math.round(d*10))}if(this.theater.Roadline){this.theater.RoadlineHTML='<p class="mt9 p_r lh18 zoom" style="padding-left:80px;"><strong class="px14" style="position:absolute; left:0; top:0;">乘车路线：</strong><span class="mr18">'+this.theater.Roadline+"</span></p>"}this.dialog=new TheaterCustomerDialog({content:this.contentTemplate.evaluate(this.theater),windowClassName:"share_tip",windowStyle:"width:960px;",readyCallback:this.dialogReadyCallback.bind(this)})},initializeDOM:function(){},initializeField:function(){},initializeEvent:function(){},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},dialogReadyCallback:function(g){var k=g.windowElement;var f=k.down('[_type="close"]');var j=k.down('[_type="map"]');var h=null;this.server.getCinemaMap(this.theater.Id,function(b){if(b&&b.value){var a={Id:this.theater.Id,EcouponUrl:b.value.EcouponUrl,HasOnlineTicket:b.value.HasOnlineTicket,Latitude:b.value.latidude,Longitude:b.value.longitude,dulatitude:b.value.dulatidude,dulongitude:b.value.dulongitude,NameCn:b.value.namecn,Rating:b.value.Rating,Roadline:b.value.Roadline,ShowtimeUrl:b.value.ShowtimeUrl,Telephone:b.value.telphone,Address:b.value.address};h=new TheaterMap({theaters:[a],mapRegion:j})}}.bind(this));k.style.zoom="1";Event.observe(f,"click",function(a){h&&h.close();g.close()})}});var TheaterCommentControl=Class.create();Object.extend(TheaterCommentControl.prototype,{server:{ratingComment:function(j,q,m,l,n,o,k,p){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","EditTheaterRatingAndComment",[j,q,m,l,n,o],k,"/Cinema.api","post","20000",p)}},options:{userInfo:null,cinemaId:0,cinemaName:"",container:null,callBack:null},initialize:function(b){this.setOptions(b);this.container=$(this.container);if(!this.container){return}this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeField:function(){this.serviceRating=0;this.effectRating=0},initializeDOM:function(){this.container=$(this.container);this.container.innerHTML=this.commentPannelRender();this.serviceRatingRegion=$("serviceRatingRegion");this.effectRatingRegion=$("effectRatingRegion");this.userRatingPrompt=$("userRatingPrompt");this.commentBox=$("commentBox");this.commentButton=$("commentButton");this.listContainer=$(this.listContainer)},destroyDOM:function(){this.container=null;this.serviceRatingRegion=null;this.effectRatingRegion=null;this.userRatingPrompt=null;this.commentBox=null;this.commentButton=null;this.listContainer=null},initializeControl:function(){if(this.serviceRatingRegion){this.serviceRatingControl=new Rating({menuRegion:this.serviceRatingRegion,readonly:false,onRatingCallback:this.onRatingServiceCallback.bind(this)})}if(this.effectRatingRegion){this.effectRatingControl=new Rating({menuRegion:this.effectRatingRegion,readonly:false,onRatingCallback:this.onRatingEffectCallback.bind(this)})}if(this.commentBox){this.tweetBox=new Textbox({text:"commentBox",watermarkText:"我要点评...",focusClassName:"",blurClassName:"c_a5"})}this.feedBack=new CinemaFeedback({editor:this.tweetBox,backgroundFeedback:{target:$("commentBox"),normalColor:"#FFF",warnColor:"#FD9999",start:-620,end:0},maxLength:500,digitFeedback:{target:$("textCountDown"),normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}})},initializeEvent:function(){if(this.commentButton){this.onClickCommentButtonHandler=this.onClickCommentButton.bindAsEventListener(this);this.commentButton.observe("click",this.onClickCommentButtonHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.commentButton){this.commentButton.stopObserving("click",this.onClickCommentButtonHandler)}},destroyControl:function(){},load:function(){},onClickCommentButton:function(){var d=this.tweetBox.getValue();var c=d.bytelength();if(c===0){this.feedBack.flickerWarn()}else{if(c<10){this.feedBack.flickerWarn();this.feedBack.digitFeedback.target.innerHTML='<span class="c_red">点评字数应不少于5个汉字</span>'}else{if(c<=1000){this.server.ratingComment(this.cinemaId,this.cinemaName,0,d,this.effectRating,this.serviceRating,function(a){if(a&&a.value){if(a.value.success){$alert("发布成功",function(){this.callBack&&this.callBack(a.value.commentId,d,this.serviceRating,this.effectRating,a.value.date)}.bind(this))}else{if(a.value.errcode=="NoLogin"){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}}else{if(a.value.errcode=="CidErr"){$alert("影院ID错误")}else{if(a.value.errcode=="WordsCountErr"){$alert("点评字数应不少于5个汉字不大于500个汉字")}else{$alert(a.value.errinfo)}}}}}else{$alert("网络异常")}}.bind(this),this.commentButton)}else{this.feedBack.flickerWarn()}}}},commentPannelRender:function(){var b=new StringBuilder();b.append('<div class="db_gradetool"><em class="db_radius"></em>');b.append('<div class="clearfix per_userbox movie_userbox">');b.append('<div class="per_usergrade">');b.append('<div class="load48" style="display: none;"></div>');b.append('<div class="per_userimg" style="">');if(this.userInfo!=null){if(!this.userInfo.isAnonymous){b.append(String.format('<a title="{0}" target="_blank" href="{1}"><img width="58" height="58" alt="{0}" src="{2}"></a>',this.userInfo.nickName,this.userInfo.homeUrl,this.userInfo.avatarUrl58));b.append(String.format('<p class=" mt6"><a target="_blank" href="{1}">{0}</a></p>',this.userInfo.nickName,this.userInfo.homeUrl))}else{b.append(String.format('<a title="{0}" target="_blank" href="#" onclick="return false;"><img width="58" height="58" alt="{0}" src="{1}"></a>',"匿名",this.userInfo.avatarUrl58));b.append(String.format('<p class="mt6"><a target="_blank" href="#" onclick="return false;">{0}</a></p>',"匿名"))}}b.append("</div>");b.append('<div class="mpscore currtextarea">');b.append('<div class="clearfix mdlr">');b.append('<div class="mdr">');b.append('<div class="per_totalarea01 clearfix">');b.append('<div class="per_tip">');b.append("<b>总体评价:</b>");b.append('<p id="userRatingPrompt" class="comboxuser" style="display:none;"><i class="face"></i><i class="v_b">值得一去</i></p>');b.append("</div>");b.append('<div class="clearfix ">');b.append('<span class="fl">服务质量</span>');b.append('<dl id="serviceRatingRegion" class="clearfix fl ">');b.append("</dl>");b.append("</div>");b.append('<div class="mt10 clearfix ">');b.append('<span class="fl">观影效果</span>');b.append('<dl id="effectRatingRegion" class="clearfix fl ">');b.append("</dl>");b.append("</div>");b.append("</div>");b.append("</div>");b.append("</div>");b.append('<div class="per_message">');b.append('<textarea id="commentBox" class="c_a5"></textarea>');b.append("</div>");b.append('<div class="per_btn">');b.append('<div class=" fr"> <span class=" c_fff px14" id="textCountDown"><span>0</span>/<strong>210</strong>字</span> <a id="commentButton" class="btn_dblue __r_c_" href="#" onclick="return false;">发表</a> </div>');b.append("</div>");b.append("</div>");b.append("</div>");b.append("</div>");b.append("</div>");return b.toString()},onRatingServiceCallback:function(b){if(this.checkLogin()){this.serviceRating=b;this.ratingDesRender()}},onRatingEffectCallback:function(b){if(this.checkLogin()){this.effectRating=b;this.ratingDesRender()}},ratingDesRender:function(){if(this.serviceRating>0||this.effectRating>0){this.totalRating=this.serviceRating+this.effectRating;var d;var c;switch(this.totalRating){case 1:case 2:case 3:case 4:d="有待改进";c="face face02";break;case 5:case 6:d="一般";c="face face01";break;default:d="值得一去";c="face";break}this.userRatingPrompt.down("i").className=c;this.userRatingPrompt.down("i.v_b").innerHTML=d;this.userRatingPrompt.show()}},checkLogin:function(){if(this.userInfo.isAnonymous){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return false}return true},getChineseCount:function(f){var g=f.split("");var j=g.length;var k=0;for(var h=0;h<j;++h){if(g[h].charCodeAt(0)<299){k+=0.5}else{k+=1}}return k},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var Rating=Class.create();Object.extend(Object.extend(Rating.prototype,MenuBase.prototype),{STAR_COUNT:5,initializeMenuDOM:function(){var f=new StringBuilder();for(var e=0,d=this.STAR_COUNT;e<d;e++){f.append('<dd class="off"><em></em></dd>')}this.menuRegion.innerHTML=f.toString();this.menuRegion=$(this.menuRegion);this.menus=this.menuRegion.immediateDescendants()},initializeMenu:function(){this._rating=this.rating;this.menuOn=null;this.menuIndex=-1;this.enableHandle=true},destroyMenu:function(){this.menuOn=null;this.menuIndex=null},render:function(){this.renderRating(this.rating)},setValue:function(b){this.rating=b;this.render()},hasChange:function(){if(this._rating!=this.rating){return true}return false},getValue:function(){return this.rating},onMenuOverCallback:function(e,d){if(!this.readonly&&this.enableHandle){var f=this.getRatingValue(d);this.renderRating(f);if(this.onOverRatingCallback){this.onOverRatingCallback(f)}}},onMenuOutCallback:function(d,c){this.renderRating(this.rating);if(this.onOutRatingCallback){this.onOutRatingCallback(this.rating)}},onClickMenuCallback:function(e,d){if(!this.readonly){if(this.enableHandle){var f=this.getRatingValue(d);this.rating=f;this.renderRating(f);if(this.onRatingCallback){this.onRatingCallback(f)}}else{}}},renderRating:function(k){var j=this.menus,m=null,l=0;for(var h=0,g=j.length;h<g;h++){m=j[h];l=h+1;if(l<=Math.ceil(k)){m.className=l<=k?"on":"half"}else{m.className="off"}}},getRatingValue:function(b){return b+1}});CinemaWidgets.Comment=Class.create();Object.extend(CinemaWidgets.Comment.prototype,Widgets.Base.prototype);Object.extend(CinemaWidgets.Comment.prototype,{options:{cinemaId:0,container:"",lengthExpMax:210,pageClient:null,type:"",commentTemplate:'<div class="mt6"><a method="submit" href="#" onclick="return false;" class="replaybtn">回复</a><p class="pt3 c_a5" _type="fd">还可以输入210字</p></div>',commentCollBackTemplate:'<div class="pic_32 mt20"><div class="mid_edit" replyid="{4}"><a method="editreply"><i class="i_edit"></i></a><a method="delreply"><i class="i_del"></i></a></div><a title="{0}" target="_blank" href="{1}"><img width="32" height="32" alt="{0}" src="{2}"></a><p class="px14"><a target="_blank" href="{1}">{0}</a><span class="pl25">刚刚</span></p><p class="mt6">{3}</p></div>',commentCollBackTemplate1:'<div class="pic_32 mt20"><a href="{0}" target="_blank" title="{1}"><img src="{2}" width="32" height="32" alt="{1}"></a><p class="px14"><a href="{0}" target="_blank">{1}</a><span class="pl25">{3}</span></p><p class="mt5 px12">{4}</p></div>'},server:{AddCinemaCommentReply:function(k,h,g,f,j){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","AddCinemaCommentReply",[k,h,g],f,"/Cinema.api","post","20000",j)}},initializeDom:function(){this.$contentRegion=$(this.container);this.editors=[]},initializeEvent:function(){this.clickRegionHandler=this.onClickRegion.bind(this);Event.observe(this.$contentRegion,"click",this.clickRegionHandler);Event.observe(window,"unload",this.close.bind(this))},onClickRegion:function(u){var s=Event.element(u);var w=s.readAttribute("method");while(!w&&s!=document.body){s=s.up();w=s.readAttribute("method")}if(!w){return}if(w=="replycount"){w="comment";s=s.up("div.ele_replay").down("textarea.c_a5");s.focus()}switch(w){case"comment":Event.stop(u);var E=s.readAttribute("toggle");if(typeof E==="undefined"||E!=="1"){s.setAttribute("toggle","1")}else{return}var G=s.up(".mod_short");this.tweetid=G.readAttribute("topicid");this.oldClickElementHtml=s.value;this.textarea=s;s.value="";s.style.height="60px";var y=s.up(".ele_replay");var A=s.up();A.style.height="60px";A.addClassName("focus");var x=Builder.build(this.commentTemplate);y&&y.appendChild(x);AutoHeight.startAuto(s);break;case"submit":Event.stop(u);var G=s.up(".mod_short");var F=G.readAttribute("topicid");var r=G.down('[region="newcomment"]');var D=s.up("div.ele_replay").down("textarea");var t=D.value.Trim();var C;var B;B=B?B.checked:false;var v=t.bytelength();if(v>0&&v<=this.lengthExpMax*2&&!/^发表评论.*:$/.test(t)){var z=null;if(/发表评论.*:/.test(t)){z=this.replyParentid}if(this.pageClient&&!this.pageClient.isLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}this.server.AddCinemaCommentReply(F,t,this.cinemaId,function(e){if(e&&e.value){if(e.value.success){if(!r){return}AutoHeight.stopAuto(D);var f;if(this.type===""){f=this.commentCollBackTemplate}else{if(this.type==="movie"){f=this.commentCollBackTemplate1}}var c=String.format(f,[e.value.nickName,e.value.homeUrl,e.value.avatarUrl32,t,e.value.replyId]);var a=r.getElementsBySelector("div.pic_32");var b=a.length-1;if(b>=0){var d=a[b].down("div.ele_replay");if(d){d.parentNode.removeChild(d)}}r.innerHTML+=c}else{$alert("回复失败")}}}.bind(this),s)}else{if(v==0||/^发表评论.*:$/.test(t)){$alert("你还没有填写内容，请填写后提交。",null,null,4)}else{$alert("内容过长,请确认内容字符长度不超过"+this.lengthExpMax+"。",null,null,4)}}break}}});var CinemaTopicEditDialog=Class.create();Object.extend(CinemaTopicEditDialog.prototype,{server:{editComment:function(h,o,l,k,m,n,j){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","EditTheaterRatingAndComment",[h,o,l,k,m,n],j,"/Cinema.api","post","20000")},editReply:function(e,h,g,f){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","EditReply",[e,h,g],f,"/Cinema.api","post","20000")}},options:{cinemaId:0,cinemaName:"",relatedId:0,relatedType:0,content:"",callBack:null,contentTemplate:'<div class="edittexra"><textarea _type="content" cols="" rows="" class="currtext">{0}</textarea><p _type="wordsCount">还可以输入<span>210</span>个字</p></div>'},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeControl:function(){this.dialog=new Dialog({title:"编辑我的留言",content:String.format(this.contentTemplate,this.content),containerClassName:"",containerStyle:"",buttons:[{title:"保存",buttonStyle:"btn_blue mr15",callback:function(b){if(this.relatedId>0){if(this.relatedType===86){this.doEditComment()}else{if(this.relatedType===87){this.doEditReply()}}}}.bind(this)}],readyCallback:this.dialogReadyCallback.bind(this)})},initializeDOM:function(){},initializeField:function(){},initializeEvent:function(){},doEditComment:function(){var d=this.tweetBox.getValue();var c=d.Trim().bytelength();if(c<10||c>1000){this.feedBack.flickerWarn()}else{this.server.editComment(this.cinemaId,this.cinemaName,this.relatedId,d,0,0,function(a){if(a&&a.value){if(a.value.success){this.dialog.close();this.callBack&&this.callBack(d)}else{$alert("编辑失败！")}}else{$alert("编辑失败！")}}.bind(this))}},doEditReply:function(){var d=this.tweetBox.getValue();var c=d.Trim().bytelength();if(c===0||c>420){this.feedBack.flickerWarn()}else{this.server.editReply(this.cinemaId,this.relatedId,d,function(a){if(a&&a.value){if(a.value.success){this.dialog.close();this.callBack&&this.callBack(d)}else{$alert("编辑失败！")}}else{$alert("编辑失败！")}}.bind(this))}},close:function(){if(!this.closed){this.destroy();this.closed=true}},destroy:function(){if(!this.destroyed){this.destroyEvent();this.destroyControl();this.destroyDOM();this.destroyField();this.destroyed=true}},destroyEvent:function(){},destroyControl:function(){},destroyDOM:function(){},destroyField:function(){},dialogReadyCallback:function(g){var h=g.windowElement;var f=h.down('[_type="content"]');var k=h.down('[_type="wordsCount"]');var j=500;if(this.relatedType===87){j=210}this.tweetBox=new Textbox({text:f,watermarkText:"我要点评...",focusClassName:"",blurClassName:"c_a5"});this.feedBack=new CinemaFeedback({editor:this.tweetBox,backgroundFeedback:{target:f,normalColor:"#FFF",warnColor:"#FD9999",start:-620,end:0},maxLength:j,digitFeedback:{target:k,normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}});h.style.zoom="1"}});var CinemaFeedback=Class.create();Object.extend(Object.extend(CinemaFeedback.prototype),{options:{editor:null,warnColor:"#FD9999",normalColor:"#FFF",maxLength:500},initialize:function(b){this.setOptions(b);this.initializeEvent();this.editor.feedback=this;this.flickering=false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeEvent:function(){this.editorLengthChangeInterval=setInterval(this.editorLengthChangeHandler.bind(this),200)},editorLengthChangeHandler:function(){var d=this.editor.getValue().bytelength();if(this.backgroundFeedback){var e=this.maxLength*2;var f=(this.backgroundFeedback.end-this.backgroundFeedback.start)/e;if(d==e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.normalColor,backgroundPosition:this.backgroundFeedback.end+"px 0"})}else{if(d>=0&&d<e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.normalColor,backgroundPosition:(d*f)+this.backgroundFeedback.start+"px 0"})}else{if(d>e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.warnColor,backgroundPosition:this.backgroundFeedback.start+"px 0"})}}}}if(this.digitFeedback){if(d>0||!this.flickered){this.flickered=false;if(d>=0&&d<=e){this.digitFeedback.target.innerHTML=String.format(this.digitFeedback.normalTemplate,[d/2,e/2,e-d])}else{this.digitFeedback.target.innerHTML=String.format(this.digitFeedback.warnTemplate,[d/2,e/2,e-d])}}}},flickerWarn:function(){if(!this.flickering){this.flickering=true;this.flickered=true;clearInterval(this.editorLengthChangeInterval);if(this.editor.getValue().length===0){this.digitFeedback.target.innerHTML='<span class="c_red">请输入内容</span>'}var b=function(a,e,f){if(this.backgroundFeedback){this.backgroundFeedback.target.setStyle({backgroundColor:a,backgroundPositionX:this.backgroundFeedback.start+"px"})}else{this.editor.editor.setStyle({backgroundColor:a})}if(e>0){FunctionExt.defer(f,200,this,[a==this.normalColor?this.warnColor:this.normalColor,--e,f])}else{if(!this.backgroundFeedback){this.editor.editor.setStyle({backgroundColor:""})}this.editorLengthChangeInterval=setInterval(this.editorLengthChangeHandler.bind(this),200);this.flickering=false}};FunctionExt.defer(b,200,this,[this.normalColor,4,b])}},destroyEvent:function(){clearInterval(this.editorLengthChangeInterval)},destroyField:function(){this.flickering=null;this.editorLengthChangeInterval=null;this.backgroundFeedback=null;this.digitFeedback=null}});var CinemaPageBaseClient=Mtime.Page.CinemaPageBaseClient;CinemaPageBaseClient=Class.create();Object.extend(CinemaPageBaseClient.prototype,{name:"CinemaPageBaseClient",options:{id:0,cinemaNameCn:"",type:33,feature:null,latidude:0,longitude:0,mapUrl:"",isLogin:false,signInUrl:"",hasFavorited:false,favoriteId:0},server:{GetExistShowtimesMovieIds:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetExistShowtimesMovieIds",[],b,"/Cinema.api","get","60000",null)},GetCinemaRating:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetCinemaRating",[d],c,"/Cinema.api","get","60000",null)}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeServerData();this.initializeDOM();this.initializeEvent();this.initializeControl();this.load()},initializeField:function(){},initializeServerData:function(){},initializeDOM:function(){this.cinemaImageslidesItems=$("cinemaImageslidesItems");this.cinemaImageClicks=$("cinemaImageClicks");this.cinemaImageAllBtn=$("cinemaImageAllBtn");this.cinemaImageShowroomBtn=$("cinemaImageShowroomBtn");this.cinemaImageSceneBtn=$("cinemaImageSceneBtn");this.cinemaImageEventBtn=$("cinemaImageEventBtn");this.cinemaImageOtherBtn=$("cinemaImageOtherBtn");this.btnMap=$("btnMap");this.commingSoonRegion=$("commingSoonRegion");this.loveRegion=$("rating");if(cinemaPromotionJson&&cinemaPromotionJson.length>0){var h=new StringBuilder();h.append('<div class="coupbox">');for(var j=0;j<cinemaPromotionJson.length;j++){var k=cinemaPromotionJson[j];if(k.ActivityType==3){continue}var g="coup_other";if(k.ActivityType==1){g="coup_mtime"}var m="###";var l="";if(k.PCURL){m=k.PCURL;l=' target="_blank"'}if(k.SourceID==3){h.append(String.format('<div class="{0} promotion" title="{1}"><a method="toggleAppPromTip" href="###">{2}<em>▼</em></a>',g,k.Description,k.TagName));h.append('<div class="coup_tip" style="display: none;">');h.append(String.format("<p>{0}</p>",k.Description));h.append(String.format('<p><img src="{0}" width="115" height="115"></p>',appQRcodeSrc));h.append("<p>扫一扫下载客户端</p>");h.append("</div></div> ")}else{h.append(String.format('<div class="{0} promotion" title="{1}"><a href="{2}"{3}>{4}</a></div> ',g,k.Description,m,l,k.TagName))}}h.append("</div>");this.promotionPanel=$("promotionPanel");this.promotionPanel.innerHTML=h.toString();this.promotionPanel.show()}},destroyDOM:function(){this.cinemaImageslidesItems=null;this.cinemaImageClicks=null;this.cinemaImageAllBtn=null;this.cinemaImageShowroomBtn=null;this.cinemaImageSceneBtn=null;this.cinemaImageEventBtn=null;this.cinemaImageOtherBtn=null;this.btnMap=null;this.commingSoonRegion=null;this.loveRegion=null;this.promotionPanel=null},initializeEvent:function(){if(this.cinemaImageAllBtn){this.onClickCinemaImageAllBtnHandler=this.onClickCinemaImageAllBtn.bindAsEventListener(this);this.cinemaImageAllBtn.observe("click",this.onClickCinemaImageAllBtnHandler)}if(this.cinemaImageShowroomBtn){this.onClickCinemaImageShowroomBtnHandler=this.onClickCinemaImageShowroomBtnBtn.bindAsEventListener(this);this.cinemaImageShowroomBtn.observe("click",this.onClickCinemaImageShowroomBtnHandler)}if(this.cinemaImageSceneBtn){this.onClickCinemaImageSceneBtnHandler=this.onClickCinemaImageSceneBtn.bindAsEventListener(this);this.cinemaImageSceneBtn.observe("click",this.onClickCinemaImageSceneBtnHandler)}if(this.cinemaImageEventBtn){this.onClickCinemaImageEventBtnHandler=this.onClickCinemaImageEventBtn.bindAsEventListener(this);this.cinemaImageEventBtn.observe("click",this.onClickCinemaImageEventBtnHandler)}if(this.cinemaImageOtherBtn){this.onClickCinemaImageOtherBtnHandler=this.onClickCinemaImageOtherBtn.bindAsEventListener(this);this.cinemaImageOtherBtn.observe("click",this.onClickCinemaImageOtherBtnHandler)}if(this.cinemaImageslidesItems){this.onClickCinemaImageslidesItemsHandler=this.onClickCinemaImageslidesItems.bindAsEventListener(this);this.cinemaImageslidesItems.observe("click",this.onClickCinemaImageslidesItemsHandler)}if(this.btnMap){this.onBtnMapClickHandler=this.onBtnMapClick.bindAsEventListener(this);this.btnMap.observe("click",this.onBtnMapClickHandler)}this.onClickCinemaRegionHandler=this.onClickPromotionPanel.bind(this);this.promotionPanel&&Event.observe(this.promotionPanel,"click",this.onClickCinemaRegionHandler);Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.cinemaImageAllBtn){this.cinemaImageAllBtn.stopObserving("click",this.onClickCinemaImageAllBtnHandler)}if(this.cinemaImageShowroomBtn){this.cinemaImageShowroomBtn.stopObserving("click",this.onClickCinemaImageShowroomBtnHandler)}if(this.cinemaImageSceneBtn){this.cinemaImageSceneBtn.stopObserving("click",this.onClickCinemaImageSceneBtnHandler)}if(this.cinemaImageEventBtn){this.cinemaImageEventBtn.stopObserving("click",this.onClickCinemaImageEventBtnHandler)}if(this.cinemaImageOtherBtn){this.cinemaImageOtherBtn.stopObserving("click",this.onClickCinemaImageOtherBtnHandler)}if(this.cinemaImageslidesItems){this.cinemaImageslidesItems.stopObserving("click",this.onClickCinemaImageslidesItemsHandler)}if(this.btnMap){Event.stopObserving(this.btnMap,"click",this.onBtnMapClickHandler)}this.promotionPanel&&Event.stopObserving(this.promotionPanel,"click",this.onClickCinemaRegionHandler)},initializeControl:function(){if(this.cinemaImageslidesItems){this.cinemaImageSlidesControl=new CinemaWidgets.SlidesControl({slidesRegion:"cinemaImageslidesItems",prev:"cinemaImagePrev",next:"cinemaImageNext",slidesRegionWidth:1000})}},initializeFeature:function(){},destroyControl:function(){if(this.cinemaImageSlidesControl){this.cinemaImageSlidesControl.close()}},load:function(){stat.viewTheater(this.id);this.initMethod();if(this.latidude>0&&this.longitude>0){}this.GetCinemaRatingByCinemaId();this.callOutVideoControl();this.GetExistShowtimesMovieIds()},GetCinemaRatingByCinemaId:function(){if(typeof cinemabasicjson!="undefined"&&cinemabasicjson.id>0){this.server.GetCinemaRating(cinemabasicjson.id,function(b){if(b&&b.value){if(b.value.ratingInt>0){if(this.loveRegion){this.loveRegion.down("div").addClassName(b.value.loveCss);this.loveRegion.down("div").down("i").innerHTML=b.value.ratingInt+"<em>%</em>"}}else{if(this.loveRegion){this.loveRegion.up("li").previous("li").down("p").show()}}}else{if(this.loveRegion){this.loveRegion.up("li").previous("li").down("p").show()}}}.bind(this))}},GetExistShowtimesMovieIds:function(){if(this.commingSoonRegion){this.server.GetExistShowtimesMovieIds(function(b){if(b&&b.value){this.commingSoonRegion.getElementsBySelector('div[data-selector="presellitem"]').each(function(a){var d=this.IsContainMovieId(b.value,a.readAttribute("_movieid"));if(d){a.down("a").setAttribute("href",d);a.show()}else{a.hide()}}.bind(this))}}.bind(this))}},callOutVideoControl:function(){if(typeof this.commingMovieVideoControl=="undefined"&&typeof this.commingSoonRegion!="undefined"){this.commingMovieVideoControl=new Widgets.CallOutVideo({slidesRegion:this.commingSoonRegion})}},IsContainMovieId:function(e,h){if(e){for(var f in e){var g=e[f];if(g.movieid==h){return g.showtimepage}}}},initMethod:function(){var e=location.search;if(e){var f;try{f=$H(e.parseQuery())}catch(d){f=$H()}if(f.initMethod){switch(f.initMethod){case"openMap":this.onBtnMapClick();break}}}},onBtnMapClick:function(b){if(typeof cinemabasicjson!="undefined"){new TheaterMapDialog({theater:{Id:cinemabasicjson.id,NameCn:cinemabasicjson.namecn,Rating:cinemabasicjson.rating,Roadline:cinemabasicjson.roadline}})}},onClickCinemaImageAllBtn:function(b){this.selectedLiClass(b);this.cinemaImageslidesItems.getElementsBySelector("li").each(function(a){$(a).show()});this.cinemaImageSlidesControl.reset()},onClickCinemaImageShowroomBtnBtn:function(b){if(!this.selectedLiClass(b)){return}this.imageTypeChange(2);this.cinemaImageSlidesControl.reset()},onClickCinemaImageSceneBtn:function(b){if(!this.selectedLiClass(b)){return}this.imageTypeChange(1);this.cinemaImageSlidesControl.reset()},onClickCinemaImageEventBtn:function(b){if(!this.selectedLiClass(b)){return}this.imageTypeChange(3);this.cinemaImageSlidesControl.reset()},onClickCinemaImageOtherBtn:function(b){if(!this.selectedLiClass(b)){return}this.imageTypeChange(4);this.cinemaImageSlidesControl.reset()},onClickCinemaImageslidesItems:function(e){var d=Event.findElement(e,"li");if(d){var f=d.getAttribute("picurl");if(f&&f!==""){new Widgets.Artwork({isLoader:true,imgUrl:f})}}},onClickPromotionPanel:function(e){var d=Event.element(e);var f=d.readAttribute("method");while(!f&&d!=document.body){d=d.up();f=d.readAttribute("method")}if(!f){return}switch(f){case"toggleAppPromTip":this.toggleAppPromTip(d);break;default:break}},selectedLiClass:function(e){var d=Event.findElement(e,"a");if(d&&this.cinemaImageClicks){var f=Number(d.down("b").innerHTML);if(f<=0){return false}this.cinemaImageClicks.getElementsBySelector("li").each(function(a){var b=$(a);if(b.hasClassName("curr")){b.removeClassName("curr")}});d.parentNode.addClassName("curr")}return true},imageTypeChange:function(b){if(this.cinemaImageslidesItems){this.cinemaImageslidesItems.getElementsBySelector("li").each(function(a){var f=$(a);var e=f.getAttribute("type");if(e==b){f.show()}else{f.hide()}})}},toggleAppPromTip:function(f){if(typeof f!="undefined"){var e=f.next(".coup_tip");var d=f.down("em");if((typeof e)=="undefined"){return}if(d.innerHTML=="▼"){d.innerHTML="▲";e.show()}else{d.innerHTML="▼";e.hide()}}},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM()}});var Feedback=Class.create();Object.extend(Object.extend(Feedback.prototype),{options:{editor:null,warnColor:"#FD9999",normalColor:"#FFF",maxLength:210},initialize:function(b){this.setOptions(b);this.initializeEvent();this.editor.feedback=this;this.flickering=false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeEvent:function(){this.editorLengthChangeInterval=setInterval(this.editorLengthChangeHandler.bind(this),200)},editorLengthChangeHandler:function(){var d=this.editor.getValue().length;if(this.backgroundFeedback){var e=this.maxLength;var f=(this.backgroundFeedback.end-this.backgroundFeedback.start)/e;if(d==e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.normalColor,backgroundPosition:this.backgroundFeedback.end+"px 0"})}else{if(d>=0&&d<e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.normalColor,backgroundPosition:(d*f)+this.backgroundFeedback.start+"px 0"})}else{if(d>e){this.backgroundFeedback.target.setStyle({backgroundColor:this.backgroundFeedback.warnColor,backgroundPosition:this.backgroundFeedback.start+"px 0"})}}}}if(this.digitFeedback){if(d>0||!this.flickered){this.flickered=false;if(d>=0&&d<=e){this.digitFeedback.target.innerHTML=String.format(this.digitFeedback.normalTemplate,[d,e,e-d])}else{this.digitFeedback.target.innerHTML=String.format(this.digitFeedback.warnTemplate,[d,e,e-d])}}}},flickerWarn:function(){if(!this.flickering){this.flickering=true;this.flickered=true;clearInterval(this.editorLengthChangeInterval);if(this.editor.getValue().length===0){this.digitFeedback.target.innerHTML='<span class="c_red">请输入内容</span>'}var b=function(a,e,f){if(this.backgroundFeedback){this.backgroundFeedback.target.setStyle({backgroundColor:a,backgroundPositionX:this.backgroundFeedback.start+"px"})}else{this.editor.editor.setStyle({backgroundColor:a})}if(e>0){FunctionExt.defer(f,200,this,[a==this.normalColor?this.warnColor:this.normalColor,--e,f])}else{if(!this.backgroundFeedback){this.editor.editor.setStyle({backgroundColor:""})}this.editorLengthChangeInterval=setInterval(this.editorLengthChangeHandler.bind(this),200);this.flickering=false}};FunctionExt.defer(b,200,this,[this.normalColor,4,b])}},destroyEvent:function(){clearInterval(this.editorLengthChangeInterval)},destroyField:function(){this.flickering=null;this.editorLengthChangeInterval=null;this.backgroundFeedback=null;this.digitFeedback=null}});var ToolBannerShareControlManager;var siteCommunityServiceUrl=siteCommunityServiceUrl||"http://service.community.mtime.com";var RightFloatToolsControl=Class.create();Object.extend(RightFloatToolsControl.prototype,{options:{editorComment:"",hasSearchButton:true,hasShareButton:true,hasFavoriteButton:true,hasMessageButton:true,hasCodeButton:true,hasTopButton:true,conversionUrl:"",shareRelatedObjType:"",relatedId:0,expandId:0,autoLoad:"",screenshotImageUrl:"",movieTitle:"",cityName:"",imageUrl:"",imagePath:"",link:"",videoId:0,title:"",fullTitle:"",pic:"",desc:"",expandMovieId:0,date:new Date(),isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,hasFavorited:false,codeTemplate:'<dl><dt><img src="#{codeUrl}" width="115" height="115"></dt><dd><p>扫描二维码</p><p>手机浏览页面</p></dd></dl>'},server:{getFavoriteCategorys:function(h,g,f,e){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetFavoriteCategorys2",[h,g,f],e,"/community.api?Ajax_CallBack=true","post","20000")}}},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){this.scrolltop=0;this.addDOM();this.rightFloatControls=this.rightFloatControl.immediateDescendants();this.topbar=$("topbar");this.isSearch=true},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}this.onClickBodyHandler=this.onClickBody.bind(this);Event.observe(document.body,"click",this.onClickBodyHandler);Event.observe(window,"unload",this.close.bind(this));this.setIntervalTimer()},load:function(){if(this.hasFavoriteButton){this.server.getFavoriteCategorys(this.relatedObjType,this.relatedObjId,true,function(b){if(b&&b.value){if(b.value.isLogin&&b.value.hasFavorited&&this.favoritebar){this.favoritebar.addClassName("curron");this.favoritebar.title="已收藏"}}}.bind(this))}},addDOM:function(){this.showButtonMethod(this.rightFloatControls);this.rightFloatControl=Builder.node("div",{className:"mtimebar"},[this.searchbar,this.sharebar,this.favoritebar,this.messagebar,this.codebar,this.tooltopbar,this.sharebox,this.favoritbox,this.codebox]);document.body.appendChild(this.rightFloatControl)},showButtonMethod:function(){if(!this.hasSearchButton){this.searchbar=$(Builder.node("div",{className:"searchbar",title:"搜索",style:"display:none"}))}else{this.searchbar=$(Builder.node("div",{className:"searchbar",title:"搜索",method:"search",style:"display:none"},[Builder.node("b",{className:"baron",method:"search"},["搜索"])]))}if(!this.hasShareButton){this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",style:"display:none"}))}else{this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",method:"share"},[Builder.node("b",{className:"baron",method:"share"},["分享"])]))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",method:"favorite"},[Builder.node("b",{className:"baron",method:"favorite"},["收藏"])]))}if(!this.hasMessageButton){this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",style:"display:none"}))}else{this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",method:"message"},[Builder.node("b",{className:"baron",method:"message"},["留言"])]))}if(!this.hasCodeButton){this.codebar=$(Builder.node("div",{className:"codebar",title:"二维码",style:"display:none"}))}else{this.codebar=$(Builder.node("div",{className:"codebar",title:"二维码",method:"code"},[Builder.node("b",{className:"baron",method:"code"},["二维码"])]))}if(!this.hasTopButton){this.tooltopbar=$(Builder.node("div",{className:"topbar",title:"返回顶部",style:"display:none"}))}else{this.tooltopbar=$(Builder.node("div",{className:"topbar",title:"返回顶部",method:"backtop",style:"visibility:hidden"},[Builder.node("b",{className:"baron",method:"backtop"},["返回顶部"])]))}this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}));this.codebox=$(Builder.node("div",{className:"codebox",style:"display:none;"}));nullDiv=null},onClickBody:function(e){var d=Event.element(e);var f=d.up(".mtimebar");if(f!==this.rightFloatControl){this.removeClassName()}},onClickRigtFloat:function(h){this.clickElement=Event.element(h);var k=this.clickElement.readAttribute("method");if(!this.clickElement||this.clickElement===document.body){return}switch(k){case"search":this.removeClassName();if(this.topbar){if(this.isSearch){this.isSearch=false;var j=this.topbar.down(".headbar");if(j){this.calloutNewSearch()}else{this.calloutOldSearch()}}else{this.topbarAnimate()}}break;case"share":this.removeClassName();if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}this.sharebar.addClassName("curr");this.sharebox.show();break;case"favorite":this.removeClassName();if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break;case"message":this.removeClassName();if($(this.editorComment)){var g=$(this.editorComment);var f=$("commentRegion");if(f){f.scrollTo()}else{g.scrollTo()}g.focus();g=null}break;case"code":if(this.codebar.hasClassName("curr")){this.removeClassName()}else{this.removeClassName();this.setClassName();this.builderCodeMethod()}break;case"backtop":this.removeClassName();document.body.scrollIntoView();break}k=null},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,relatedId:this.relatedId,expandId:this.expandId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.sharebar,expandMovieId:this.expandMovieId,shareContainer:this.sharebox,callback:this.removeClassName.bind(this)}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControl({shareRelatedObjType:this.shareRelatedObjType,isLogin:this.isLogin,signInUrl:this.signInUrl,relatedObjId:this.relatedObjId,relatedObjType:this.relatedObjType,hasFavorited:this.hasFavorited,favoriteButton:this.favoritebar,favoriteContainer:this.favoritbox,callback:this.removeClassName.bind(this)})}},builderCodeMethod:function(){var h,j={},m=new Template(this.codeTemplate),g=new StringBuilder(),l="";if(this.conversionUrl!==""){l=encodeURIComponent(this.conversionUrl)}else{if(getNewValue){l=encodeURIComponent(getNewValue(location.href))}else{l=encodeURIComponent(location.href)}}j.codeUrl=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+l;h=m.evaluate(j);var k=Builder.build(h);this.codebox.appendChild(k);this.codebox.show()},setClassName:function(){for(var b=0;b<=5;b++){if(this.rightFloatControls[b]!==this.clickElement){this.rightFloatControls[b].addClassName("notcurr")}else{this.rightFloatControls[b].addClassName("curr")}}},removeClassName:function(e){var f,g=9,h=9;if(e){if(e===this.sharebar){g=1;h=6}else{if(e===this.favoritebar){g=2;h=7}}}for(f=0;f<=5;f++){if(g!==f){if(this.rightFloatControls[f].hasClassName("notcurr")){this.rightFloatControls[f].removeClassName("notcurr")}if(this.rightFloatControls[f].hasClassName("curr")){this.rightFloatControls[f].removeClassName("curr")}}}for(f=6;f<=8;f++){if(h!==f){this.rightFloatControls[f].hide()}}this.codebox.innerHTML="";f=g=h=null},setIntervalTimer:function(){var c,d;d=document.documentElement.scrollTop||document.body.scrollTop;if(this.scrolltop!==d&&this.topbar&&this.lockTopBar){this.topbarAnimate()}if(d<200){if(this.searchbar){this.searchbar.hide()}if(this.tooltopbar){this.tooltopbar.style.visibility="hidden"}}else{if(this.searchbar&&this.hasSearchButton===true){this.searchbar.show()}if(this.tooltopbar){this.tooltopbar.style.visibility="visible"}}c=d=null;this.myTimer=setTimeout(function(){this.setIntervalTimer()}.bind(this),2000)},calloutOldSearch:function(){this.topbar.addClassName("scrolltop");this.topbarHeight=this.topbar.getHeight();var h=this.topbar.down(".menubg");this.topbarHeight+=h.getHeight();this.topbar.style.top=-this.topbarHeight+"px";var f=this.topbar.down(".bartop");var g=0;if(f){g=f.getHeight()}var j=this.topbar.down(".topline");if(!j){j=this.topbar.down(".bartop")}var k=j.getHeight()+g;document.body.style.paddingTop=k+"px";this.topbar.addClassName("transition6");FunctionExt.defer(function(){this.topbar.style.position="fixed";this.topbar.style.top="0px";h=j=k=f=g=null;this.scrolltop=document.documentElement.scrollTop||document.body.scrollTop;this.lockTopBar=true},200,this)},calloutNewSearch:function(){this.headbarInTopbar=this.topbar.down(".headbar");if(this.headbarInTopbar.hasClassName("head-mini")){this.headbarMini=true}else{this.headbarMini=false}var m=this.headbarInTopbar.down("div#searchbox").down("em");var o=this.headbarInTopbar.down("h1");var k=m.up("div.headtool");var p=k.down("div.headsearch");var q=p.down("input.text");var n=Position.page(o)[0];var l=Position.page(k)[0];var j=l-n;m.removeClassName("zoom");m.addClassName("cancel");m.title="取消";o.hide();p.show();if(n){$(p).setStyle({width:j+"px"})}this.headbarHeight=this.headbarInTopbar.getHeight();if(this.headbarMini==true){this.topbar.style.top=-this.headbarHeight+"px";this.topbar.addClassName("transition6")}FunctionExt.defer(function(){if(this.headbarMini==true){this.topbar.addClassName("fixed");this.topbar.style.top="0px";document.body.style.paddingTop=this.headbarHeight+"px"}q&&q.focus();this.scrolltop=document.documentElement.scrollTop||document.body.scrollTop;this.lockTopBar=true},200,this)},topbarAnimate:function(){var b=this.topbar.down(".headbar");if(b){if(this.headbarMini===true){this.topbar.style.top=-this.headbarHeight+"px"}FunctionExt.defer(function(){if(this.headbarMini===true){this.topbar.removeClassName("transition6");this.topbar.removeClassName("fixed");this.topbar.style.top="";document.body.style.paddingTop=""}this.lockTopBar=false;this.isSearch=true},600,this)}else{this.topbar.style.top=-this.topbarHeight+"px";FunctionExt.defer(function(){this.topbar.removeClassName("transition6");this.topbar.removeClassName("scrolltop");this.topbar.style.top="0px";this.topbar.style.position="";document.body.style.paddingTop="";this.lockTopBar=false;this.isSearch=true},600,this)}},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){if(this.rightFloatControl){Event.stopObserving(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.stopObserving(document.body,"click",this.onClickBodyHandler)},destroyDOM:function(){this.rightFloatControl=null;this.myTimer&&clearTimeout(this.myTimer);this.myTimer=null}});var CrosswiseTools=Class.create();Object.extend(CrosswiseTools.prototype,RightFloatToolsControl.prototype);Object.extend(CrosswiseTools.prototype,{options:{slidesRegion:"",slidesRegionEl:null,editorComment:"",editorUrl:"",hasShareButton:true,hasFavoriteButton:true,expandMovieId:0,shareRelatedObjType:"",relatedId:0,expandId:0,autoLoad:"",screenshotImageUrl:"",movieTitle:"",cityName:"",imageUrl:"",imagePath:"",link:"",videoId:0,title:"",fullTitle:"",pic:"",desc:"",shareSuccessCallBack:null,date:new Date(),isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,hasFavorited:false},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.observe(window,"unload",this.close.bind(this))},load:function(){},addDOM:function(){this.slidesRegion=$(this.slidesRegion);if(!this.slidesRegion&&this.slidesRegionEl){this.slidesRegion=this.slidesRegionEl}this.showButtonMethod(this.rightFloatControls);this.rightFloatControl=$(Builder.node("div",{className:"smtimebar"},[this.sharebar,this.favoritebar,this.messagebar,this.sharebox,this.favoritbox]));if(this.slidesRegion){this.slidesRegion.appendChild(this.rightFloatControl)}},showButtonMethod:function(){var d=$(Builder.node("div",{style:"display:none"}));if(!this.hasShareButton){this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",style:"display:none"}))}else{this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",method:"share"},[Builder.node("b",{className:"baron",method:"share"},["分享"])]))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",method:"favorite"},[Builder.node("b",{className:"baron",method:"favorite"},["收藏"])]))}if(!this.editorUrl){this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",style:"display:none"}))}else{var c=this.editorComment===""?this.editorUrl:this.editorUrl+"#"+this.editorComment;this.messagebar=Builder.node("div",{className:"messagebar",title:"留言"},[Builder.node("a",{className:"baron",href:c,target:"_blank"},["留言"])]);c=null}this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}));d=null},onClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}var d=this.clickElement.readAttribute("method");switch(d){case"share":this.removeClassName();if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}this.sharebar.addClassName("curr");this.sharebox.show();break;case"favorite":this.removeClassName();if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break}},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,expandId:this.expandId,relatedId:this.relatedId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.sharebar,shareContainer:this.sharebox,expandMovieId:this.expandMovieId,shareControlStyleType:2,callback:this.removeClassName.bind(this),shareSuccessCallBack:this.shareSuccessCallBack}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControl({shareRelatedObjType:this.shareRelatedObjType,isLogin:this.isLogin,signInUrl:this.signInUrl,relatedObjId:this.relatedObjId,relatedObjType:this.relatedObjType,hasFavorited:this.hasFavorited,favoriteButton:this.favoritebar,favoriteContainer:this.favoritbox,favoriteControlStyleType:2,callback:this.removeClassName.bind(this)})}},setClassName:function(){},removeClassName:function(b){num1=9,num2=9;if(b){if(b===this.sharebar){num1=0;num2=3}else{if(b===this.favoritebar){num1=1;num2=4}}}for(i=0;i<3;i++){if(num1!==i){if(this.rightFloatControls[i].hasClassName("notcurr")){this.rightFloatControls[i].removeClassName("notcurr")}if(this.rightFloatControls[i].hasClassName("curr")){this.rightFloatControls[i].removeClassName("curr")}}}for(i=3;i<5;i++){if(num2!==i){this.rightFloatControls[i].hide()}}}});var ProductTools=Class.create();Object.extend(ProductTools.prototype,CrosswiseTools.prototype);Object.extend(ProductTools.prototype,{options:{slidesRegion:"",hasShareButton:true,hasFavoriteButton:true,hasCodeButton:true,slidesRegionEl:null,shareRelatedObjType:"",relatedId:0,link:"",title:"",pic:"",goodsId:0,pageName:"",sharePan:"",favoritePan:"",codePan:""},hasIsLogin:function(f,e,d){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","HasIsLogin",[f,e],d,"/community.api?Ajax_CallBack=true","post","20000")}},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.observe(window,"unload",this.close.bind(this));this.onClickBodyHandler=this.onClickBody.bind(this);Event.observe(document.body,"click",this.onClickBodyHandler)},load:function(){if(this.hasFavoriteButton){this.hasIsLogin(this.goodsId,true,function(b){if(b&&b.value){if(b.value.isLogin&&b.value.hasFavorited&&this.favoritebar){this.favoritebar.addClassName("on");this.favoritebar.title="已收藏"}}}.bind(this))}if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}},onClickBody:function(b){this.bodyClickRigtFloat(b)},addDOM:function(){this.slidesRegion=$(this.slidesRegion);if(!this.slidesRegion&&this.slidesRegionEl){this.slidesRegion=this.slidesRegionEl}this.showButtonMethod();this.rightFloatControl=$(Builder.node("dl",{},[this.codebar,this.favoritebar,this.sharebar,this.favoritbox]));if(this.slidesRegion){this.slidesRegion.appendChild(this.rightFloatControl)}},trackClick:function(b){if(typeof tracker!="undefined"){tracker.trackClick(this.pageName,b)}},showButtonMethod:function(){this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.shareBtn=$(Builder.node("a",{className:"s_share",title:"分享"},[Builder.node("b",{className:"baron",method:"share"},["分享"]),Builder.node("i")]));if(!this.hasShareButton){this.sharebar=$(Builder.node("dd",{style:"display:none"}))}else{this.sharebar=$(Builder.node("dd",{method:"share"},[this.shareBtn,this.sharebox]))}if(this.sharePan!=""){Event.observe(this.sharebar,"click",function(){this.trackClick(this.sharePan)}.bind(this))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("dd",{className:"",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("dd",{className:"",title:"收藏",method:"favorite"}));new Insertion.Bottom(this.favoritebar,'<a method="favorite" href="javascript:void(0)" class="s_fav" title="收藏"><i method="favorite"></i></a>')}if(this.favoritePan!=""){Event.observe(this.favoritebar,"click",function(){this.trackClick(this.favoritePan)}.bind(this))}if(!this.hasCodeButton){this.codebar=$(Builder.node("dd",{title:"二维码",style:"display:none"}))}else{this.codebar=$(Builder.node("dd",{title:"二维码",method:"code"}));new Insertion.Bottom(this.codebar,'<a method="code" href="javascript:void(0)" class="s_code" title="二维码"><b method="code">二维码</b><i method="code"></i></a><div style="display: none" class="codebox"><p class="codeImgBox_"></p><p class="mt9">扫描二维码<br />手机浏览页面</p></div>')}if(this.codePan!=""){Event.observe(this.codebar,"click",function(){this.trackClick(this.codePan)}.bind(this))}this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}))},onClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}if(this.clickElement.previous("b")&&this.clickElement.previous("b").hasAttribute("method")){this.clickElement=this.clickElement.previous("b")}var d=this.clickElement.readAttribute("method");switch(d){case"share":break;case"favorite":if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadSubJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break;case"code":if(this.codebar.hasClassName("on")){this.closeCode()}else{this.codebar.addClassName("on");this.builderCodeNode(this.codebar.down(".codeImgBox_"))}break}},closeCode:function(){this.codebar.removeClassName("on");this.codebar.down(".codebox").hide()},closeShare:function(){this.sharebar.removeClassName("on");this.sharebar.down(".sharebox").hide()},bodyClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}var d=this.clickElement.readAttribute("method");switch(d){case"share":this.closeCode();break;case"favorite":this.closeCode();this.closeShare();break;case"code":this.closeShare();break;default:this.closeCode();this.closeShare();break}},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,expandId:this.expandId,relatedId:this.relatedId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.shareBtn,shareContainer:this.sharebox,expandMovieId:this.expandMovieId,callback:this.removeClassName.bind(this),shareSuccessCallBack:this.shareSuccessCallBack}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControlSCM({goodsId:this.goodsId,favoriteButton:this.favoritebar})}else{this.favoriteButtonControl.clickFavorite()}},builderCodeNode:function(e){var d="",f="";this.conversionUrl=this.link;if(this.conversionUrl!==""){f=encodeURIComponent(this.conversionUrl)}else{if(getNewValue){f=encodeURIComponent(getNewValue(location.href))}else{f=encodeURIComponent(location.href)}}d=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+f;e.innerHTML='<img class="codeImg" src="'+d+'" width="110" height="110" alt="二维码" />';this.codebar.down(".codebox").show()},removeClassName:function(b){this.closeCode()}});var IndexShareToolsControl=Class.create();Object.extend(IndexShareToolsControl.prototype,{name:"IndexShareToolsControl",initialize:function(){this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.ShareContrainerList=$$(".i_share")},destroyDOM:function(){this.ShareContrainerList=null},initializeControl:function(){this.rightCtrl=new RightFloatToolsControl({hasShareButton:false,hasFavoriteButton:false,hasMessageButton:false,hasCodeButton:false})},destroyControl:function(){if(this.ShareControlList){this.ShareControlList.each(function(b){b.close();b=null})}},initializeEvent:function(){},destroyEvent:function(){},load:function(){if(this.ShareContrainerList){var b=siteMcUrl+"/member/signin";this.ShareControlList=[];this.ShareContrainerList.each(function(z){var w=0;var D=z.readAttribute("method");switch(D){case"newsimgshare":var F=z.readAttribute("newsid");var I=z.readAttribute("newstitle");var H=z.readAttribute("newslink");var L=z.readAttribute("pic");var x="[今日时光网头条精选]："+I;var G=new CrosswiseTools({shareRelatedObjType:9981,slidesRegionEl:z,link:H,title:I,fullTitle:x,pic:L,isLogin:false,signInUrl:b,relatedId:F,relatedObjId:F,relatedObjType:51,hasFavorited:false});this.ShareControlList.push(G);break;case"hotplayimgshare":var E=z.readAttribute("movieid");var y=new CrosswiseTools({slidesRegionEl:z,shareRelatedObjType:1111,relatedId:E,isLogin:false,signInUrl:b,relatedObjId:E,relatedObjType:1,hasFavorited:false});this.ShareControlList.push(y);break;case"communityimgshare":var K=z.readAttribute("objtype");var J=z.readAttribute("objid");var M;var A=true;switch(K){case"9991":M=6;w=1;break;case"7001":M=10;break;case"6001":M=6;break;case"2201":M=22;A=false;break;default:return}var v=new CrosswiseTools({slidesRegionEl:z,shareRelatedObjType:K,relatedId:J,isLogin:false,signInUrl:b,relatedObjId:J,relatedObjType:M,hasFavorited:false,expandId:w,hasFavoriteButton:A});this.ShareControlList.push(v);break;case"communitycommentshare":var K=z.readAttribute("objtype");var J=z.readAttribute("objid");var C="";if(z.hasAttribute("title")){C=z.readAttribute("title")}var B="";if(z.hasAttribute("link")){B=z.readAttribute("link")}var M;var A=true;switch(K){case"9991":M=6;w=1;break;case"9992":M=78;break;case"9993":M=78;break;case"6001":M=6;break;case"7001":M=10;break;case"2201":M=22;A=false;break;case"6401":M=78;default:return}var a=new CrosswiseTools({slidesRegionEl:z,link:B,title:C,shareRelatedObjType:K,relatedId:J,isLogin:false,signInUrl:b,relatedObjId:J,relatedObjType:M,hasFavorited:false,expandId:w,hasFavoriteButton:A});this.ShareControlList.push(a);break}}.bind(this))}},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var movieDictionary=[{key:"http://movie.mtime.com/(\\d+)/reviews/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/review/detail/{1}/",isAppendGreedyValue:false},{key:"http://movie.mtime.com/(\\d+)/posters_and_images/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/movie/{0}/posters_and_images/{1}{2}/",isAppendGreedyValue:true},{key:"http://movie.mtime.com/(\\d+)/posters_and_images[\\w\\W*?]",value:"http://m.mtime.cn/#!/movie/{0}/posters_and_images/",isAppendGreedyValue:false},{key:"http://movie.mtime.com/(\\d+)([\\w\\W+?])",value:"http://m.mtime.cn/#!/movie/{0}{1}/",isAppendGreedyValue:true}];var personDictionary=[{key:"http://people.mtime.com/(\\d+)/photo_gallery/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/person/concreteImage/{0}/{1}{2}/",isAppendGreedyValue:true},{key:"http://people.mtime.com/(\\d+)/photo_gallery[\\w\\W*?]",value:"http://m.mtime.cn/#!/person/personImages/{0}/",isAppendGreedyValue:false},{key:"http://people.mtime.com/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/person/{0}{1}/",isAppendGreedyValue:true}];var newsDictionary=[{key:"http://news.mtime.com/(\\d+)/(\\d+)/(\\d+)/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/news/movie/{3}/",isAppendGreedyValue:false},{key:"http://news.mtime.com/pix/(\\d+)/(\\d+)/(\\d+)/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/news/gallery/{3}/",isAppendGreedyValue:false}];var otherDictionary=[{key:"http://i.mtime.com/(\\d+)/blog/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/review/detail/{1}{2}/",isAppendGreedyValue:true}];var goodsDictionary=[{key:"http://item.mall.mtime.com/(\\d+)/",value:"http://m.mtime.cn/#!/commerce/item/{0}/",isAppendGreedyValue:false}];var dicArray=[movieDictionary,personDictionary,newsDictionary,otherDictionary,goodsDictionary];function stringFormat(f,k,j){for(var h=0;h<k.length;h++){var g="{"+h.toString()+"}";if(j&&h==k.length-1){if(isNaN(Number(k[h]))){k[h]=""}}f=f.replace(g,k[h])}return f}function getNewValue(e){var f="";for(var d=0;d<dicArray.length;d++){f=dictionaryMatch(e,dicArray[d]);if(f!==""){break}}return f===""?e:f}function dictionaryMatch(j,f){for(var g=0;g<f.length;g++){var k=new RegExp(f[g].key);var h=k.exec(j);if(typeof h!="undefined"&&h!=null&&h!=""){if(h.length!=0){h.splice(0,1);if(h.length!=0){return stringFormat(f[g].value,h,f[g].isAppendGreedyValue)}}}continue}return""};